###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.20.2.41139 for 8051             27/Mar/2014  17:05:55 #
# Copyright 2004-2013 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#                                                                             #
#    Source file        =  D:\Texas Instruments\Z-Stack Lighting              #
#                          1.0.2\Components\mac\low_level\srf04\mac_tx.c      #
#    Command line       =  -f "D:\Texas Instruments\Z-Stack Lighting          #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\Tools\CC2530DB\f8wRouter.cfg" (-DCPU32MHZ        #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f "D:\Texas         #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\Tools\CC2530DB\f8wConfig.cfg" (-DZIGBEEPRO       #
#                          -DSECURE=1 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100    #
#                          -DREJOIN_POLL_RATE=440) -f "D:\Texas               #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\Tools\CC2530DB\f8wZCL.cfg" "D:\Texas             #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Components\mac\low_level\srf04\mac_tx.c" -D  #
#                          FEATURE_GREEN_POWER -D SECURE=1 -D                 #
#                          TC_LINKKEY_JOIN -D ZDSECMGR_TC_DEVICE_MAX=2 -D     #
#                          NV_RESTORE -D HOLD_AUTO_START -D INTER_PAN -D      #
#                          ZTOOL_P1 -D MT_TASK -D MT_APP_FUNC -D MT_SYS_FUNC  #
#                          -D MT_ZDO_FUNC -D MT_ZDO_CB_FUNC -D MT_UTIL_FUNC   #
#                          -D MT_ZDO_MGMT -D LCD_SUPPORTED -D HAL_LCD=FALSE   #
#                          -D HAL_KEY=FALSE -D ZCL_BASIC -D ZCL_READ -D       #
#                          ZCL_WRITE -D ZCL_IDENTIFY -D ZCL_ON_OFF -D         #
#                          ZCL_SCENES -D ZCL_GROUPS -D                        #
#                          ZCL_LIGHT_LINK_ENHANCE -D ZCL_LEVEL_CTRL -D        #
#                          ZCL_COLOR_CTRL -D xMAX_CHANNELS_24GHZ=0x02108800   #
#                          -lC "D:\Texas Instruments\Z-Stack Lighting         #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\BridgeE #
#                          B-Pro\List\" -lA "D:\Texas Instruments\Z-Stack     #
#                          Lighting 1.0.2\Projects\zstack\ZLL\SampleApp\CC253 #
#                          x\BridgeEB-Pro\List\" --diag_suppress Pe001,Pa010  #
#                          -o "D:\Texas Instruments\Z-Stack Lighting          #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\BridgeE #
#                          B-Pro\Obj\" -e --debug --core=plain --dptr=16,1    #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I "D:\Texas Instruments\Z-Stack Lighting          #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\" -I    #
#                          "D:\Texas Instruments\Z-Stack Lighting             #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\Sour #
#                          ce\" -I "D:\Texas Instruments\Z-Stack Lighting     #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\S #
#                          ource\" -I "D:\Texas Instruments\Z-Stack Lighting  #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\HomeAutomation\Source\" -I "D:\Texas             #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\HomeAutomation\SampleLight\Source\" -I           #
#                          "D:\Texas Instruments\Z-Stack Lighting             #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\ZMain\TI2530DB\" -I "D:\Texas                    #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\hal\include\" -I "D:\Texas      #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\hal\target\CC2530EB\" -I        #
#                          "D:\Texas Instruments\Z-Stack Lighting             #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\mac\include\" -I "D:\Texas      #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\mac\high_level\" -I "D:\Texas   #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\mac\low_level\srf04\" -I        #
#                          "D:\Texas Instruments\Z-Stack Lighting             #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\mac\low_level\srf04\single_chip #
#                          \" -I "D:\Texas Instruments\Z-Stack Lighting       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\mt\" -I "D:\Texas               #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\osal\include\" -I "D:\Texas     #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\services\saddr\" -I "D:\Texas   #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\services\sdata\" -I "D:\Texas   #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\af\" -I "D:\Texas         #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\nwk\" -I "D:\Texas        #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\sapi\" -I "D:\Texas       #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\sec\" -I "D:\Texas        #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\sys\" -I "D:\Texas        #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\zcl\" -I "D:\Texas        #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\zdo\" -I "D:\Texas        #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\zmac\" -I "D:\Texas             #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\zmac\f8w\" -Ohz                 #
#                          --require_prototypes                               #
#    List file          =  D:\Texas Instruments\Z-Stack Lighting              #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\BridgeE #
#                          B-Pro\List\mac_tx.lst                              #
#    Object file        =  D:\Texas Instruments\Z-Stack Lighting              #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\BridgeE #
#                          B-Pro\Obj\mac_tx.r51                               #
#                                                                             #
#                                                                             #
###############################################################################

D:\Texas Instruments\Z-Stack Lighting 1.0.2\Components\mac\low_level\srf04\mac_tx.c
      1          /**************************************************************************************************
      2            Filename:       mac_tx.c
      3            Revised:        $Date: 2007-10-15 14:56:36 -0700 (Mon, 15 Oct 2007) $
      4            Revision:       $Revision: 15687 $
      5          
      6            Description:    Describe the purpose and contents of the file.
      7          
      8          
      9            Copyright 2006-2013 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com.
     38          **************************************************************************************************/
     39          
     40          /* ------------------------------------------------------------------------------------------------
     41           *                                          Includes
     42           * ------------------------------------------------------------------------------------------------
     43           */
     44          
     45          /* hal */
     46          #include "hal_types.h"
     47          #include "hal_defs.h"
     48          #include "hal_mcu.h"

   \                                 In  segment SFR_AN, at 0xa8
   \   union <unnamed> volatile __sfr _A_IEN0
   \                     _A_IEN0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xe1
   \   unsigned char volatile __sfr RFST
   \                     RFST:
   \   000000                DS 1
     49          #include "hal_mac_cfg.h"
     50          
     51          /* high-level */
     52          #include "mac_spec.h"
     53          #include "mac_pib.h"
     54          
     55          /* exported low-level */
     56          #include "mac_low_level.h"
     57          
     58          /* low-level specific */
     59          #include "mac_tx.h"
     60          #include "mac_backoff_timer.h"
     61          #include "mac_rx.h"
     62          #include "mac_rx_onoff.h"
     63          #include "mac_radio.h"
     64          #include "mac_sleep.h"
     65          
     66          /* target specific */
     67          #include "mac_radio_defs.h"
     68          
     69          /* debug */
     70          #include "mac_assert.h"
     71          
     72          
     73          /* ------------------------------------------------------------------------------------------------
     74           *                                            Defines
     75           * ------------------------------------------------------------------------------------------------
     76           */
     77          #define MFR_LEN                   MAC_FCS_FIELD_LEN
     78          #define PREPENDED_BYTE_LEN        1
     79          
     80          
     81          /* ------------------------------------------------------------------------------------------------
     82           *                                         Global Constants
     83           * ------------------------------------------------------------------------------------------------
     84           */
     85          
     86          /*
     87           *  This is the time, in backoffs, required to set up a slotted transmit.
     88           *  It is exported to high level so that code can schedule enough time
     89           *  for slotted transmits.
     90           *
     91           *  A default is provided if a value is not specified.  If the default
     92           *  is not appropriate, a #define should be added within hal_mac_cfg.h.
     93           */
     94          #ifndef HAL_MAC_TX_SLOTTED_DELAY
     95          #define HAL_MAC_TX_SLOTTED_DELAY    3
     96          #endif

   \                                 In  segment XDATA_ROM_C, align 1
     97          uint8 const macTxSlottedDelay = HAL_MAC_TX_SLOTTED_DELAY;
   \                     macTxSlottedDelay:
   \   000000   03           DB 3
     98          
     99          
    100          /* ------------------------------------------------------------------------------------------------
    101           *                                         Global Variables
    102           * ------------------------------------------------------------------------------------------------
    103           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    104          uint8 macTxActive;
   \                     macTxActive:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    105          uint8 macTxType;
   \                     macTxType:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    106          uint8 macTxBe;
   \                     macTxBe:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    107          uint8 macTxCsmaBackoffDelay;
   \                     macTxCsmaBackoffDelay:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    108          uint8 macTxGpInterframeDelay;
   \                     macTxGpInterframeDelay:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    109          
    110          
    111          /* ------------------------------------------------------------------------------------------------
    112           *                                         Local Variables
    113           * ------------------------------------------------------------------------------------------------
    114           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    115          static uint8 nb;
   \                     nb:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    116          static uint8 txSeqn;
   \                     txSeqn:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    117          static uint8 txAckReq;
   \                     txAckReq:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    118          static uint8 txRetransmitFlag;
   \                     txRetransmitFlag:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    119          
    120          
    121          /* ------------------------------------------------------------------------------------------------
    122           *                                         Local Prototypes
    123           * ------------------------------------------------------------------------------------------------
    124           */
    125          static void txCsmaPrep(void);
    126          #ifdef FEATURE_GREEN_POWER
    127          static void txGreenPowerPrep(void);
    128          #endif
    129          static void txGo(void);
    130          static void txCsmaGo(void);
    131          static void txComplete(uint8 status);
    132          
    133          
    134          /**************************************************************************************************
    135           * @fn          macTxInit
    136           *
    137           * @brief       Initialize variables for tx module.
    138           *
    139           * @param       none
    140           *
    141           * @return      none
    142           **************************************************************************************************
    143           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    144          MAC_INTERNAL_API void macTxInit(void)
   \                     macTxInit:
    145          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    146            macTxActive      = MAC_TX_ACTIVE_NO_ACTIVITY;
   \   000004   02....       LJMP    ?Subroutine0 & 0xFFFF
    147            txRetransmitFlag = 0;
    148          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   90....       MOV     DPTR,#macTxActive
   \   000003   E4           CLR     A
   \   000004   F0           MOVX    @DPTR,A
   \   000005   90....       MOV     DPTR,#txRetransmitFlag
   \   000008   F0           MOVX    @DPTR,A
   \   000009                REQUIRE ??Subroutine8_0
   \   000009                ; // Fall through to label ??Subroutine8_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine8_0:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    149          
    150          
    151          /**************************************************************************************************
    152           * @fn          macTxHaltCleanup
    153           *
    154           * @brief       -
    155           *
    156           * @param       none
    157           *
    158           * @return      none
    159           **************************************************************************************************
    160           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    161          MAC_INTERNAL_API void macTxHaltCleanup(void)
   \                     macTxHaltCleanup:
    162          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    163            MAC_RADIO_TX_RESET();
   \   000004                ; Setup parameters for call to function macCspTxReset
   \   000004   12....       LCALL   ??macCspTxReset?relay
    164            macTxInit();
   \   000007   02....       LJMP    ?Subroutine0 & 0xFFFF
    165          }
    166          
    167          
    168          /**************************************************************************************************
    169           * @fn          macTxFrame
    170           *
    171           * @brief       Transmit the frame pointed to by pMacDataTx with the specified type.
    172           *              NOTE! It is not legal to call this function from interrupt context.
    173           *
    174           * @param       txType - type of transmit
    175           *
    176           * @return      none
    177           **************************************************************************************************
    178           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    179          MAC_INTERNAL_API void macTxFrame(uint8 txType)
   \                     macTxFrame:
    180          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    181            MAC_ASSERT(!macTxActive);            /* transmit on top of transmit */
   \   000007   90....       MOV     DPTR,#macTxActive
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   6003         JZ      ??macTxFrame_0
   \   00000D                ; Setup parameters for call to function halAssertHandler
   \   00000D   12....       LCALL   ??halAssertHandler?relay
    182          
    183            /* mark transmit as active */
    184            macTxActive = MAC_TX_ACTIVE_INITIALIZE;
   \                     ??macTxFrame_0:
   \   000010   90....       MOV     DPTR,#macTxActive
   \   000013   7401         MOV     A,#0x1
   \   000015   F0           MOVX    @DPTR,A
    185          
    186            /*
    187             *  The MAC will not enter sleep mode if there is an active transmit.  However, if macSleep() is
    188             *  ever called from interrupt context, it possible to enter sleep state after a transmit is
    189             *  intiated but before macTxActive is set.  To recover from this, the transmit must be aborted
    190             *  and proper notificiation given to high-level.
    191             */
    192            if (macSleepState != MAC_SLEEP_STATE_AWAKE)
   \   000016   90....       MOV     DPTR,#macSleepState
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   6008         JZ      ??macTxFrame_1
    193            {
    194              /* notify high-level that transmit had to be aborted */
    195              txComplete(MAC_TX_ABORTED);
   \   00001C                ; Setup parameters for call to function txComplete
   \   00001C   791D         MOV     R1,#0x1d
   \   00001E   12....       LCALL   ??txComplete?relay
    196          
    197              /* exit from transmit logic */
    198              return;
   \   000021   02....       LJMP    ??CrossCallReturnLabel_12 & 0xFFFF
    199            }
    200          
    201            /* save transmit type */
    202            macTxType = txType;
   \                     ??macTxFrame_1:
   \   000024   EE           MOV     A,R6
   \   000025   90....       MOV     DPTR,#macTxType
   \   000028   F0           MOVX    @DPTR,A
    203          
    204            /*-------------------------------------------------------------------------------
    205             *  Prepare for transmit.
    206             */
    207            if (macTxType == MAC_TX_TYPE_SLOTTED)
   \   000029   6402         XRL     A,#0x2
   \   00002B   7005         JNZ     ??macTxFrame_2
    208            {
    209              MAC_RADIO_TX_PREP_SLOTTED();
   \   00002D                ; Setup parameters for call to function macCspTxPrepSlotted
   \   00002D   12....       LCALL   ??macCspTxPrepSlotted?relay
   \   000030   807A         SJMP    ??macTxFrame_3
    210            }
    211          
    212          #ifdef FEATURE_GREEN_POWER
    213            else if (macTxType == MAC_TX_TYPE_GREEN_POWER)
   \                     ??macTxFrame_2:
   \   000032   E0           MOVX    A,@DPTR
   \   000033   6403         XRL     A,#0x3
   \   000035   7030         JNZ     ??macTxFrame_4
    214            {
    215              txGreenPowerPrep();
   \   000037   90....       MOV     DPTR,#pMacDataTx
   \   00003A   E0           MOVX    A,@DPTR
   \   00003B   F8           MOV     R0,A
   \   00003C   A3           INC     DPTR
   \   00003D   E0           MOVX    A,@DPTR
   \   00003E   C8           XCH     A,R0
   \   00003F   2419         ADD     A,#0x19
   \   000041   F582         MOV     DPL,A
   \   000043   E8           MOV     A,R0
   \   000044   3400         ADDC    A,#0x0
   \   000046   F583         MOV     DPH,A
   \   000048   E0           MOVX    A,@DPTR
   \   000049   90....       MOV     DPTR,#macTxCsmaBackoffDelay
   \   00004C   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   00004F   241A         ADD     A,#0x1a
   \   000051   F582         MOV     DPL,A
   \   000053   E8           MOV     A,R0
   \   000054   3400         ADDC    A,#0x0
   \   000056   F583         MOV     DPH,A
   \   000058   E0           MOVX    A,@DPTR
   \   000059   90....       MOV     DPTR,#macTxGpInterframeDelay
   \   00005C   F0           MOVX    @DPTR,A
   \   00005D   7003         JNZ     ??macTxFrame_5
   \   00005F   7401         MOV     A,#0x1
   \   000061   F0           MOVX    @DPTR,A
   \                     ??macTxFrame_5:
   \   000062                ; Setup parameters for call to function macCspTxPrepGreenPower
   \   000062   12....       LCALL   ??macCspTxPrepGreenPower?relay
    216            }
   \   000065   8045         SJMP    ??macTxFrame_3
    217          #endif /* #ifdef FEATURE_GREEN_POWER */
    218          
    219            else
    220            {
    221              MAC_ASSERT((macTxType == MAC_TX_TYPE_SLOTTED_CSMA) || (macTxType == MAC_TX_TYPE_UNSLOTTED_CSMA));
   \                     ??macTxFrame_4:
   \   000067   E0           MOVX    A,@DPTR
   \   000068   6007         JZ      ??macTxFrame_6
   \   00006A   6401         XRL     A,#0x1
   \   00006C   6003         JZ      ??macTxFrame_6
   \   00006E                ; Setup parameters for call to function halAssertHandler
   \   00006E   12....       LCALL   ??halAssertHandler?relay
    222          
    223              nb = 0;
   \                     ??macTxFrame_6:
   \   000071   90....       MOV     DPTR,#nb
   \   000074   E4           CLR     A
   \   000075   12....       LCALL   ?Subroutine4 & 0xFFFF
    224              macTxBe = (pMacDataTx->internal.txOptions & MAC_TXOPTION_ALT_BE) ? macPib.altBe : macPib.minBe;
   \                     ??CrossCallReturnLabel_3:
   \   000078   240E         ADD     A,#0xe
   \   00007A   F582         MOV     DPL,A
   \   00007C   E8           MOV     A,R0
   \   00007D   3400         ADDC    A,#0x0
   \   00007F   F583         MOV     DPH,A
   \   000081   E0           MOVX    A,@DPTR
   \   000082   5440         ANL     A,#0x40
   \   000084   6005         JZ      ??macTxFrame_7
   \   000086   90....       MOV     DPTR,#macPib + 58
   \   000089   8003         SJMP    ??macTxFrame_8
   \                     ??macTxFrame_7:
   \   00008B   90....       MOV     DPTR,#macPib + 28
   \                     ??macTxFrame_8:
   \   00008E   E0           MOVX    A,@DPTR
   \   00008F   90....       MOV     DPTR,#macTxBe
   \   000092   12....       LCALL   ?Subroutine5 & 0xFFFF
    225          
    226              if ((macTxType == MAC_TX_TYPE_SLOTTED_CSMA) && (macPib.battLifeExt))
   \                     ??CrossCallReturnLabel_4:
   \   000095   7012         JNZ     ??macTxFrame_9
   \   000097   90....       MOV     DPTR,#macPib + 3
   \   00009A   E0           MOVX    A,@DPTR
   \   00009B   600C         JZ      ??macTxFrame_9
    227              {
    228                macTxBe = MIN(2, macTxBe);
   \   00009D   90....       MOV     DPTR,#macTxBe
   \   0000A0   E0           MOVX    A,@DPTR
   \   0000A1   C3           CLR     C
   \   0000A2   9403         SUBB    A,#0x3
   \   0000A4   4003         JC      ??macTxFrame_9
   \   0000A6   7402         MOV     A,#0x2
   \   0000A8   F0           MOVX    @DPTR,A
    229              }
    230          
    231              txCsmaPrep();
   \                     ??macTxFrame_9:
   \   0000A9                ; Setup parameters for call to function txCsmaPrep
   \   0000A9   12....       LCALL   ??txCsmaPrep?relay
    232            }
    233          
    234            /*-------------------------------------------------------------------------------
    235             *  Load transmit FIFO unless this is a retransmit.  No need to write
    236             *  the FIFO again in that case.
    237             */
    238            if (!txRetransmitFlag)
   \                     ??macTxFrame_3:
   \   0000AC   90....       MOV     DPTR,#txRetransmitFlag
   \   0000AF   E0           MOVX    A,@DPTR
   \   0000B0   7062         JNZ     ??macTxFrame_10
    239            {
    240              uint8 * p;
    241              uint8   lenMhrMsdu;
    242          
    243              MAC_ASSERT(pMacDataTx != NULL); /* must have data to transmit */
   \   0000B2   90....       MOV     DPTR,#pMacDataTx
   \   0000B5   E0           MOVX    A,@DPTR
   \   0000B6   F8           MOV     R0,A
   \   0000B7   A3           INC     DPTR
   \   0000B8   E0           MOVX    A,@DPTR
   \   0000B9   F9           MOV     R1,A
   \   0000BA   E8           MOV     A,R0
   \   0000BB   49           ORL     A,R1
   \   0000BC   7003         JNZ     ??macTxFrame_11
   \   0000BE                ; Setup parameters for call to function halAssertHandler
   \   0000BE   12....       LCALL   ??halAssertHandler?relay
    244          
    245              /* save needed parameters */
    246              txAckReq = MAC_ACK_REQUEST(pMacDataTx->msdu.p);
   \                     ??macTxFrame_11:
   \   0000C1   90....       MOV     DPTR,#pMacDataTx
   \   0000C4   E0           MOVX    A,@DPTR
   \   0000C5   2402         ADD     A,#0x2
   \   0000C7   F8           MOV     R0,A
   \   0000C8   A3           INC     DPTR
   \   0000C9   E0           MOVX    A,@DPTR
   \   0000CA   3400         ADDC    A,#0x0
   \   0000CC   F9           MOV     R1,A
   \   0000CD   8882         MOV     DPL,R0
   \   0000CF   8983         MOV     DPH,R1
   \   0000D1   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   0000D4   E0           MOVX    A,@DPTR
   \   0000D5   5420         ANL     A,#0x20
   \   0000D7   90....       MOV     DPTR,#txAckReq
   \   0000DA   F0           MOVX    @DPTR,A
    247              txSeqn   = MAC_SEQ_NUMBER(pMacDataTx->msdu.p);
   \   0000DB   8882         MOV     DPL,R0
   \   0000DD   8983         MOV     DPH,R1
   \   0000DF   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   0000E2   E0           MOVX    A,@DPTR
   \   0000E3   90....       MOV     DPTR,#txSeqn
   \   0000E6   F0           MOVX    @DPTR,A
    248          
    249              /* set length of frame (note: use of term msdu is a misnomer, here it's actually mhr + msdu) */
    250              lenMhrMsdu = pMacDataTx->msdu.len;
   \   0000E7   90....       MOV     DPTR,#pMacDataTx
   \   0000EA   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   0000ED   A3           INC     DPTR
   \   0000EE   A3           INC     DPTR
   \   0000EF   E0           MOVX    A,@DPTR
   \   0000F0   FA           MOV     R2,A
    251          
    252              /* calling code guarantees an unused prepended byte  */
    253              p = pMacDataTx->msdu.p - PREPENDED_BYTE_LEN;
   \   0000F1   8882         MOV     DPL,R0
   \   0000F3   8983         MOV     DPH,R1
   \   0000F5   E0           MOVX    A,@DPTR
   \   0000F6   24FF         ADD     A,#-0x1
   \   0000F8   F8           MOV     R0,A
   \   0000F9   A3           INC     DPTR
   \   0000FA   E0           MOVX    A,@DPTR
   \   0000FB   34FF         ADDC    A,#-0x1
   \   0000FD   F9           MOV     R1,A
   \   0000FE   8882         MOV     DPL,R0
   \   000100   8983         MOV     DPH,R1
    254          
    255              /* first byte of buffer is length of MPDU */
    256              *p = lenMhrMsdu + MFR_LEN;
   \   000102   7402         MOV     A,#0x2
   \   000104   2A           ADD     A,R2
   \   000105   F0           MOVX    @DPTR,A
    257          
    258              /*
    259               *  Flush the TX FIFO.  This is necessary in case the previous transmit was never
    260               *  actually sent (e.g. CSMA failed without strobing TXON).  If bytes are written to
    261               *  the FIFO but not transmitted, they remain in the FIFO to be transmitted whenever
    262               *  a strobe of TXON does happen.
    263               */
    264              MAC_RADIO_FLUSH_TX_FIFO();
   \   000106   75E1EE       MOV     0xe1,#-0x12
    265          
    266              /* write bytes to FIFO, prepended byte is included, MFR is not (it's generated by hardware) */
    267              MAC_RADIO_WRITE_TX_FIFO(p, PREPENDED_BYTE_LEN + lenMhrMsdu);
   \   000109                ; Setup parameters for call to function macMemWriteTxFifo
   \   000109   7401         MOV     A,#0x1
   \   00010B   2A           ADD     A,R2
   \   00010C   F9           MOV     R1,A
   \   00010D   AA82         MOV     R2,DPL
   \   00010F   AB83         MOV     R3,DPH
   \   000111   12....       LCALL   ??macMemWriteTxFifo?relay
    268            }
    269          
    270            /*-------------------------------------------------------------------------------
    271             *  If not receiving, start the transmit.  If receive is active
    272             *  queue up the transmit.
    273             *
    274             *  Critical sections around the state change prevents any sort of race condition
    275             *  with  macTxStartQueuedFrame().  This guarantees function txGo() will only be
    276             *  called once.
    277             */
    278            {
    279              halIntState_t  s;
    280          
    281              HAL_ENTER_CRITICAL_SECTION(s);
   \                     ??macTxFrame_10:
   \   000114   A2AF         MOV     C,0xa8.7
   \   000116   E4           CLR     A
   \   000117   33           RLC     A
   \   000118   F8           MOV     R0,A
   \   000119   C2AF         CLR     0xa8.7
    282              if (!macRxActive && !macRxOutgoingAckFlag)
   \   00011B   90....       MOV     DPTR,#macRxActive
   \   00011E   E0           MOVX    A,@DPTR
   \   00011F   7011         JNZ     ??macTxFrame_12
   \   000121   90....       MOV     DPTR,#macRxOutgoingAckFlag
   \   000124   E0           MOVX    A,@DPTR
   \   000125   700B         JNZ     ??macTxFrame_12
    283              {
    284                macTxActive = MAC_TX_ACTIVE_GO;
   \   000127   90....       MOV     DPTR,#macTxActive
   \   00012A   12....       LCALL   ?Subroutine6 & 0xFFFF
    285                HAL_EXIT_CRITICAL_SECTION(s);
    286                txGo();
   \                     ??CrossCallReturnLabel_10:
   \   00012D                ; Setup parameters for call to function txGo
   \   00012D   12....       LCALL   ??txGo?relay
   \   000130   8008         SJMP    ??CrossCallReturnLabel_12
    287              }
    288              else
    289              {
    290                macTxActive = MAC_TX_ACTIVE_QUEUED;
   \                     ??macTxFrame_12:
   \   000132   90....       MOV     DPTR,#macTxActive
   \   000135   7402         MOV     A,#0x2
   \   000137   12....       LCALL   ??Subroutine9_0 & 0xFFFF
    291                HAL_EXIT_CRITICAL_SECTION(s);
    292              }
    293            }
   \                     ??CrossCallReturnLabel_12:
   \   00013A   02....       LJMP    ?Subroutine1 & 0xFFFF
   \   00013D                REQUIRE RFST
   \   00013D                REQUIRE _A_IEN0
    294          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   90....       MOV     DPTR,#pMacDataTx
   \   000004   E0           MOVX    A,@DPTR
   \   000005   F8           MOV     R0,A
   \   000006   A3           INC     DPTR
   \   000007   E0           MOVX    A,@DPTR
   \   000008   C8           XCH     A,R0
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   000003   A3           INC     DPTR
   \   000004   A3           INC     DPTR
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   FA           MOV     R2,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F583         MOV     DPH,A
   \   000006   8A82         MOV     DPL,R2
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function macTxFrame
   \   000001   90....       MOV     DPTR,#macTxType
   \   000004   E0           MOVX    A,@DPTR
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   7483         MOV     A,#-0x7d
   \   000002                REQUIRE ??Subroutine9_0
   \   000002                ; // Fall through to label ??Subroutine9_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine9_0:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   E8           MOV     A,R0
   \   000002   A2E0         MOV     C,0xE0 /* A   */.0
   \   000004   92AF         MOV     0xa8.7,C
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    295          
    296          
    297          /*=================================================================================================
    298           * @fn          txCsmaPrep
    299           *
    300           * @brief       Prepare/initialize for a CSMA transmit.
    301           *
    302           * @param       none
    303           *
    304           * @return      none
    305           *=================================================================================================
    306           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    307          static void txCsmaPrep(void)
   \                     txCsmaPrep:
    308          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    309            macTxCsmaBackoffDelay = macRadioRandomByte() & ((1 << macTxBe) - 1);
   \   000005                ; Setup parameters for call to function macRadioRandomByte
   \   000005   12....       LCALL   ??macRadioRandomByte?relay
   \   000008   75..01       MOV     ?V0 + 0,#0x1
   \   00000B   75..00       MOV     ?V0 + 1,#0x0
   \   00000E   90....       MOV     DPTR,#macTxBe
   \   000011   E0           MOVX    A,@DPTR
   \   000012   78..         MOV     R0,#?V0 + 0
   \   000014   12....       LCALL   ?S_SHL
   \   000017   E5..         MOV     A,?V0 + 0
   \   000019   14           DEC     A
   \   00001A   59           ANL     A,R1
   \   00001B   90....       MOV     DPTR,#macTxCsmaBackoffDelay
   \   00001E   12....       LCALL   ?Subroutine5 & 0xFFFF
    310          
    311            if (macTxType == MAC_TX_TYPE_SLOTTED_CSMA)
   \                     ??CrossCallReturnLabel_5:
   \   000021   7005         JNZ     ??txCsmaPrep_0
    312            {
    313              MAC_RADIO_TX_PREP_CSMA_SLOTTED();
   \   000023                ; Setup parameters for call to function macCspTxPrepCsmaSlotted
   \   000023   12....       LCALL   ??macCspTxPrepCsmaSlotted?relay
   \   000026   8003         SJMP    ??txCsmaPrep_1
    314            }
    315            else
    316            {
    317              MAC_RADIO_TX_PREP_CSMA_UNSLOTTED();
   \                     ??txCsmaPrep_0:
   \   000028                ; Setup parameters for call to function macCspTxPrepCsmaUnslotted
   \   000028   12....       LCALL   ??macCspTxPrepCsmaUnslotted?relay
    318            }
    319          }
   \                     ??txCsmaPrep_1:
   \   00002B                REQUIRE ?Subroutine2
   \   00002B                ; // Fall through to label ?Subroutine2

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    320          
    321          
    322          #ifdef FEATURE_GREEN_POWER
    323          /*=================================================================================================
    324           * @fn          txGreenPowerPrep
    325           *
    326           * @brief       Prepare/initialize for a Green Power transmit.
    327           *
    328           * @param       none
    329           *
    330           * @return      none
    331           *=================================================================================================
    332           */
    333          static void txGreenPowerPrep(void)
    334          {
    335            /* Re-use macTxCsmaBackoffDelay for Green Power number of transmissions */
    336            macTxCsmaBackoffDelay  = pMacDataTx->internal.gpNumOfTx;
    337            macTxGpInterframeDelay = pMacDataTx->internal.gpInterframeDelay;
    338          
    339            if (macTxGpInterframeDelay == 0)
    340            {
    341              macTxGpInterframeDelay = 1;
    342            }
    343          
    344            MAC_RADIO_TX_PREP_GREEN_POWER();
    345          }
    346          #endif /* #ifdef FEATURE_GREEN_POWER */
    347          
    348          
    349          /*=================================================================================================
    350           * @fn          txGo
    351           *
    352           * @brief       Start a transmit going.
    353           *
    354           * @param       none
    355           *
    356           * @return      none
    357           *=================================================================================================
    358           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    359          static void txGo(void)
   \                     txGo:
    360          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    361            /*
    362             *  If execution has reached this point, any transmitted ACK has long since completed.  It is
    363             *  possible though that there is still a pending callback.  If so, it is irrelevant and needs to
    364             *  be canceled at this point.
    365             */
    366            MAC_RADIO_CANCEL_ACK_TX_DONE_CALLBACK();
   \   000004   9061A4       MOV     DPTR,#0x61a4
   \   000007   E0           MOVX    A,@DPTR
   \   000008   C2E0         CLR     0xE0 /* A   */.0
   \   00000A   F0           MOVX    @DPTR,A
    367            macRxOutgoingAckFlag = 0;
   \   00000B   90....       MOV     DPTR,#macRxOutgoingAckFlag
   \   00000E   E4           CLR     A
   \   00000F   12....       LCALL   ?Subroutine5 & 0xFFFF
    368          
    369            /* based on type of transmit, call the correct "go" functionality */
    370            if (macTxType == MAC_TX_TYPE_SLOTTED)
   \                     ??CrossCallReturnLabel_6:
   \   000012   6402         XRL     A,#0x2
   \   000014   7005         JNZ     ??txGo_0
    371            {
    372              MAC_RADIO_TX_GO_SLOTTED();
   \   000016                ; Setup parameters for call to function macCspTxGoSlotted
   \   000016   12....       LCALL   ??macCspTxGoSlotted?relay
   \   000019   800D         SJMP    ??txGo_1
    373            }
    374          
    375          #ifdef FEATURE_GREEN_POWER
    376            else if (macTxType == MAC_TX_TYPE_GREEN_POWER)
   \                     ??txGo_0:
   \   00001B   E0           MOVX    A,@DPTR
   \   00001C   6403         XRL     A,#0x3
   \   00001E   7005         JNZ     ??txGo_2
    377            {
    378              MAC_RADIO_TX_GO_GREEN_POWER();
   \   000020                ; Setup parameters for call to function macCspTxGoGreenPower
   \   000020   12....       LCALL   ??macCspTxGoGreenPower?relay
   \   000023   8003         SJMP    ??txGo_1
    379            }
    380          #endif /* #ifdef FEATURE_GREEN_POWER */
    381          
    382            else
    383            {
    384              txCsmaGo();
   \                     ??txGo_2:
   \   000025                ; Setup parameters for call to function txCsmaGo
   \   000025   12....       LCALL   ??txCsmaGo?relay
    385            }
    386          }
   \                     ??txGo_1:
   \   000028   80..         SJMP    ??Subroutine8_0
    387          
    388          
    389          /*=================================================================================================
    390           * @fn          txCsmaGo
    391           *
    392           * @brief       Start a CSMA transmit going.
    393           *
    394           * @param       none
    395           *
    396           * @return      none
    397           *=================================================================================================
    398           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    399          static void txCsmaGo(void)
   \                     txCsmaGo:
    400          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    401            if (macTxType == MAC_TX_TYPE_SLOTTED_CSMA)
   \   000004   90....       MOV     DPTR,#macTxType
   \   000007   E0           MOVX    A,@DPTR
   \   000008   7014         JNZ     ??txCsmaGo_0
    402            {
    403              if (macTxCsmaBackoffDelay >= macDataTxTimeAvailable())
   \   00000A                ; Setup parameters for call to function macDataTxTimeAvailable
   \   00000A   12....       LCALL   ??macDataTxTimeAvailable?relay
   \   00000D   E9           MOV     A,R1
   \   00000E   F8           MOV     R0,A
   \   00000F   90....       MOV     DPTR,#macTxCsmaBackoffDelay
   \   000012   E0           MOVX    A,@DPTR
   \   000013   C3           CLR     C
   \   000014   98           SUBB    A,R0
   \   000015   4007         JC      ??txCsmaGo_0
    404              {
    405                txComplete(MAC_NO_TIME);
   \   000017                ; Setup parameters for call to function txComplete
   \   000017   791C         MOV     R1,#0x1c
   \   000019   12....       LCALL   ??txComplete?relay
    406                return;
   \   00001C   8003         SJMP    ??txCsmaGo_1
    407              }
    408              MAC_RADIO_TX_GO_SLOTTED_CSMA();
    409            }
    410            else
    411            {
    412              MAC_RADIO_TX_GO_CSMA();
   \                     ??txCsmaGo_0:
   \   00001E                ; Setup parameters for call to function macCspTxGoCsma
   \   00001E   12....       LCALL   ??macCspTxGoCsma?relay
    413            }
   \                     ??txCsmaGo_1:
   \   000021   80..         SJMP    ??Subroutine8_0
    414          }
    415          
    416          
    417          /**************************************************************************************************
    418           * @fn          macTxFrameRetransmit
    419           *
    420           * @brief       Retransmit the last frame.
    421           *
    422           * @param       none
    423           *
    424           * @return      none
    425           **************************************************************************************************
    426           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    427          MAC_INTERNAL_API void macTxFrameRetransmit(void)
   \                     macTxFrameRetransmit:
    428          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    429            txRetransmitFlag = 1;
   \   000004   90....       MOV     DPTR,#txRetransmitFlag
   \   000007   7401         MOV     A,#0x1
   \   000009   12....       LCALL   ?Subroutine5 & 0xFFFF
    430            macTxFrame(macTxType);
   \                     ??CrossCallReturnLabel_7:
   \   00000C   F9           MOV     R1,A
   \   00000D   12....       LCALL   ??macTxFrame?relay
    431          }
   \   000010   80..         SJMP    ??Subroutine8_0
    432          
    433          
    434          /**************************************************************************************************
    435           * @fn          macTxStartQueuedFrame
    436           *
    437           * @brief       See if there is a queued frame waiting to transmit.  If so, initiate
    438           *              the transmit now.
    439           *
    440           * @param       none
    441           *
    442           * @return      none
    443           **************************************************************************************************
    444           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    445          MAC_INTERNAL_API void macTxStartQueuedFrame(void)
   \                     macTxStartQueuedFrame:
    446          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    447            halIntState_t  s;
    448          
    449            MAC_ASSERT(!macRxActive && !macRxOutgoingAckFlag); /* queued frames should not transmit in middle of a receive */
   \   000005   90....       MOV     DPTR,#macRxActive
   \   000008   E0           MOVX    A,@DPTR
   \   000009   7006         JNZ     ??macTxStartQueuedFrame_0
   \   00000B   90....       MOV     DPTR,#macRxOutgoingAckFlag
   \   00000E   E0           MOVX    A,@DPTR
   \   00000F   6003         JZ      ??macTxStartQueuedFrame_1
   \                     ??macTxStartQueuedFrame_0:
   \   000011                ; Setup parameters for call to function halAssertHandler
   \   000011   12....       LCALL   ??halAssertHandler?relay
    450          
    451            /*
    452             *  Critical sections around the state change prevents any sort of race condition
    453             *  with macTxFrame().  This guarantees function txGo() will only be be called once.
    454             */
    455            HAL_ENTER_CRITICAL_SECTION(s);
   \                     ??macTxStartQueuedFrame_1:
   \   000014   A2AF         MOV     C,0xa8.7
   \   000016   E4           CLR     A
   \   000017   33           RLC     A
   \   000018   F8           MOV     R0,A
   \   000019   C2AF         CLR     0xa8.7
    456            if (macTxActive == MAC_TX_ACTIVE_QUEUED)
   \   00001B   90....       MOV     DPTR,#macTxActive
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   6402         XRL     A,#0x2
   \   000021   7008         JNZ     ??macTxStartQueuedFrame_2
    457            {
    458              macTxActive = MAC_TX_ACTIVE_GO;
   \   000023   12....       LCALL   ?Subroutine6 & 0xFFFF
    459              HAL_EXIT_CRITICAL_SECTION(s);
    460              txGo();
   \                     ??CrossCallReturnLabel_11:
   \   000026                ; Setup parameters for call to function txGo
   \   000026   12....       LCALL   ??txGo?relay
   \   000029   8005         SJMP    ??macTxStartQueuedFrame_3
    461            }
    462            else
    463            {
    464              HAL_EXIT_CRITICAL_SECTION(s);
   \                     ??macTxStartQueuedFrame_2:
   \   00002B   E8           MOV     A,R0
   \   00002C   A2E0         MOV     C,0xE0 /* A   */.0
   \   00002E   92AF         MOV     0xa8.7,C
    465            }
    466          }
   \                     ??macTxStartQueuedFrame_3:
   \   000030   02....       LJMP    ?Subroutine1 & 0xFFFF
   \   000033                REQUIRE _A_IEN0
    467          
    468          
    469          /**************************************************************************************************
    470           * @fn          macTxChannelBusyCallback
    471           *
    472           * @brief       This callback is executed if a CSMA transmit was attempted but the channel
    473           *              was busy.
    474           *
    475           * @param       none
    476           *
    477           * @return      none
    478           **************************************************************************************************
    479           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    480          MAC_INTERNAL_API void macTxChannelBusyCallback(void)
   \                     macTxChannelBusyCallback:
    481          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
    482            MAC_ASSERT((macTxType == MAC_TX_TYPE_SLOTTED_CSMA) || (macTxType == MAC_TX_TYPE_UNSLOTTED_CSMA));
   \   000005   90....       MOV     DPTR,#macTxType
   \   000008   E0           MOVX    A,@DPTR
   \   000009   6007         JZ      ??macTxChannelBusyCallback_0
   \   00000B   6401         XRL     A,#0x1
   \   00000D   6003         JZ      ??macTxChannelBusyCallback_0
   \   00000F                ; Setup parameters for call to function halAssertHandler
   \   00000F   12....       LCALL   ??halAssertHandler?relay
    483          
    484            /* turn off receiver if allowed */
    485            macTxActive = MAC_TX_ACTIVE_CHANNEL_BUSY;
   \                     ??macTxChannelBusyCallback_0:
   \   000012   90....       MOV     DPTR,#macTxActive
   \   000015   7404         MOV     A,#0x4
   \   000017   F0           MOVX    @DPTR,A
    486            macRxOffRequest();
   \   000018                ; Setup parameters for call to function macRxOffRequest
   \   000018   12....       LCALL   ??macRxOffRequest?relay
    487          
    488            /*  clear channel assement failed, follow through with CSMA algorithm */
    489            nb++;
   \   00001B   90....       MOV     DPTR,#nb
   \   00001E   E0           MOVX    A,@DPTR
   \   00001F   04           INC     A
   \   000020   F0           MOVX    @DPTR,A
    490            if (nb > macPib.maxCsmaBackoffs)
   \   000021   F8           MOV     R0,A
   \   000022   90....       MOV     DPTR,#macPib + 27
   \   000025   E0           MOVX    A,@DPTR
   \   000026   C3           CLR     C
   \   000027   98           SUBB    A,R0
   \   000028   5007         JNC     ??macTxChannelBusyCallback_1
    491            {
    492              txComplete(MAC_CHANNEL_ACCESS_FAILURE);
   \   00002A                ; Setup parameters for call to function txComplete
   \   00002A   79E1         MOV     R1,#-0x1f
   \   00002C   12....       LCALL   ??txComplete?relay
   \   00002F   8032         SJMP    ??macTxChannelBusyCallback_2
    493            }
    494            else
    495            {
    496              macTxBe = MIN(macTxBe+1, macPib.maxBe);
   \                     ??macTxChannelBusyCallback_1:
   \   000031   90....       MOV     DPTR,#macPib + 39
   \   000034   E0           MOVX    A,@DPTR
   \   000035   FA           MOV     R2,A
   \   000036   90....       MOV     DPTR,#macTxBe
   \   000039   E0           MOVX    A,@DPTR
   \   00003A   2401         ADD     A,#0x1
   \   00003C   F8           MOV     R0,A
   \   00003D   E4           CLR     A
   \   00003E   3400         ADDC    A,#0x0
   \   000040   F9           MOV     R1,A
   \   000041   8A..         MOV     ?V0 + 0,R2
   \   000043   E8           MOV     A,R0
   \   000044   95..         SUBB    A,?V0 + 0
   \   000046   E9           MOV     A,R1
   \   000047   9400         SUBB    A,#0x0
   \   000049   C3           CLR     C
   \   00004A   65D0         XRL     A,PSW
   \   00004C   33           RLC     A
   \   00004D   5004         JNC     ??macTxChannelBusyCallback_3
   \   00004F   E0           MOVX    A,@DPTR
   \   000050   04           INC     A
   \   000051   8001         SJMP    ??macTxChannelBusyCallback_4
   \                     ??macTxChannelBusyCallback_3:
   \   000053   EA           MOV     A,R2
   \                     ??macTxChannelBusyCallback_4:
   \   000054   FE           MOV     R6,A
   \   000055   EE           MOV     A,R6
   \   000056   F0           MOVX    @DPTR,A
    497              txCsmaPrep();
   \   000057                ; Setup parameters for call to function txCsmaPrep
   \   000057   12....       LCALL   ??txCsmaPrep?relay
    498              macTxActive = MAC_TX_ACTIVE_GO;
   \   00005A   90....       MOV     DPTR,#macTxActive
   \   00005D   7483         MOV     A,#-0x7d
   \   00005F   F0           MOVX    @DPTR,A
    499              txCsmaGo();
   \   000060                ; Setup parameters for call to function txCsmaGo
   \   000060   12....       LCALL   ??txCsmaGo?relay
    500            }
    501          }
   \                     ??macTxChannelBusyCallback_2:
   \   000063   02....       LJMP    ?Subroutine2 & 0xFFFF
    502          
    503          
    504          /**************************************************************************************************
    505           * @fn          macTxDoneCallback
    506           *
    507           * @brief       This callback is executed when transmit completes.
    508           *
    509           * @param       none
    510           *
    511           * @return      none
    512           **************************************************************************************************
    513           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    514          MAC_INTERNAL_API void macTxDoneCallback(void)
   \                     macTxDoneCallback:
    515          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    516            halIntState_t  s;
    517          
    518            /*
    519             *  There is a small chance this function could be called twice for a single transmit.
    520             *  To prevent logic from executing twice, the state variable macTxActive is used as
    521             *  a gating mechanism to guarantee single time execution.
    522             */
    523            HAL_ENTER_CRITICAL_SECTION(s);
   \   000005   A2AF         MOV     C,0xa8.7
   \   000007   E4           CLR     A
   \   000008   33           RLC     A
   \   000009   FE           MOV     R6,A
   \   00000A   C2AF         CLR     0xa8.7
    524            if (macTxActive == MAC_TX_ACTIVE_GO)
   \   00000C   90....       MOV     DPTR,#macTxActive
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   6483         XRL     A,#0x83
   \   000012   701E         JNZ     ??macTxDoneCallback_0
    525            {
    526              /* see if ACK was requested */
    527              if (!txAckReq)
   \   000014   90....       MOV     DPTR,#txAckReq
   \   000017   E0           MOVX    A,@DPTR
   \   000018   90....       MOV     DPTR,#macTxActive
   \   00001B   700F         JNZ     ??macTxDoneCallback_1
    528              {
    529                macTxActive = MAC_TX_ACTIVE_DONE;
   \   00001D   7485         MOV     A,#-0x7b
   \   00001F   F0           MOVX    @DPTR,A
    530                HAL_EXIT_CRITICAL_SECTION(s);
   \   000020   EE           MOV     A,R6
   \   000021   A2E0         MOV     C,0xE0 /* A   */.0
   \   000023   92AF         MOV     0xa8.7,C
    531          
    532                /* ACK was not requested, transmit is complete */
    533                txComplete(MAC_SUCCESS);
   \   000025                ; Setup parameters for call to function txComplete
   \   000025   7900         MOV     R1,#0x0
   \   000027   12....       LCALL   ??txComplete?relay
   \   00002A   800B         SJMP    ??macTxDoneCallback_2
    534              }
    535              else
    536              {
    537                /*
    538                 *  ACK was requested - must wait to receive it.  A timer is set
    539                 *  to expire after the timeout duration for waiting for an ACK.
    540                 *  If an ACK is received, the function macTxAckReceived() is called.
    541                 *  If an ACK is not received within the timeout period,
    542                 *  the function macTxAckNotReceivedCallback() is called.
    543                 */
    544                macTxActive = MAC_TX_ACTIVE_LISTEN_FOR_ACK;
   \                     ??macTxDoneCallback_1:
   \   00002C   7486         MOV     A,#-0x7a
   \   00002E   F0           MOVX    @DPTR,A
    545                MAC_RADIO_TX_REQUEST_ACK_TIMEOUT_CALLBACK();
   \   00002F                ; Setup parameters for call to function macCspTxRequestAckTimeoutCallback
   \   00002F   12....       LCALL   ??macCspTxRequestAckTimeoutCallback?relay
    546                HAL_EXIT_CRITICAL_SECTION(s);
    547              }
    548            }
    549            else
    550            {
    551              HAL_EXIT_CRITICAL_SECTION(s);
   \                     ??macTxDoneCallback_0:
   \   000032   EE           MOV     A,R6
   \   000033   A2E0         MOV     C,0xE0 /* A   */.0
   \   000035   92AF         MOV     0xa8.7,C
    552            }
    553          }
   \                     ??macTxDoneCallback_2:
   \   000037                REQUIRE ?Subroutine1
   \   000037                REQUIRE _A_IEN0
   \   000037                ; // Fall through to label ?Subroutine1
    554          
    555          
    556          /**************************************************************************************************
    557           * @fn          macTxAckReceivedCallback
    558           *
    559           * @brief       This function is called by the receive logic when an ACK is received and
    560           *              transmit logic is listening for an ACK.
    561           *
    562           * @param       seqn        - sequence number of received ACK
    563           * @param       pendingFlag - set if pending flag of ACK is set, cleared otherwise
    564           *
    565           * @return      none
    566           **************************************************************************************************
    567           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    568          MAC_INTERNAL_API void macTxAckReceivedCallback(uint8 seqn, uint8 pendingFlag)
   \                     macTxAckReceivedCallback:
    569          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   \   000007   EA           MOV     A,R2
   \   000008   FF           MOV     R7,A
    570            halIntState_t  s;
    571          
    572            /* only process if listening for an ACK; critical section prevents race condition problems */
    573            HAL_ENTER_CRITICAL_SECTION(s);
   \   000009   A2AF         MOV     C,0xa8.7
   \   00000B   E4           CLR     A
   \   00000C   33           RLC     A
   \   00000D   F5..         MOV     ?V0 + 0,A
   \   00000F   C2AF         CLR     0xa8.7
    574            if (macTxActive == MAC_TX_ACTIVE_LISTEN_FOR_ACK)
   \   000011   90....       MOV     DPTR,#macTxActive
   \   000014   E0           MOVX    A,@DPTR
   \   000015   6486         XRL     A,#0x86
   \   000017   7025         JNZ     ??macTxAckReceivedCallback_0
    575            {
    576              macTxActive = MAC_TX_ACTIVE_POST_ACK;
   \   000019   7487         MOV     A,#-0x79
   \   00001B   F0           MOVX    @DPTR,A
    577              MAC_RADIO_TX_CANCEL_ACK_TIMEOUT_CALLBACK();
   \   00001C                ; Setup parameters for call to function macCspTxCancelAckTimeoutCallback
   \   00001C   12....       LCALL   ??macCspTxCancelAckTimeoutCallback?relay
    578              HAL_EXIT_CRITICAL_SECTION(s);
   \   00001F   E5..         MOV     A,?V0 + 0
   \   000021   A2E0         MOV     C,0xE0 /* A   */.0
   \   000023   92AF         MOV     0xa8.7,C
    579          
    580              /* see if the sequence number of received ACK matches sequence number of packet just sent */
    581              if (seqn == txSeqn)
   \   000025   90....       MOV     DPTR,#txSeqn
   \   000028   E0           MOVX    A,@DPTR
   \   000029   6E           XRL     A,R6
   \   00002A   700B         JNZ     ??macTxAckReceivedCallback_1
    582              {
    583                /*
    584                 *  Sequence numbers match so transmit is successful.  Return appropriate
    585                 *  status based on the pending flag of the received ACK.
    586                 */
    587                if (pendingFlag)
   \   00002C   EF           MOV     A,R7
   \   00002D   6004         JZ      ??macTxAckReceivedCallback_2
    588                {
    589                  txComplete(MAC_ACK_PENDING);
   \   00002F                ; Setup parameters for call to function txComplete
   \   00002F   791B         MOV     R1,#0x1b
   \   000031   8006         SJMP    ??macTxAckReceivedCallback_3
    590                }
    591                else
    592                {
    593                  txComplete(MAC_SUCCESS);
   \                     ??macTxAckReceivedCallback_2:
   \   000033                ; Setup parameters for call to function txComplete
   \   000033   7900         MOV     R1,#0x0
   \   000035   8002         SJMP    ??macTxAckReceivedCallback_3
    594                }
    595              }
    596              else
    597              {
    598                /* sequence number did not match; per spec, transmit failed at this point */
    599                txComplete(MAC_NO_ACK);
   \                     ??macTxAckReceivedCallback_1:
   \   000037                ; Setup parameters for call to function txComplete
   \   000037   79E9         MOV     R1,#-0x17
   \                     ??macTxAckReceivedCallback_3:
   \   000039   12....       LCALL   ??txComplete?relay
   \   00003C   8006         SJMP    ??macTxAckReceivedCallback_4
    600              }
    601            }
    602            else
    603            {
    604              HAL_EXIT_CRITICAL_SECTION(s);
   \                     ??macTxAckReceivedCallback_0:
   \   00003E   E5..         MOV     A,?V0 + 0
   \   000040   A2E0         MOV     C,0xE0 /* A   */.0
   \   000042   92AF         MOV     0xa8.7,C
    605            }
    606          }
   \                     ??macTxAckReceivedCallback_4:
   \   000044   02....       LJMP    ?Subroutine2 & 0xFFFF
   \   000047                REQUIRE _A_IEN0
    607          
    608          
    609          /**************************************************************************************************
    610           * @fn          macTxAckNotReceivedCallback
    611           *
    612           * @brief       This function is called by the receive logic when transmit is listening
    613           *              for an ACK but something else is received.  It is also called if the
    614           *              listen-for-ACK timeout is reached.
    615           *
    616           * @brief
    617           *
    618           * @param       none
    619           *
    620           * @return      none
    621           **************************************************************************************************
    622           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    623          MAC_INTERNAL_API void macTxAckNotReceivedCallback(void)
   \                     macTxAckNotReceivedCallback:
    624          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    625            halIntState_t  s;
    626          
    627            /* only process if listening for an ACK; critical section prevents race condition problems */
    628            HAL_ENTER_CRITICAL_SECTION(s);
   \   000005   A2AF         MOV     C,0xa8.7
   \   000007   E4           CLR     A
   \   000008   33           RLC     A
   \   000009   FE           MOV     R6,A
   \   00000A   C2AF         CLR     0xa8.7
    629            if (macTxActive == MAC_TX_ACTIVE_LISTEN_FOR_ACK)
   \   00000C   90....       MOV     DPTR,#macTxActive
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   6486         XRL     A,#0x86
   \   000012   7012         JNZ     ??macTxAckNotReceivedCallback_0
    630            {
    631              macTxActive = MAC_TX_ACTIVE_POST_ACK;
   \   000014   7487         MOV     A,#-0x79
   \   000016   F0           MOVX    @DPTR,A
    632              MAC_RADIO_TX_CANCEL_ACK_TIMEOUT_CALLBACK();
   \   000017                ; Setup parameters for call to function macCspTxCancelAckTimeoutCallback
   \   000017   12....       LCALL   ??macCspTxCancelAckTimeoutCallback?relay
    633              HAL_EXIT_CRITICAL_SECTION(s);
   \   00001A   EE           MOV     A,R6
   \   00001B   A2E0         MOV     C,0xE0 /* A   */.0
   \   00001D   92AF         MOV     0xa8.7,C
    634          
    635              /* a non-ACK was received when expecting an ACK, per spec transmit is over at this point */
    636              txComplete(MAC_NO_ACK);
   \   00001F                ; Setup parameters for call to function txComplete
   \   00001F   79E9         MOV     R1,#-0x17
   \   000021   12....       LCALL   ??txComplete?relay
   \   000024   8005         SJMP    ??macTxAckNotReceivedCallback_1
    637            }
    638            else
    639            {
    640              HAL_EXIT_CRITICAL_SECTION(s);
   \                     ??macTxAckNotReceivedCallback_0:
   \   000026   EE           MOV     A,R6
   \   000027   A2E0         MOV     C,0xE0 /* A   */.0
   \   000029   92AF         MOV     0xa8.7,C
    641            }
    642          }
   \                     ??macTxAckNotReceivedCallback_1:
   \   00002B   80..         SJMP    ?Subroutine1
   \   00002D                REQUIRE _A_IEN0
    643          
    644          
    645          /*=================================================================================================
    646           * @fn          txComplete
    647           *
    648           * @brief       Transmit has completed.  Perform needed maintenance and return status of
    649           *              the transmit via callback function.
    650           *
    651           * @param       status - status of the transmit that just went out
    652           *
    653           * @return      none
    654           *=================================================================================================
    655           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    656          static void txComplete(uint8 status)
   \                     txComplete:
    657          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    658            /* reset the retransmit flag */
    659            txRetransmitFlag = 0;
   \   000007   90....       MOV     DPTR,#txRetransmitFlag
   \   00000A   E4           CLR     A
   \   00000B   F0           MOVX    @DPTR,A
    660          
    661            /* update tx state; turn off receiver if nothing is keeping it on */
    662            macTxActive = MAC_TX_ACTIVE_NO_ACTIVITY;
   \   00000C   90....       MOV     DPTR,#macTxActive
   \   00000F   F0           MOVX    @DPTR,A
    663          
    664            if(macPib.rf4cepowerSavings)
   \   000010   90....       MOV     DPTR,#macPib + 60
   \   000013   E0           MOVX    A,@DPTR
   \   000014   6005         JZ      ??txComplete_0
    665            {
    666              /* mark receive as inactive */
    667              macRxActive = MAC_RX_ACTIVE_NO_ACTIVITY;
   \   000016   90....       MOV     DPTR,#macRxActive
   \   000019   E4           CLR     A
   \   00001A   F0           MOVX    @DPTR,A
    668            }
    669          
    670            /* turn off receive if allowed */
    671            macRxOffRequest();
   \                     ??txComplete_0:
   \   00001B                ; Setup parameters for call to function macRxOffRequest
   \   00001B   12....       LCALL   ??macRxOffRequest?relay
    672          
    673            /* update transmit power in case there was a change */
    674            macRadioUpdateTxPower();
   \   00001E                ; Setup parameters for call to function macRadioUpdateTxPower
   \   00001E   12....       LCALL   ??macRadioUpdateTxPower?relay
    675          
    676            /*
    677             *  Channel cannot change during transmit so update it here.  (Channel *can* change during
    678             *  a receive.  The update function resets receive logic and any partially received
    679             *  frame is purged.)
    680             */
    681            macRadioUpdateChannel();
   \   000021                ; Setup parameters for call to function macRadioUpdateChannel
   \   000021   12....       LCALL   ??macRadioUpdateChannel?relay
    682          
    683            /* return status of transmit via callback function */
    684            macTxCompleteCallback(status);
   \   000024                ; Setup parameters for call to function macTxCompleteCallback
   \   000024   EE           MOV     A,R6
   \   000025   F9           MOV     R1,A
   \   000026   12....       LCALL   ??macTxCompleteCallback?relay
    685          }
   \   000029   02....       LJMP    ?Subroutine1 & 0xFFFF
    686          
    687          
    688          /**************************************************************************************************
    689           * @fn          macTxTimestampCallback
    690           *
    691           * @brief       This callback function records the timestamp into the receive data structure.
    692           *              It should be called as soon as possible after there is a valid timestamp.
    693           *
    694           * @param       none
    695           *
    696           * @return      none
    697           **************************************************************************************************
    698           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    699          MAC_INTERNAL_API void macTxTimestampCallback(void)
   \                     macTxTimestampCallback:
    700          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
    701            MAC_ASSERT(pMacDataTx != NULL); /* transmit structure must be there */
   \   000005   90....       MOV     DPTR,#pMacDataTx
   \   000008   E0           MOVX    A,@DPTR
   \   000009   F8           MOV     R0,A
   \   00000A   A3           INC     DPTR
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   E8           MOV     A,R0
   \   00000E   49           ORL     A,R1
   \   00000F   7003         JNZ     ??macTxTimestampCallback_0
   \   000011                ; Setup parameters for call to function halAssertHandler
   \   000011   12....       LCALL   ??halAssertHandler?relay
    702          
    703            pMacDataTx->internal.timestamp  = macBackoffTimerCapture();
   \                     ??macTxTimestampCallback_0:
   \   000014                ; Setup parameters for call to function macBackoffTimerCapture
   \   000014   12....       LCALL   ??macBackoffTimerCapture?relay
   \   000017   8A..         MOV     ?V0 + 0,R2
   \   000019   8B..         MOV     ?V0 + 1,R3
   \   00001B   8C..         MOV     ?V0 + 2,R4
   \   00001D   8D..         MOV     ?V0 + 3,R5
   \   00001F   90....       MOV     DPTR,#pMacDataTx
   \   000022   E0           MOVX    A,@DPTR
   \   000023   F8           MOV     R0,A
   \   000024   A3           INC     DPTR
   \   000025   E0           MOVX    A,@DPTR
   \   000026   F583         MOV     DPH,A
   \   000028   8882         MOV     DPL,R0
   \   00002A   A3           INC     DPTR
   \   00002B   A3           INC     DPTR
   \   00002C   A3           INC     DPTR
   \   00002D   A3           INC     DPTR
   \   00002E   A3           INC     DPTR
   \   00002F   78..         MOV     R0,#?V0 + 0
   \   000031   12....       LCALL   ?L_MOV_TO_X
    704            pMacDataTx->internal.timestamp2 = MAC_RADIO_TIMER_CAPTURE();
   \   000034                ; Setup parameters for call to function macMcuTimerCapture
   \   000034   12....       LCALL   ??macMcuTimerCapture?relay
   \   000037   8A..         MOV     ?V0 + 0,R2
   \   000039   90....       MOV     DPTR,#pMacDataTx
   \   00003C   E0           MOVX    A,@DPTR
   \   00003D   FA           MOV     R2,A
   \   00003E   A3           INC     DPTR
   \   00003F   E0           MOVX    A,@DPTR
   \   000040   CA           XCH     A,R2
   \   000041   2409         ADD     A,#0x9
   \   000043   F582         MOV     DPL,A
   \   000045   EA           MOV     A,R2
   \   000046   3400         ADDC    A,#0x0
   \   000048   F583         MOV     DPH,A
   \   00004A   E5..         MOV     A,?V0 + 0
   \   00004C   F0           MOVX    @DPTR,A
   \   00004D   A3           INC     DPTR
   \   00004E   EB           MOV     A,R3
   \   00004F   F0           MOVX    @DPTR,A
    705          }
   \   000050   7F04         MOV     R7,#0x4
   \   000052   02....       LJMP    ?BANKED_LEAVE_XDATA
    706          
    707          
    708          /**************************************************************************************************
    709           * @fn          macTxCollisionWithRxCallback
    710           *
    711           * @brief       Function called if transmit strobed on top of a receive.
    712           *
    713           * @param       none
    714           *
    715           * @return      none
    716           **************************************************************************************************
    717           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    718          MAC_INTERNAL_API void macTxCollisionWithRxCallback(void)
   \                     macTxCollisionWithRxCallback:
    719          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    720            macRxHaltCleanup();
   \   000004                ; Setup parameters for call to function macRxHaltCleanup
   \   000004   12....       LCALL   ??macRxHaltCleanup?relay
    721          }
   \   000007   02....       LJMP    ??Subroutine8_0 & 0xFFFF

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxHaltCleanup?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxHaltCleanup

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxFrame?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxFrame

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??txCsmaPrep?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    txCsmaPrep

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??txGo?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    txGo

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??txCsmaGo?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    txCsmaGo

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxFrameRetransmit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxFrameRetransmit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxStartQueuedFrame?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxStartQueuedFrame

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxChannelBusyCallback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxChannelBusyCallback

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxDoneCallback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxDoneCallback

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxAckReceivedCallback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxAckReceivedCallback

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxAckNotReceivedCallback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxAckNotReceivedCallback

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??txComplete?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    txComplete

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxTimestampCallback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxTimestampCallback

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??macTxCollisionWithRxCallback?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    macTxCollisionWithRxCallback
    722          
    723          
    724          
    725          /**************************************************************************************************
    726           *                                  Compile Time Integrity Checks
    727           **************************************************************************************************
    728           */
    729          #if (MAC_TX_ACTIVE_NO_ACTIVITY != 0x00)
    730          #error "ERROR! Zero is reserved value of macTxActive. Allows boolean operations, e.g !macTxActive."
    731          #endif
    732          
    733          /**************************************************************************************************
    734          */

   Maximum stack usage in bytes:

   ISTACK PSTACK XSTACK Function
   ------ ------ ------ --------
       0      0      9  macTxAckNotReceivedCallback
                          0 0  9 -> macCspTxCancelAckTimeoutCallback
                          0 0  9 -> txComplete
       0      0     10  macTxAckReceivedCallback
                          0 0 10 -> macCspTxCancelAckTimeoutCallback
                          0 0 10 -> txComplete
       0      0     10  macTxChannelBusyCallback
                          0 0 10 -> halAssertHandler
                          0 0 10 -> macRxOffRequest
                          0 0 10 -> txComplete
                          0 0 10 -> txCsmaGo
                          0 0 10 -> txCsmaPrep
       2      0      0  macTxCollisionWithRxCallback
                          2 0  0 -> macRxHaltCleanup
       0      0      9  macTxDoneCallback
                          0 0  9 -> macCspTxRequestAckTimeoutCallback
                          0 0  9 -> txComplete
       1      0      9  macTxFrame
                          0 0  9 -> halAssertHandler
                          0 0  9 -> macCspTxPrepGreenPower
                          0 0  9 -> macCspTxPrepSlotted
                          0 0  9 -> macMemWriteTxFifo
                          0 0  9 -> txComplete
                          0 0  9 -> txCsmaPrep
                          0 0  9 -> txGo
       2      0      0  macTxFrameRetransmit
                          2 0  0 -> macTxFrame
       2      0      0  macTxHaltCleanup
                          2 0  0 -> macCspTxReset
       2      0      0  macTxInit
       0      0      9  macTxStartQueuedFrame
                          0 0  9 -> halAssertHandler
                          0 0  9 -> txGo
       0      0     12  macTxTimestampCallback
                          0 0 12 -> halAssertHandler
                          0 0 12 -> macBackoffTimerCapture
                          0 0 12 -> macMcuTimerCapture
       0      0     19  txComplete
                          0 0  9 -> macRadioUpdateChannel
                          0 0  9 -> macRadioUpdateTxPower
                          0 0  9 -> macRxOffRequest
                          0 0  9 -> macTxCompleteCallback
       2      0     10  txCsmaGo
                          2 0  0 -> macCspTxGoCsma
                          2 0  0 -> macDataTxTimeAvailable
                          2 0  0 -> txComplete
       0      0     20  txCsmaPrep
                          0 0 10 -> macCspTxPrepCsmaSlotted
                          0 0 10 -> macCspTxPrepCsmaUnslotted
                          0 0 10 -> macRadioRandomByte
       2      0      9  txGo
                          2 0  0 -> macCspTxGoGreenPower
                          2 0  0 -> macCspTxGoSlotted
                          2 0  0 -> txCsmaGo


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       7  ??Subroutine8_0
       7  ??Subroutine9_0
       6  ??macTxAckNotReceivedCallback?relay
       6  ??macTxAckReceivedCallback?relay
       6  ??macTxChannelBusyCallback?relay
       6  ??macTxCollisionWithRxCallback?relay
       6  ??macTxDoneCallback?relay
       6  ??macTxFrame?relay
       6  ??macTxFrameRetransmit?relay
       6  ??macTxHaltCleanup?relay
       6  ??macTxInit?relay
       6  ??macTxStartQueuedFrame?relay
       6  ??macTxTimestampCallback?relay
       6  ??txComplete?relay
       6  ??txCsmaGo?relay
       6  ??txCsmaPrep?relay
       6  ??txGo?relay
       9  ?Subroutine0
       5  ?Subroutine1
       5  ?Subroutine2
       6  ?Subroutine3
      10  ?Subroutine4
       6  ?Subroutine5
       2  ?Subroutine6
       9  ?Subroutine7
       1  RFST
       1  _A_IEN0
      45  macTxAckNotReceivedCallback
      71  macTxAckReceivedCallback
       1  macTxActive
       1  macTxBe
     102  macTxChannelBusyCallback
      10  macTxCollisionWithRxCallback
       1  macTxCsmaBackoffDelay
      55  macTxDoneCallback
     317  macTxFrame
      18  macTxFrameRetransmit
       1  macTxGpInterframeDelay
      10  macTxHaltCleanup
       7  macTxInit
       1  macTxSlottedDelay
      51  macTxStartQueuedFrame
      85  macTxTimestampCallback
       1  macTxType
       1  nb
       1  txAckReq
      44  txComplete
      35  txCsmaGo
      43  txCsmaPrep
      42  txGo
       1  txRetransmitFlag
       1  txSeqn

 
 1 001 bytes in segment BANKED_CODE
    90 bytes in segment BANK_RELAYS
     2 bytes in segment SFR_AN
     1 byte  in segment XDATA_ROM_C
     9 bytes in segment XDATA_Z
 
 1 091 bytes of CODE  memory
     1 byte  of CONST memory
     0 bytes of DATA  memory (+ 2 bytes shared)
     9 bytes of XDATA memory

Errors: none
Warnings: none
