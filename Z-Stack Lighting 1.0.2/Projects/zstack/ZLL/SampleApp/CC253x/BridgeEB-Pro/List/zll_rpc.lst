###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.20.2.41139 for 8051             07/May/2014  17:02:26 #
# Copyright 2004-2013 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#                                                                             #
#    Source file        =  D:\Texas Instruments\Z-Stack Lighting              #
#                          1.0.2\Projects\zstack\ZLL\Source\zll_rpc.c         #
#    Command line       =  -f "D:\Texas Instruments\Z-Stack Lighting          #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\Tools\CC2530DB\f8wRouter.cfg" (-DCPU32MHZ        #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f "D:\Texas         #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\Tools\CC2530DB\f8wConfig.cfg" (-DZIGBEEPRO       #
#                          -DSECURE=1 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100    #
#                          -DREJOIN_POLL_RATE=440) -f "D:\Texas               #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\Tools\CC2530DB\f8wZCL.cfg" "D:\Texas             #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\Source\zll_rpc.c" -D     #
#                          FEATURE_GREEN_POWER -D SECURE=1 -D                 #
#                          TC_LINKKEY_JOIN -D ZDSECMGR_TC_DEVICE_MAX=2 -D     #
#                          NV_RESTORE -D HOLD_AUTO_START -D INTER_PAN -D      #
#                          ZTOOL_P1 -D MT_TASK -D MT_APP_FUNC -D MT_SYS_FUNC  #
#                          -D MT_ZDO_FUNC -D MT_ZDO_CB_FUNC -D MT_UTIL_FUNC   #
#                          -D MT_ZDO_MGMT -D LCD_SUPPORTED -D HAL_LCD=FALSE   #
#                          -D HAL_KEY=FALSE -D ZCL_BASIC -D ZCL_READ -D       #
#                          ZCL_WRITE -D ZCL_IDENTIFY -D ZCL_ON_OFF -D         #
#                          ZCL_SCENES -D ZCL_GROUPS -D                        #
#                          ZCL_LIGHT_LINK_ENHANCE -D ZCL_LEVEL_CTRL -D        #
#                          ZCL_COLOR_CTRL -D xMAX_CHANNELS_24GHZ=0x02108800   #
#                          -lC "D:\Texas Instruments\Z-Stack Lighting         #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\BridgeE #
#                          B-Pro\List\" -lA "D:\Texas Instruments\Z-Stack     #
#                          Lighting 1.0.2\Projects\zstack\ZLL\SampleApp\CC253 #
#                          x\BridgeEB-Pro\List\" --diag_suppress Pe001,Pa010  #
#                          -o "D:\Texas Instruments\Z-Stack Lighting          #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\BridgeE #
#                          B-Pro\Obj\" -e --debug --core=plain --dptr=16,1    #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I "D:\Texas Instruments\Z-Stack Lighting          #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\" -I    #
#                          "D:\Texas Instruments\Z-Stack Lighting             #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\Sour #
#                          ce\" -I "D:\Texas Instruments\Z-Stack Lighting     #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\S #
#                          ource\" -I "D:\Texas Instruments\Z-Stack Lighting  #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\HomeAutomation\Source\" -I "D:\Texas             #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\HomeAutomation\SampleLight\Source\" -I           #
#                          "D:\Texas Instruments\Z-Stack Lighting             #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\ZMain\TI2530DB\" -I "D:\Texas                    #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\hal\include\" -I "D:\Texas      #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\hal\target\CC2530EB\" -I        #
#                          "D:\Texas Instruments\Z-Stack Lighting             #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\mac\include\" -I "D:\Texas      #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\mac\high_level\" -I "D:\Texas   #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\mac\low_level\srf04\" -I        #
#                          "D:\Texas Instruments\Z-Stack Lighting             #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\mac\low_level\srf04\single_chip #
#                          \" -I "D:\Texas Instruments\Z-Stack Lighting       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\mt\" -I "D:\Texas               #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\osal\include\" -I "D:\Texas     #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\services\saddr\" -I "D:\Texas   #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\services\sdata\" -I "D:\Texas   #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\af\" -I "D:\Texas         #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\nwk\" -I "D:\Texas        #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\sapi\" -I "D:\Texas       #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\sec\" -I "D:\Texas        #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\sys\" -I "D:\Texas        #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\zcl\" -I "D:\Texas        #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\zdo\" -I "D:\Texas        #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\zmac\" -I "D:\Texas             #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\zmac\f8w\" -Ohz                 #
#                          --require_prototypes                               #
#    List file          =  D:\Texas Instruments\Z-Stack Lighting              #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\BridgeE #
#                          B-Pro\List\zll_rpc.lst                             #
#    Object file        =  D:\Texas Instruments\Z-Stack Lighting              #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\BridgeE #
#                          B-Pro\Obj\zll_rpc.r51                              #
#                                                                             #
#                                                                             #
###############################################################################

D:\Texas Instruments\Z-Stack Lighting 1.0.2\Projects\zstack\ZLL\Source\zll_rpc.c
      1          /**************************************************************************************************
      2            Filename:       zll_rpc.c
      3            Revised:        $Date: 2012-10-29 16:57:10 -0700 (Mon, 29 Oct 2012) $
      4            Revision:       $Revision: 31957 $
      5          
      6            Description:    This file contains the Zigbee Cluster Library: Light Link
      7                            MT Remote procedure calls.
      8          
      9          
     10            Copyright 2012 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44           #include "zll_rpc.h"
     45           #include "MT.h"
     46          
     47          /*********************************************************************
     48           * GLOBAL VARIABLES
     49           */
     50          
     51          
     52          /*********************************************************************
     53           * FUNCTIONS
     54           *********************************************************************/
     55          
     56           /***************************************************************************************************
     57           * @fn      MT_ZllNotifyTL
     58           *
     59           * @brief   Process and send Indication for a successful ZLL Touch-Link over MT_APP.
     60           *
     61           * @param   pRec - Target's information record
     62           *
     63           * @return  none
     64           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     65          void MT_ZllNotifyTL( epInfoRec_t *pRec )
   \                     MT_ZllNotifyTL:
     66          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
     67            byte *pBuf;
     68            pBuf = osal_mem_alloc( ZLL_CMDLENOPTIONAL_GET_EP_LIST_RSP ); // endpoint information record entry
   \   000009                ; Setup parameters for call to function osal_mem_alloc
   \   000009   7A08         MOV     R2,#0x8
   \   00000B   7B00         MOV     R3,#0x0
   \   00000D   12....       LCALL   ??osal_mem_alloc?relay
   \   000010   8A..         MOV     ?V0 + 2,R2
   \   000012   8B..         MOV     ?V0 + 3,R3
   \   000014   AE..         MOV     R6,?V0 + 2
   \   000016   AF..         MOV     R7,?V0 + 3
     69            if ( pBuf )
   \   000018   EE           MOV     A,R6
   \   000019   4F           ORL     A,R7
   \   00001A   6056         JZ      ??MT_ZllNotifyTL_0
     70            {
     71              pBuf[0] = LO_UINT16( pRec->nwkAddr );
   \   00001C   85..82       MOV     DPL,?V0 + 0
   \   00001F   85..83       MOV     DPH,?V0 + 1
   \   000022   12....       LCALL   ??Subroutine7_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   000025   12....       LCALL   ?Subroutine4 & 0xFFFF
     72              pBuf[1] = HI_UINT16( pRec->nwkAddr );
   \                     ??CrossCallReturnLabel_4:
   \   000028   12....       LCALL   ??Subroutine6_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_7:
   \   00002B   12....       LCALL   ?Subroutine4 & 0xFFFF
     73          
     74              pBuf[2] = pRec->endpoint;
   \                     ??CrossCallReturnLabel_5:
   \   00002E   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000031   A3           INC     DPTR
   \   000032   F0           MOVX    @DPTR,A
     75          
     76              pBuf[3] = LO_UINT16( pRec->profileID );
   \   000033   E5..         MOV     A,?V0 + 0
   \   000035   2403         ADD     A,#0x3
   \   000037   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   00003A   12....       LCALL   ?Subroutine1 & 0xFFFF
     77              pBuf[4] = HI_UINT16( pRec->profileID );
   \                     ??CrossCallReturnLabel_0:
   \   00003D   F0           MOVX    @DPTR,A
     78          
     79              pBuf[5] = LO_UINT16( pRec->deviceID );
   \   00003E   E5..         MOV     A,?V0 + 0
   \   000040   2405         ADD     A,#0x5
   \   000042   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_3:
   \   000045   A3           INC     DPTR
   \   000046   A3           INC     DPTR
   \   000047   12....       LCALL   ?Subroutine1 & 0xFFFF
     80              pBuf[6] = HI_UINT16( pRec->deviceID );
   \                     ??CrossCallReturnLabel_1:
   \   00004A   A3           INC     DPTR
   \   00004B   A3           INC     DPTR
   \   00004C   12....       LCALL   ?Subroutine4 & 0xFFFF
     81          
     82              pBuf[7] = pRec->version;
   \                     ??CrossCallReturnLabel_6:
   \   00004F   A3           INC     DPTR
   \   000050   A3           INC     DPTR
   \   000051   A3           INC     DPTR
   \   000052   A3           INC     DPTR
   \   000053   A3           INC     DPTR
   \   000054   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   000057   A3           INC     DPTR
   \   000058   A3           INC     DPTR
   \   000059   A3           INC     DPTR
   \   00005A   A3           INC     DPTR
   \   00005B   A3           INC     DPTR
   \   00005C   A3           INC     DPTR
   \   00005D   F0           MOVX    @DPTR,A
     83          
     84              /* Send out Reset Response message */
     85              MT_BuildAndSendZToolResponse( ((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_APP),
     86                                             MT_APP_ZLL_TL_IND,
     87                                             ZLL_CMDLENOPTIONAL_GET_EP_LIST_RSP, pBuf );
   \   00005E                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00005E   EE           MOV     A,R6
   \   00005F   FC           MOV     R4,A
   \   000060   EF           MOV     A,R7
   \   000061   FD           MOV     R5,A
   \   000062   7B08         MOV     R3,#0x8
   \   000064   7A81         MOV     R2,#-0x7f
   \   000066   7949         MOV     R1,#0x49
   \   000068   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
     88          
     89              osal_mem_free( pBuf );
   \   00006B                ; Setup parameters for call to function osal_mem_free
   \   00006B   EE           MOV     A,R6
   \   00006C   FA           MOV     R2,A
   \   00006D   EF           MOV     A,R7
   \   00006E   FB           MOV     R3,A
   \   00006F   12....       LCALL   ??osal_mem_free?relay
     90            }
     91          }
   \                     ??MT_ZllNotifyTL_0:
   \   000072   7F04         MOV     R7,#0x4
   \   000074   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   85..82       MOV     DPL,?V0 + 0
   \   000004   85..83       MOV     DPH,?V0 + 1
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   A3           INC     DPTR
   \   000001                REQUIRE ??Subroutine6_0
   \   000001                ; // Fall through to label ??Subroutine6_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine6_0:
   \   000000   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   000003   A3           INC     DPTR
   \   000004   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   A3           INC     DPTR
   \   000001                REQUIRE ??Subroutine7_0
   \   000001                ; // Fall through to label ??Subroutine7_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine7_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   8E82         MOV     DPL,R6
   \   000003   8F83         MOV     DPH,R7
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   F8           MOV     R0,A
   \   000001   E5..         MOV     A,?V0 + 1
   \   000003   3400         ADDC    A,#0x0
   \   000005   F9           MOV     R1,A
   \   000006   8882         MOV     DPL,R0
   \   000008   8983         MOV     DPH,R1
   \   00000A   12....       LCALL   ??Subroutine7_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   00000D   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   A3           INC     DPTR
   \   000001   A3           INC     DPTR
   \   000002   A3           INC     DPTR
   \   000003   F0           MOVX    @DPTR,A
   \   000004   8882         MOV     DPL,R0
   \   000006   8983         MOV     DPH,R1
   \   000008   12....       LCALL   ?Subroutine5 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   00000B   A3           INC     DPTR
   \   00000C   A3           INC     DPTR
   \   00000D   A3           INC     DPTR
   \   00000E   A3           INC     DPTR
   \   00000F   22           RET
     92          
     93          /*********************************************************************
     94           * @fn      MT_ZllSendZCLCmd
     95           *
     96           * @brief   Process and send received ZCL commands over MT_APP.
     97           *          Will be sent in Z-Tool format as APP_MSG_RESPONSE
     98           *
     99           * @param   appEP - The user application endpoint (original message's destination endpoint)
    100           * @param   shortAddr - source network address
    101           * @param   endpoint - source endpoint
    102           * @param   clusterID
    103           * @param   zclHdr - pointer to the received ZCL header
    104           * @param   payloadLen - length of payload
    105           * @param   pPayload - pointer to the payload buffer
    106           *
    107           * @return  none
    108           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    109          void MT_ZllSendZCLCmd( uint8 appEP, uint16 shortAddr, uint8 endpoint, uint16 clusterID,
   \                     MT_ZllSendZCLCmd:
    110                                      zclFrameHdr_t *pZclHdr, uint8 payloadLen, uint8 *pPayload )
    111          {
   \   000000   74EB         MOV     A,#-0x15
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 21
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   89..         MOV     ?V0 + 12,R1
   \   00000C   8A..         MOV     ?V0 + 4,R2
   \   00000E   8B..         MOV     ?V0 + 5,R3
   \   000010   8C..         MOV     ?V0 + 7,R4
   \   000012   ED           MOV     A,R5
   \   000013   FE           MOV     R6,A
   \   000014   741A         MOV     A,#0x1a
   \   000016   12....       LCALL   ?XSTACK_DISP0_8
   \   000019   E0           MOVX    A,@DPTR
   \   00001A   F5..         MOV     ?V0 + 8,A
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F5..         MOV     ?V0 + 9,A
   \   000020   7418         MOV     A,#0x18
   \   000022   12....       LCALL   ?XSTACK_DISP0_8
   \   000025   E0           MOVX    A,@DPTR
   \   000026   F5..         MOV     ?V0 + 2,A
   \   000028   A3           INC     DPTR
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   F5..         MOV     ?V0 + 3,A
    112            uint8 *msg;
    113            uint8 *pBuf;
    114            uint8 len;
    115            uint8 zclHdrLen;
    116          
    117            zclHdrLen = ( pZclHdr->fc.manuSpecific ? 5 : 3 );
   \   00002C   85..82       MOV     DPL,?V0 + 2
   \   00002F   F583         MOV     DPH,A
   \   000031   E0           MOVX    A,@DPTR
   \   000032   5404         ANL     A,#0x4
   \   000034   85..82       MOV     DPL,?XSP + 0
   \   000037   85..83       MOV     DPH,?XSP + 1
   \   00003A   6004         JZ      ??MT_ZllSendZCLCmd_0
   \   00003C   7405         MOV     A,#0x5
   \   00003E   8002         SJMP    ??MT_ZllSendZCLCmd_1
   \                     ??MT_ZllSendZCLCmd_0:
   \   000040   7403         MOV     A,#0x3
   \                     ??MT_ZllSendZCLCmd_1:
   \   000042   F0           MOVX    @DPTR,A
    118            // prepend srcAddr, endpoint, cluster ID, and data length
    119            len =   sizeof ( uint8 )      // this endpoint
    120                  + sizeof ( uint16 )     // srcAddr (low byte first)
    121                  + sizeof ( uint8 )      // source endpoint
    122                  + sizeof ( uint16 )     // cluster ID (low byte first)
    123                  + sizeof ( uint8 )      // data length
    124                  + zclHdrLen             // ZCL header
    125                  + payloadLen;
   \   000043   E0           MOVX    A,@DPTR
   \   000044   2E           ADD     A,R6
   \   000045   F5..         MOV     ?V0 + 6,A
   \   000047   7407         MOV     A,#0x7
   \   000049   25..         ADD     A,?V0 + 6
   \   00004B   FF           MOV     R7,A
    126          
    127            msg = osal_mem_alloc( len );
   \   00004C                ; Setup parameters for call to function osal_mem_alloc
   \   00004C   FA           MOV     R2,A
   \   00004D   7B00         MOV     R3,#0x0
   \   00004F   12....       LCALL   ??osal_mem_alloc?relay
   \   000052   8A..         MOV     ?V0 + 0,R2
   \   000054   8B..         MOV     ?V0 + 1,R3
    128            if ( msg != NULL )
   \   000056   EA           MOV     A,R2
   \   000057   45..         ORL     A,?V0 + 1
   \   000059   7003         JNZ     $+5
   \   00005B   02....       LJMP    ??MT_ZllSendZCLCmd_2 & 0xFFFF
    129            {
    130              pBuf = msg;
    131              *pBuf++ = appEP;
   \   00005E   8A82         MOV     DPL,R2
   \   000060   8B83         MOV     DPH,R3
   \   000062   E5..         MOV     A,?V0 + 12
   \   000064   F0           MOVX    @DPTR,A
   \   000065   A3           INC     DPTR
    132              *pBuf++ = LO_UINT16( shortAddr );
   \   000066   E5..         MOV     A,?V0 + 4
   \   000068   F0           MOVX    @DPTR,A
   \   000069   A3           INC     DPTR
    133              *pBuf++ = HI_UINT16( shortAddr );
   \   00006A   E5..         MOV     A,?V0 + 5
   \   00006C   F0           MOVX    @DPTR,A
   \   00006D   A3           INC     DPTR
    134              *pBuf++ = endpoint;
   \   00006E   E5..         MOV     A,?V0 + 7
   \   000070   F0           MOVX    @DPTR,A
   \   000071   A3           INC     DPTR
   \   000072   AA82         MOV     R2,DPL
   \   000074   AB83         MOV     R3,DPH
   \   000076   7416         MOV     A,#0x16
   \   000078   12....       LCALL   ?XSTACK_DISP0_8
   \   00007B   E0           MOVX    A,@DPTR
   \   00007C   F8           MOV     R0,A
   \   00007D   A3           INC     DPTR
   \   00007E   E0           MOVX    A,@DPTR
   \   00007F   F9           MOV     R1,A
    135              *pBuf++ = LO_UINT16( clusterID );
   \   000080   E8           MOV     A,R0
   \   000081   8A82         MOV     DPL,R2
   \   000083   8B83         MOV     DPH,R3
   \   000085   F0           MOVX    @DPTR,A
   \   000086   A3           INC     DPTR
    136              *pBuf++ = HI_UINT16( clusterID );
   \   000087   E9           MOV     A,R1
   \   000088   F0           MOVX    @DPTR,A
   \   000089   A3           INC     DPTR
    137              *pBuf++ = zclHdrLen + payloadLen;
   \   00008A   E5..         MOV     A,?V0 + 6
   \   00008C   F0           MOVX    @DPTR,A
   \   00008D   A3           INC     DPTR
   \   00008E   0A           INC     R2
   \   00008F   0A           INC     R2
   \   000090   0A           INC     R2
   \   000091   AB83         MOV     R3,DPH
    138          
    139              // zclBuildHdr( pZclHdr, pBuf );
    140              *pBuf++ = ( pZclHdr->fc.type
    141                          | ( pZclHdr->fc.manuSpecific << 2 )
    142                          | ( pZclHdr->fc.direction << 3 )
    143                          | ( pZclHdr->fc.disableDefaultRsp << 4 ) );
   \   000093   85..82       MOV     DPL,?V0 + 2
   \   000096   85..83       MOV     DPH,?V0 + 3
   \   000099   E0           MOVX    A,@DPTR
   \   00009A   541F         ANL     A,#0x1f
   \   00009C   8A82         MOV     DPL,R2
   \   00009E   8B83         MOV     DPH,R3
   \   0000A0   F0           MOVX    @DPTR,A
   \   0000A1   A3           INC     DPTR
   \   0000A2   0A           INC     R2
   \   0000A3   AB83         MOV     R3,DPH
    144              if ( pZclHdr->fc.manuSpecific )
   \   0000A5   85..82       MOV     DPL,?V0 + 2
   \   0000A8   85..83       MOV     DPH,?V0 + 3
   \   0000AB   E0           MOVX    A,@DPTR
   \   0000AC   5404         ANL     A,#0x4
   \   0000AE   6018         JZ      ??CrossCallReturnLabel_15
    145              {
    146                *pBuf++ = LO_UINT16( pZclHdr->manuCode );
   \   0000B0   E5..         MOV     A,?V0 + 2
   \   0000B2   2402         ADD     A,#0x2
   \   0000B4   F8           MOV     R0,A
   \   0000B5   E5..         MOV     A,?V0 + 3
   \   0000B7   3400         ADDC    A,#0x0
   \   0000B9   F9           MOV     R1,A
   \   0000BA   8882         MOV     DPL,R0
   \   0000BC   8983         MOV     DPH,R1
   \   0000BE   12....       LCALL   ??Subroutine8_0 & 0xFFFF
    147                *pBuf++ = HI_UINT16( pZclHdr->manuCode );
   \                     ??CrossCallReturnLabel_14:
   \   0000C1   8882         MOV     DPL,R0
   \   0000C3   8983         MOV     DPH,R1
   \   0000C5   12....       LCALL   ?Subroutine0 & 0xFFFF
    148              }
    149              *pBuf++ = pZclHdr->transSeqNum;
   \                     ??CrossCallReturnLabel_15:
   \   0000C8   85..82       MOV     DPL,?V0 + 2
   \   0000CB   85..83       MOV     DPH,?V0 + 3
   \   0000CE   A3           INC     DPTR
   \   0000CF   A3           INC     DPTR
   \   0000D0   A3           INC     DPTR
   \   0000D1   A3           INC     DPTR
   \   0000D2   E0           MOVX    A,@DPTR
   \   0000D3   8A82         MOV     DPL,R2
   \   0000D5   8B83         MOV     DPH,R3
   \   0000D7   F0           MOVX    @DPTR,A
   \   0000D8   A3           INC     DPTR
   \   0000D9   AA82         MOV     R2,DPL
   \   0000DB   AB83         MOV     R3,DPH
    150              *pBuf++ = pZclHdr->commandID;
   \   0000DD   85..82       MOV     DPL,?V0 + 2
   \   0000E0   85..83       MOV     DPH,?V0 + 3
   \   0000E3   A3           INC     DPTR
   \   0000E4   A3           INC     DPTR
   \   0000E5   A3           INC     DPTR
   \   0000E6   A3           INC     DPTR
   \   0000E7   12....       LCALL   ?Subroutine0 & 0xFFFF
    151          
    152              if ( payloadLen )
   \                     ??CrossCallReturnLabel_16:
   \   0000EA   EE           MOV     A,R6
   \   0000EB   601C         JZ      ??MT_ZllSendZCLCmd_3
    153              {
    154                osal_memcpy( pBuf, pPayload, payloadLen );
   \   0000ED                ; Setup parameters for call to function osal_memcpy
   \   0000ED   85....       MOV     ?V0 + 4,?V0 + 8
   \   0000F0   85....       MOV     ?V0 + 5,?V0 + 9
   \   0000F3   75..00       MOV     ?V0 + 6,#0x0
   \   0000F6   78..         MOV     R0,#?V0 + 4
   \   0000F8   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   0000FB   8E..         MOV     ?V0 + 2,R6
   \   0000FD   AC..         MOV     R4,?V0 + 2
   \   0000FF   7D00         MOV     R5,#0x0
   \   000101   12....       LCALL   ??osal_memcpy?relay
   \   000104   7403         MOV     A,#0x3
   \   000106   12....       LCALL   ?DEALLOC_XSTACK8
    155              }
    156          
    157              MT_BuildAndSendZToolResponse( ((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_APP), MT_APP_RSP,
    158                                            len, msg );
   \                     ??MT_ZllSendZCLCmd_3:
   \   000109                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000109   AC..         MOV     R4,?V0 + 0
   \   00010B   AD..         MOV     R5,?V0 + 1
   \   00010D   EF           MOV     A,R7
   \   00010E   FB           MOV     R3,A
   \   00010F   7A80         MOV     R2,#-0x80
   \   000111   7969         MOV     R1,#0x69
   \   000113   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    159          
    160              osal_mem_free( msg );
   \   000116                ; Setup parameters for call to function osal_mem_free
   \   000116   AA..         MOV     R2,?V0 + 0
   \   000118   AB..         MOV     R3,?V0 + 1
   \   00011A   12....       LCALL   ??osal_mem_free?relay
    161            }
    162          }
   \                     ??MT_ZllSendZCLCmd_2:
   \   00011D   7401         MOV     A,#0x1
   \   00011F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000122   7F0D         MOV     R7,#0xd
   \   000124   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   A3           INC     DPTR
   \   000001                REQUIRE ??Subroutine8_0
   \   000001                ; // Fall through to label ??Subroutine8_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine8_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   8A82         MOV     DPL,R2
   \   000003   8B83         MOV     DPH,R3
   \   000005   F0           MOVX    @DPTR,A
   \   000006   A3           INC     DPTR
   \   000007   0A           INC     R2
   \   000008   AB83         MOV     R3,DPH
   \   00000A   22           RET

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZllNotifyTL?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZllNotifyTL

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_ZllSendZCLCmd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_ZllSendZCLCmd
    163          
    164          /*********************************************************************
    165          *********************************************************************/

   Maximum stack usage in bytes:

   ISTACK PSTACK XSTACK Function
   ------ ------ ------ --------
       1      0     12  MT_ZllNotifyTL
                          0 0 12 -> MT_BuildAndSendZToolResponse
                          0 0 12 -> osal_mem_alloc
                          0 0 12 -> osal_mem_free
       1      0     31  MT_ZllSendZCLCmd
                          0 0 22 -> MT_BuildAndSendZToolResponse
                          0 0 22 -> osal_mem_alloc
                          0 0 22 -> osal_mem_free
                          0 0 25 -> osal_memcpy


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       6  ??MT_ZllNotifyTL?relay
       6  ??MT_ZllSendZCLCmd?relay
       5  ??Subroutine6_0
       6  ??Subroutine7_0
      11  ??Subroutine8_0
       1  ?Subroutine0
      16  ?Subroutine1
      14  ?Subroutine2
       1  ?Subroutine3
       8  ?Subroutine4
       1  ?Subroutine5
     119  MT_ZllNotifyTL
     295  MT_ZllSendZCLCmd

 
 477 bytes in segment BANKED_CODE
  12 bytes in segment BANK_RELAYS
 
 489 bytes of CODE memory

Errors: none
Warnings: none
