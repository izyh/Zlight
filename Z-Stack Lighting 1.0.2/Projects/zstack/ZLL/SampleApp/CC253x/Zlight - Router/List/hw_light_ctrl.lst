###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.20.2.41139 for 8051             27/May/2014  19:14:10 #
# Copyright 2004-2013 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#                                                                             #
#    Source file        =  D:\Texas Instruments\Z-Stack Lighting              #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\Source\Light\h #
#                          w_light_ctrl.c                                     #
#    Command line       =  -f "D:\Texas Instruments\Z-Stack Lighting          #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\Tools\CC2530DB\f8wRouter.cfg" (-DCPU32MHZ        #
#                          -DROOT=__near_func -DMAC_CFG_APP_PENDING_QUEUE=TRU #
#                          E -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8       #
#                          -DMAC_CFG_RX_MAX=5 -DRTR_NWK) -f "D:\Texas         #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\Tools\CC2530DB\f8wConfig.cfg" (-DZIGBEEPRO       #
#                          -DSECURE=1 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100    #
#                          -DREJOIN_POLL_RATE=440) -f "D:\Texas               #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\Tools\CC2530DB\f8wZCL.cfg" "D:\Texas             #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\Source\Light\h #
#                          w_light_ctrl.c" -D FEATURE_GREEN_POWER -D          #
#                          SECURE=1 -D TC_LINKKEY_JOIN -D                     #
#                          ZDSECMGR_TC_DEVICE_MAX=2 -D NV_RESTORE -D          #
#                          HOLD_AUTO_START -D INTER_PAN -D                    #
#                          LCD_SUPPORTED=DEBUG -D ZCL_BASIC -D ZCL_READ -D    #
#                          ZCL_WRITE -D ZCL_IDENTIFY -D ZCL_ON_OFF -D         #
#                          ZCL_SCENES -D ZCL_GROUPS -D                        #
#                          ZCL_LIGHT_LINK_ENHANCE -D ZCL_LEVEL_CTRL -D        #
#                          ZCL_COLOR_CTRL -D MAX_CHANNELS_24GHZ=0x02108800    #
#                          -D xPWM_ALT2 -D xTHERMAL_SHUTDOWN -D               #
#                          ZLL_1_0_HUB_COMPATIBILITY -D DALI_LIGHT -lC        #
#                          "D:\Texas Instruments\Z-Stack Lighting             #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\Zlight  #
#                          - Router\List\" -lA "D:\Texas Instruments\Z-Stack  #
#                          Lighting 1.0.2\Projects\zstack\ZLL\SampleApp\CC253 #
#                          x\Zlight - Router\List\" --diag_suppress           #
#                          Pe001,Pa010 -o "D:\Texas Instruments\Z-Stack       #
#                          Lighting 1.0.2\Projects\zstack\ZLL\SampleApp\CC253 #
#                          x\Zlight - Router\Obj\" -e --debug --core=plain    #
#                          --dptr=16,1 --data_model=large                     #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I "D:\Texas                  #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\" -I    #
#                          "D:\Texas Instruments\Z-Stack Lighting             #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\Sour #
#                          ce\" -I "D:\Texas Instruments\Z-Stack Lighting     #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\S #
#                          ource\" -I "D:\Texas Instruments\Z-Stack Lighting  #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\HomeAutomation\Source\" -I "D:\Texas             #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\HomeAutomation\SampleLight\Source\" -I           #
#                          "D:\Texas Instruments\Z-Stack Lighting             #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\ZMain\TI2530DB\" -I "D:\Texas                    #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\hal\include\" -I "D:\Texas      #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\hal\target\CC2530PMP4712\" -I   #
#                          "D:\Texas Instruments\Z-Stack Lighting             #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\mac\include\" -I "D:\Texas      #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\mac\high_level\" -I "D:\Texas   #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\mac\low_level\srf04\" -I        #
#                          "D:\Texas Instruments\Z-Stack Lighting             #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\mac\low_level\srf04\single_chip #
#                          \" -I "D:\Texas Instruments\Z-Stack Lighting       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\mt\" -I "D:\Texas               #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\osal\include\" -I "D:\Texas     #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\services\saddr\" -I "D:\Texas   #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\services\sdata\" -I "D:\Texas   #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\af\" -I "D:\Texas         #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\nwk\" -I "D:\Texas        #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\sapi\" -I "D:\Texas       #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\sec\" -I "D:\Texas        #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\sys\" -I "D:\Texas        #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\zcl\" -I "D:\Texas        #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\stack\zdo\" -I "D:\Texas        #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\zmac\" -I "D:\Texas             #
#                          Instruments\Z-Stack Lighting                       #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\..\..\. #
#                          .\..\..\Components\zmac\f8w\" -Ohz                 #
#                          --require_prototypes                               #
#    List file          =  D:\Texas Instruments\Z-Stack Lighting              #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\Zlight  #
#                          - Router\List\hw_light_ctrl.lst                    #
#    Object file        =  D:\Texas Instruments\Z-Stack Lighting              #
#                          1.0.2\Projects\zstack\ZLL\SampleApp\CC253x\Zlight  #
#                          - Router\Obj\hw_light_ctrl.r51                     #
#                                                                             #
#                                                                             #
###############################################################################

D:\Texas Instruments\Z-Stack Lighting 1.0.2\Projects\zstack\ZLL\SampleApp\Source\Light\hw_light_ctrl.c
      1          /**************************************************************************************************
      2            Filename:       hw_light_ctrl.c
      3            Revised:        $Date: 2013-12-02 13:17:39 -0800 (Mon, 02 Dec 2013) $
      4            Revision:       $Revision: 36338 $
      5          
      6          
      7            Description:    Application physical lighting device control and color engine
      8                            demonstration, provided as a source for inspiration.
      9          
     10          
     11            Copyright 2011-2013 Texas Instruments Incorporated. All rights reserved.
     12          
     13            IMPORTANT: Your use of this Software is limited to those specific rights
     14            granted under the terms of a software license agreement between the user
     15            who downloaded the software, his/her employer (which must be your employer)
     16            and Texas Instruments Incorporated (the "License").  You may not use this
     17            Software unless you agree to abide by the terms of the License. The License
     18            limits your use, and you acknowledge, that the Software may not be modified,
     19            copied or distributed unless embedded on a Texas Instruments microcontroller
     20            or used solely and exclusively in conjunction with a Texas Instruments radio
     21            frequency transceiver, which is integrated into your product.  Other than for
     22            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     23            works of, modify, distribute, perform, display or sell this Software and/or
     24            its documentation for any purpose.
     25          
     26            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     27            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     28            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     29            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     30            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     31            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     32            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     33            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     34            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     35            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     36            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     37          
     38            Should you have any questions regarding your right to use this Software,
     39            contact Texas Instruments Incorporated at www.TI.com.
     40          **************************************************************************************************/
     41          
     42          /*********************************************************************
     43            This device will be like a Light device.  This application is not
     44            intended to be a Light device, but will use the device description
     45            to implement this sample code.
     46          *********************************************************************/
     47          
     48          /*********************************************************************
     49           * INCLUDES
     50           */
     51          #include "onboard.h"

   \                                 In  segment SFR_AN, at 0x80
   \   union <unnamed> volatile __sfr _A_P0
   \                     _A_P0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xf3
   \   unsigned char volatile __sfr P0SEL
   \                     P0SEL:
   \   000000                DS 1
     52          
     53          /* HAL */
     54          #include "hal_timer.h"
     55          //#include "hal_lcd.h"
     56          #include "hal_oled.h"
     57          #include "hal_led.h"
     58          
     59          #ifdef ZCL_COLOR_CTRL
     60          #include "hueToXyTable.c"

   \                                 In  segment CODE_C, align 1
   \   unsigned short const __code hueToX[256]
   \                     hueToX:
   \   000000   FFBF         DW 49151
   \   000002   F6BD         DW 48630
   \   000004   EEBB         DW 48110
   \   000006   E5B9         DW 47589
   \   000008   DDB7         DW 47069
   \   00000A   D4B5         DW 46548
   \   00000C   CCB3         DW 46028
   \   00000E   C4B1         DW 45508
   \   000010   BBAF         DW 44987
   \   000012   B3AD         DW 44467
   \   000014   AAAB         DW 43946
   \   000016   A2A9         DW 43426
   \   000018   99A7         DW 42905
   \   00001A   91A5         DW 42385
   \   00001C   89A3         DW 41865
   \   00001E   80A1         DW 41344
   \   000020   789F         DW 40824
   \   000022   6F9D         DW 40303
   \   000024   679B         DW 39783
   \   000026   5E99         DW 39262
   \   000028   5697         DW 38742
   \   00002A   4E95         DW 38222
   \   00002C   4593         DW 37701
   \   00002E   3D91         DW 37181
   \   000030   348F         DW 36660
   \   000032   2C8D         DW 36140
   \   000034   248B         DW 35620
   \   000036   1B89         DW 35099
   \   000038   1387         DW 34579
   \   00003A   0A85         DW 34058
   \   00003C   0283         DW 33538
   \   00003E   F980         DW 33017
   \   000040   F17E         DW 32497
   \   000042   E97C         DW 31977
   \   000044   E07A         DW 31456
   \   000046   D878         DW 30936
   \   000048   CF76         DW 30415
   \   00004A   C774         DW 29895
   \   00004C   BE72         DW 29374
   \   00004E   B670         DW 28854
   \   000050   AE6E         DW 28334
   \   000052   A56C         DW 27813
   \   000054   9D6A         DW 27293
   \   000056   9468         DW 26772
   \   000058   8C66         DW 26252
   \   00005A   8364         DW 25731
   \   00005C   7B62         DW 25211
   \   00005E   7360         DW 24691
   \   000060   6A5E         DW 24170
   \   000062   625C         DW 23650
   \   000064   595A         DW 23129
   \   000066   5158         DW 22609
   \   000068   4956         DW 22089
   \   00006A   4054         DW 21568
   \   00006C   3852         DW 21048
   \   00006E   2F50         DW 20527
   \   000070   274E         DW 20007
   \   000072   1E4C         DW 19486
   \   000074   164A         DW 18966
   \   000076   0E48         DW 18446
   \   000078   0546         DW 17925
   \   00007A   FD43         DW 17405
   \   00007C   F441         DW 16884
   \   00007E   EC3F         DW 16364
   \   000080   E33D         DW 15843
   \   000082   DB3B         DW 15323
   \   000084   D339         DW 14803
   \   000086   CA37         DW 14282
   \   000088   C235         DW 13762
   \   00008A   B933         DW 13241
   \   00008C   B131         DW 12721
   \   00008E   A82F         DW 12200
   \   000090   A02D         DW 11680
   \   000092   982B         DW 11160
   \   000094   8F29         DW 10639
   \   000096   8727         DW 10119
   \   000098   7E25         DW 9598
   \   00009A   7623         DW 9078
   \   00009C   6E21         DW 8558
   \   00009E   651F         DW 8037
   \   0000A0   5D1D         DW 7517
   \   0000A2   541B         DW 6996
   \   0000A4   4C19         DW 6476
   \   0000A6   4317         DW 5955
   \   0000A8   3313         DW 4915
   \   0000AA   5D13         DW 4957
   \   0000AC   8713         DW 4999
   \   0000AE   B213         DW 5042
   \   0000B0   DC13         DW 5084
   \   0000B2   0614         DW 5126
   \   0000B4   3114         DW 5169
   \   0000B6   5B14         DW 5211
   \   0000B8   8614         DW 5254
   \   0000BA   B014         DW 5296
   \   0000BC   DA14         DW 5338
   \   0000BE   0515         DW 5381
   \   0000C0   2F15         DW 5423
   \   0000C2   5A15         DW 5466
   \   0000C4   8415         DW 5508
   \   0000C6   AE15         DW 5550
   \   0000C8   D915         DW 5593
   \   0000CA   0316         DW 5635
   \   0000CC   2E16         DW 5678
   \   0000CE   5816         DW 5720
   \   0000D0   8216         DW 5762
   \   0000D2   AD16         DW 5805
   \   0000D4   D716         DW 5847
   \   0000D6   0217         DW 5890
   \   0000D8   2C17         DW 5932
   \   0000DA   5617         DW 5974
   \   0000DC   8117         DW 6017
   \   0000DE   AB17         DW 6059
   \   0000E0   D617         DW 6102
   \   0000E2   0018         DW 6144
   \   0000E4   2A18         DW 6186
   \   0000E6   5518         DW 6229
   \   0000E8   7F18         DW 6271
   \   0000EA   AA18         DW 6314
   \   0000EC   D418         DW 6356
   \   0000EE   FE18         DW 6398
   \   0000F0   2919         DW 6441
   \   0000F2   5319         DW 6483
   \   0000F4   7E19         DW 6526
   \   0000F6   A819         DW 6568
   \   0000F8   D219         DW 6610
   \   0000FA   FD19         DW 6653
   \   0000FC   271A         DW 6695
   \   0000FE   521A         DW 6738
   \   000100   7C1A         DW 6780
   \   000102   A61A         DW 6822
   \   000104   D11A         DW 6865
   \   000106   FB1A         DW 6907
   \   000108   261B         DW 6950
   \   00010A   501B         DW 6992
   \   00010C   7A1B         DW 7034
   \   00010E   A51B         DW 7077
   \   000110   CF1B         DW 7119
   \   000112   FA1B         DW 7162
   \   000114   241C         DW 7204
   \   000116   4E1C         DW 7246
   \   000118   791C         DW 7289
   \   00011A   A31C         DW 7331
   \   00011C   CE1C         DW 7374
   \   00011E   F81C         DW 7416
   \   000120   221D         DW 7458
   \   000122   4D1D         DW 7501
   \   000124   771D         DW 7543
   \   000126   A21D         DW 7586
   \   000128   CC1D         DW 7628
   \   00012A   F61D         DW 7670
   \   00012C   211E         DW 7713
   \   00012E   4B1E         DW 7755
   \   000130   761E         DW 7798
   \   000132   A01E         DW 7840
   \   000134   CA1E         DW 7882
   \   000136   F51E         DW 7925
   \   000138   1F1F         DW 7967
   \   00013A   4A1F         DW 8010
   \   00013C   741F         DW 8052
   \   00013E   9E1F         DW 8094
   \   000140   C91F         DW 8137
   \   000142   F31F         DW 8179
   \   000144   1E20         DW 8222
   \   000146   4820         DW 8264
   \   000148   7220         DW 8306
   \   00014A   9D20         DW 8349
   \   00014C   C720         DW 8391
   \   00014E   F220         DW 8434
   \   000150   4721         DW 8519
   \   000152   2523         DW 8997
   \   000154   0325         DW 9475
   \   000156   E126         DW 9953
   \   000158   BF28         DW 10431
   \   00015A   9D2A         DW 10909
   \   00015C   7B2C         DW 11387
   \   00015E   592E         DW 11865
   \   000160   3730         DW 12343
   \   000162   1532         DW 12821
   \   000164   F333         DW 13299
   \   000166   D135         DW 13777
   \   000168   AF37         DW 14255
   \   00016A   8D39         DW 14733
   \   00016C   6B3B         DW 15211
   \   00016E   493D         DW 15689
   \   000170   273F         DW 16167
   \   000172   0541         DW 16645
   \   000174   E342         DW 17123
   \   000176   C144         DW 17601
   \   000178   9F46         DW 18079
   \   00017A   7D48         DW 18557
   \   00017C   5B4A         DW 19035
   \   00017E   394C         DW 19513
   \   000180   174E         DW 19991
   \   000182   F54F         DW 20469
   \   000184   D351         DW 20947
   \   000186   B153         DW 21425
   \   000188   8F55         DW 21903
   \   00018A   6D57         DW 22381
   \   00018C   4B59         DW 22859
   \   00018E   295B         DW 23337
   \   000190   075D         DW 23815
   \   000192   E55E         DW 24293
   \   000194   C360         DW 24771
   \   000196   A162         DW 25249
   \   000198   7F64         DW 25727
   \   00019A   5D66         DW 26205
   \   00019C   3B68         DW 26683
   \   00019E   196A         DW 27161
   \   0001A0   F76B         DW 27639
   \   0001A2   D56D         DW 28117
   \   0001A4   B36F         DW 28595
   \   0001A6   9271         DW 29074
   \   0001A8   7073         DW 29552
   \   0001AA   4E75         DW 30030
   \   0001AC   2C77         DW 30508
   \   0001AE   0A79         DW 30986
   \   0001B0   E87A         DW 31464
   \   0001B2   C67C         DW 31942
   \   0001B4   A47E         DW 32420
   \   0001B6   8280         DW 32898
   \   0001B8   6082         DW 33376
   \   0001BA   3E84         DW 33854
   \   0001BC   1C86         DW 34332
   \   0001BE   FA87         DW 34810
   \   0001C0   D889         DW 35288
   \   0001C2   B68B         DW 35766
   \   0001C4   948D         DW 36244
   \   0001C6   728F         DW 36722
   \   0001C8   5091         DW 37200
   \   0001CA   2E93         DW 37678
   \   0001CC   0C95         DW 38156
   \   0001CE   EA96         DW 38634
   \   0001D0   C898         DW 39112
   \   0001D2   A69A         DW 39590
   \   0001D4   849C         DW 40068
   \   0001D6   629E         DW 40546
   \   0001D8   40A0         DW 41024
   \   0001DA   1EA2         DW 41502
   \   0001DC   FCA3         DW 41980
   \   0001DE   DAA5         DW 42458
   \   0001E0   B8A7         DW 42936
   \   0001E2   96A9         DW 43414
   \   0001E4   74AB         DW 43892
   \   0001E6   52AD         DW 44370
   \   0001E8   30AF         DW 44848
   \   0001EA   0EB1         DW 45326
   \   0001EC   ECB2         DW 45804
   \   0001EE   CAB4         DW 46282
   \   0001F0   A8B6         DW 46760
   \   0001F2   86B8         DW 47238
   \   0001F4   64BA         DW 47716
   \   0001F6   42BC         DW 48194
   \   0001F8   20BE         DW 48672
   \   0001FA   C9BE         DW 48841
   \   0001FC   72BF         DW 49010
   \   0001FE   FFBF         DW 49151

   \                                 In  segment CODE_C, align 1
   \   unsigned short const __code hueToY[256]
   \                     hueToY:
   \   000000   FF3F         DW 16383
   \   000002   A741         DW 16807
   \   000004   4F43         DW 17231
   \   000006   F744         DW 17655
   \   000008   9F46         DW 18079
   \   00000A   4748         DW 18503
   \   00000C   EF49         DW 18927
   \   00000E   974B         DW 19351
   \   000010   3F4D         DW 19775
   \   000012   E74E         DW 20199
   \   000014   8F50         DW 20623
   \   000016   3752         DW 21047
   \   000018   DF53         DW 21471
   \   00001A   8755         DW 21895
   \   00001C   2F57         DW 22319
   \   00001E   D758         DW 22743
   \   000020   7F5A         DW 23167
   \   000022   275C         DW 23591
   \   000024   D05D         DW 24016
   \   000026   785F         DW 24440
   \   000028   2061         DW 24864
   \   00002A   C862         DW 25288
   \   00002C   7064         DW 25712
   \   00002E   1866         DW 26136
   \   000030   C067         DW 26560
   \   000032   6869         DW 26984
   \   000034   106B         DW 27408
   \   000036   B86C         DW 27832
   \   000038   606E         DW 28256
   \   00003A   0870         DW 28680
   \   00003C   B071         DW 29104
   \   00003E   5873         DW 29528
   \   000040   0075         DW 29952
   \   000042   A876         DW 30376
   \   000044   5078         DW 30800
   \   000046   F979         DW 31225
   \   000048   A17B         DW 31649
   \   00004A   497D         DW 32073
   \   00004C   F17E         DW 32497
   \   00004E   9980         DW 32921
   \   000050   4182         DW 33345
   \   000052   E983         DW 33769
   \   000054   9185         DW 34193
   \   000056   3987         DW 34617
   \   000058   E188         DW 35041
   \   00005A   898A         DW 35465
   \   00005C   318C         DW 35889
   \   00005E   D98D         DW 36313
   \   000060   818F         DW 36737
   \   000062   2991         DW 37161
   \   000064   D192         DW 37585
   \   000066   7994         DW 38009
   \   000068   2296         DW 38434
   \   00006A   CA97         DW 38858
   \   00006C   7299         DW 39282
   \   00006E   1A9B         DW 39706
   \   000070   C29C         DW 40130
   \   000072   6A9E         DW 40554
   \   000074   12A0         DW 40978
   \   000076   BAA1         DW 41402
   \   000078   62A3         DW 41826
   \   00007A   0AA5         DW 42250
   \   00007C   B2A6         DW 42674
   \   00007E   5AA8         DW 43098
   \   000080   02AA         DW 43522
   \   000082   AAAB         DW 43946
   \   000084   52AD         DW 44370
   \   000086   FAAE         DW 44794
   \   000088   A2B0         DW 45218
   \   00008A   4BB2         DW 45643
   \   00008C   F3B3         DW 46067
   \   00008E   9BB5         DW 46491
   \   000090   43B7         DW 46915
   \   000092   EBB8         DW 47339
   \   000094   93BA         DW 47763
   \   000096   3BBC         DW 48187
   \   000098   E3BD         DW 48611
   \   00009A   8BBF         DW 49035
   \   00009C   33C1         DW 49459
   \   00009E   DBC2         DW 49883
   \   0000A0   83C4         DW 50307
   \   0000A2   2BC6         DW 50731
   \   0000A4   D3C7         DW 51155
   \   0000A6   7BC9         DW 51579
   \   0000A8   CCCC         DW 52428
   \   0000AA   7ACA         DW 51834
   \   0000AC   28C8         DW 51240
   \   0000AE   D6C5         DW 50646
   \   0000B0   85C3         DW 50053
   \   0000B2   33C1         DW 49459
   \   0000B4   E1BE         DW 48865
   \   0000B6   90BC         DW 48272
   \   0000B8   3EBA         DW 47678
   \   0000BA   ECB7         DW 47084
   \   0000BC   9BB5         DW 46491
   \   0000BE   49B3         DW 45897
   \   0000C0   F7B0         DW 45303
   \   0000C2   A6AE         DW 44710
   \   0000C4   54AC         DW 44116
   \   0000C6   02AA         DW 43522
   \   0000C8   B1A7         DW 42929
   \   0000CA   5FA5         DW 42335
   \   0000CC   0DA3         DW 41741
   \   0000CE   BCA0         DW 41148
   \   0000D0   6A9E         DW 40554
   \   0000D2   189C         DW 39960
   \   0000D4   C799         DW 39367
   \   0000D6   7597         DW 38773
   \   0000D8   2395         DW 38179
   \   0000DA   D292         DW 37586
   \   0000DC   8090         DW 36992
   \   0000DE   2E8E         DW 36398
   \   0000E0   DD8B         DW 35805
   \   0000E2   8B89         DW 35211
   \   0000E4   3987         DW 34617
   \   0000E6   E884         DW 34024
   \   0000E8   9682         DW 33430
   \   0000EA   4480         DW 32836
   \   0000EC   F37D         DW 32243
   \   0000EE   A17B         DW 31649
   \   0000F0   4F79         DW 31055
   \   0000F2   FE76         DW 30462
   \   0000F4   AC74         DW 29868
   \   0000F6   5A72         DW 29274
   \   0000F8   0970         DW 28681
   \   0000FA   B76D         DW 28087
   \   0000FC   656B         DW 27493
   \   0000FE   1469         DW 26900
   \   000100   C266         DW 26306
   \   000102   7064         DW 25712
   \   000104   1F62         DW 25119
   \   000106   CD5F         DW 24525
   \   000108   7B5D         DW 23931
   \   00010A   2A5B         DW 23338
   \   00010C   D858         DW 22744
   \   00010E   8656         DW 22150
   \   000110   3554         DW 21557
   \   000112   E351         DW 20963
   \   000114   914F         DW 20369
   \   000116   404D         DW 19776
   \   000118   EE4A         DW 19182
   \   00011A   9C48         DW 18588
   \   00011C   4B46         DW 17995
   \   00011E   F943         DW 17401
   \   000120   A741         DW 16807
   \   000122   563F         DW 16214
   \   000124   043D         DW 15620
   \   000126   B23A         DW 15026
   \   000128   6138         DW 14433
   \   00012A   0F36         DW 13839
   \   00012C   BD33         DW 13245
   \   00012E   6C31         DW 12652
   \   000130   1A2F         DW 12058
   \   000132   C82C         DW 11464
   \   000134   772A         DW 10871
   \   000136   2528         DW 10277
   \   000138   D325         DW 9683
   \   00013A   8223         DW 9090
   \   00013C   3021         DW 8496
   \   00013E   DE1E         DW 7902
   \   000140   8D1C         DW 7309
   \   000142   3B1A         DW 6715
   \   000144   E917         DW 6121
   \   000146   9715         DW 5527
   \   000148   4613         DW 4934
   \   00014A   F410         DW 4340
   \   00014C   A20E         DW 3746
   \   00014E   510C         DW 3153
   \   000150   AE07         DW 1966
   \   000152   5708         DW 2135
   \   000154   0109         DW 2305
   \   000156   AA09         DW 2474
   \   000158   540A         DW 2644
   \   00015A   FE0A         DW 2814
   \   00015C   A70B         DW 2983
   \   00015E   510C         DW 3153
   \   000160   FA0C         DW 3322
   \   000162   A40D         DW 3492
   \   000164   4E0E         DW 3662
   \   000166   F70E         DW 3831
   \   000168   A10F         DW 4001
   \   00016A   4A10         DW 4170
   \   00016C   F410         DW 4340
   \   00016E   9E11         DW 4510
   \   000170   4712         DW 4679
   \   000172   F112         DW 4849
   \   000174   9B13         DW 5019
   \   000176   4414         DW 5188
   \   000178   EE14         DW 5358
   \   00017A   9715         DW 5527
   \   00017C   4116         DW 5697
   \   00017E   EB16         DW 5867
   \   000180   9417         DW 6036
   \   000182   3E18         DW 6206
   \   000184   E718         DW 6375
   \   000186   9119         DW 6545
   \   000188   3B1A         DW 6715
   \   00018A   E41A         DW 6884
   \   00018C   8E1B         DW 7054
   \   00018E   371C         DW 7223
   \   000190   E11C         DW 7393
   \   000192   8B1D         DW 7563
   \   000194   341E         DW 7732
   \   000196   DE1E         DW 7902
   \   000198   881F         DW 8072
   \   00019A   3120         DW 8241
   \   00019C   DB20         DW 8411
   \   00019E   8421         DW 8580
   \   0001A0   2E22         DW 8750
   \   0001A2   D822         DW 8920
   \   0001A4   8123         DW 9089
   \   0001A6   2B24         DW 9259
   \   0001A8   D424         DW 9428
   \   0001AA   7E25         DW 9598
   \   0001AC   2826         DW 9768
   \   0001AE   D126         DW 9937
   \   0001B0   7B27         DW 10107
   \   0001B2   2428         DW 10276
   \   0001B4   CE28         DW 10446
   \   0001B6   7829         DW 10616
   \   0001B8   212A         DW 10785
   \   0001BA   CB2A         DW 10955
   \   0001BC   752B         DW 11125
   \   0001BE   1E2C         DW 11294
   \   0001C0   C82C         DW 11464
   \   0001C2   712D         DW 11633
   \   0001C4   1B2E         DW 11803
   \   0001C6   C52E         DW 11973
   \   0001C8   6E2F         DW 12142
   \   0001CA   1830         DW 12312
   \   0001CC   C130         DW 12481
   \   0001CE   6B31         DW 12651
   \   0001D0   1532         DW 12821
   \   0001D2   BE32         DW 12990
   \   0001D4   6833         DW 13160
   \   0001D6   1134         DW 13329
   \   0001D8   BB34         DW 13499
   \   0001DA   6535         DW 13669
   \   0001DC   0E36         DW 13838
   \   0001DE   B836         DW 14008
   \   0001E0   6237         DW 14178
   \   0001E2   0B38         DW 14347
   \   0001E4   B538         DW 14517
   \   0001E6   5E39         DW 14686
   \   0001E8   083A         DW 14856
   \   0001EA   B23A         DW 15026
   \   0001EC   5B3B         DW 15195
   \   0001EE   053C         DW 15365
   \   0001F0   AE3C         DW 15534
   \   0001F2   583D         DW 15704
   \   0001F4   023E         DW 15874
   \   0001F6   AB3E         DW 16043
   \   0001F8   553F         DW 16213
   \   0001FA   FE3F         DW 16382
   \   0001FC   FD3F         DW 16381
   \   0001FE   FF3F         DW 16383
     61          #include "zcl_color_ctrl.h"
     62          #endif //ZCL_COLOR_CTRL
     63          
     64          #include "hw_light_ctrl.h"
     65          #include "zll_samplelight.h"
     66          
     67          #include "math.h"
     68          
     69          
     70          /*********************************************************************
     71           * MACROS
     72           */
     73          #define WHITE_POINT_X 0x5000
     74          #define WHITE_POINT_Y 0x5555
     75          
     76          #define MAX3(a,b,c) (((a) > (b)) ? ( ((a) > (c)) ? (a) : (c) ) : ( ((b) > (c)) ? (b) : (c) ))
     77          #define MIN3(a,b,c) (((a) > (b)) ? ( ((b) > (c)) ? (c) : (b) ) : ( ((a) > (c)) ? (c) : (a) ))
     78          #define DISTANCE(a,b)  (((a) > (b)) ? ((a) - (b)) : ((b)-(a)))
     79          
     80          /*********************************************************************
     81           * CONSTANTS
     82           */
     83          #define GAMMA_VALUE 2
     84          
     85          /*********************************************************************
     86           * TYPEDEFS
     87           */
     88          
     89          /*********************************************************************
     90           * GLOBAL VARIABLES
     91           */
     92          
     93          /*********************************************************************
     94           * GLOBAL FUNCTIONS
     95           */
     96          
     97          /*********************************************************************
     98           * LOCAL VARIABLES
     99           */
    100          
    101          /*********************************************************************
    102           * LOCAL FUNCTIONS
    103           */
    104          #ifdef ZCL_COLOR_CTRL
    105          static void hwLight_UpdateColor(void);
    106          static uint8 hwLight_XyToSat(uint16 x, uint16 y, uint8 hue);
    107          static void hwLight_satToXy(uint16 *x, uint16 *y, uint8 sat);
    108          #ifdef ZLL_HW_LED_LAMP
    109          static void hwLight_Convert_xyY_to_RGB(float x, float y, float Y, uint16 *R, uint16 *G,uint16 *B);
    110          static void hwLight_GammaCorrectRGB(float *R, float *G, float *B);
    111          static void hwLight_TempCompensateRGB(float *R, float *G, float *B);
    112          static void hwLight_TempCompensateRGB(float *R, float *G, float *B);
    113          static void hwLight_GroupWaveLenCompensateRGB(float *R, float *G, float *B);
    114          static void hwLight_GroupLuminCompensateRGB(float *R, float *G, float *B);
    115          static void hwLight_RGB_to_RGBW( uint16 *R, uint16 *G, uint16 *B, uint16 *W );
    116          static void hwLight_UpdateLampColor( uint16 colorX, uint16 colorY, uint8 level);
    117          #endif //ZLL_HW_LED_LAMP
    118          #else  //ZCL_COLOR_CTRL
    119          #ifdef ZCL_LEVEL_CTRL
    120          static void hwLight_UpdateLevel( uint8 level );
    121          #endif //ZCL_LEVEL_CTRL
    122          #endif //ZCL_COLOR_CTRL
    123          
    124          #ifdef ZCL_COLOR_CTRL
    125          #ifdef ZLL_HW_LED_LAMP
    126          /*********************************************************************
    127          * @fn      zclSimpleLight_UpdateLampColor()
    128          *
    129          * @brief   Update color and level of lamp
    130          *
    131          * @param   ColorX, ColorY 0... 0xFFFF, level 0...0xFF
    132          *
    133          * @return  none
    134          */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    135          static void hwLight_UpdateLampColor( uint16 colorX, uint16 colorY, uint8 level)
   \                     hwLight_UpdateLampColor:
    136          {
   \   000000   74F0         MOV     A,#-0x10
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 16
   \   000005                ; Auto size: 8
   \   000005   74F8         MOV     A,#-0x8
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
    137            uint16 redP, greenP, blueP, whiteP;
    138          
    139            hwLight_Convert_xyY_to_RGB((float)colorX/0xFFFF, (float)colorY/0xFFFF, (float) level*(100/(float)0xFF),
    140                               &redP, &greenP, &blueP);
   \   00000C                ; Setup parameters for call to function hwLight_Convert_xyY_to_RGB
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   8582..       MOV     ?V0 + 0,DPL
   \   000015   8583..       MOV     ?V0 + 1,DPH
   \   000018   78..         MOV     R0,#?V0 + 0
   \   00001A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00001D   7404         MOV     A,#0x4
   \   00001F   12....       LCALL   ?XSTACK_DISP0_8
   \   000022   8582..       MOV     ?V0 + 0,DPL
   \   000025   8583..       MOV     ?V0 + 1,DPH
   \   000028   78..         MOV     R0,#?V0 + 0
   \   00002A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002D   7408         MOV     A,#0x8
   \   00002F   12....       LCALL   ?XSTACK_DISP0_8
   \   000032   8582..       MOV     ?V0 + 0,DPL
   \   000035   8583..       MOV     ?V0 + 1,DPH
   \   000038   78..         MOV     R0,#?V0 + 0
   \   00003A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003D   8E..         MOV     ?V0 + 0,R6
   \   00003F   E4           CLR     A
   \   000040   F5..         MOV     ?V0 + 1,A
   \   000042   F5..         MOV     ?V0 + 2,A
   \   000044   F5..         MOV     ?V0 + 3,A
   \   000046   78..         MOV     R0,#?V0 + 0
   \   000048   12....       LCALL   ?UL_TO_FLT
   \   00004B   90....       MOV     DPTR,#__Constant_3ec8c8c9
   \   00004E   78..         MOV     R0,#?V0 + 4
   \   000050   12....       LCALL   ?L_MOV_X
   \   000053   78..         MOV     R0,#?V0 + 0
   \   000055   79..         MOV     R1,#?V0 + 4
   \   000057   12....       LCALL   ?FLT_MUL
   \   00005A   78..         MOV     R0,#?V0 + 0
   \   00005C   12....       LCALL   ?PUSH_XSTACK_I_FOUR
   \   00005F   8C..         MOV     ?V0 + 0,R4
   \   000061   8D..         MOV     ?V0 + 1,R5
   \   000063   E4           CLR     A
   \   000064   F5..         MOV     ?V0 + 2,A
   \   000066   F5..         MOV     ?V0 + 3,A
   \   000068   78..         MOV     R0,#?V0 + 0
   \   00006A   12....       LCALL   ?UL_TO_FLT
   \   00006D   90....       MOV     DPTR,#__Constant_477fff00
   \   000070   78..         MOV     R0,#?V0 + 4
   \   000072   12....       LCALL   ?L_MOV_X
   \   000075   78..         MOV     R0,#?V0 + 0
   \   000077   79..         MOV     R1,#?V0 + 4
   \   000079   12....       LCALL   ?FLT_DIV
   \   00007C   78..         MOV     R0,#?V0 + 0
   \   00007E   12....       LCALL   ?PUSH_XSTACK_I_FOUR
   \   000081   8A..         MOV     ?V0 + 0,R2
   \   000083   8B..         MOV     ?V0 + 1,R3
   \   000085   E4           CLR     A
   \   000086   F5..         MOV     ?V0 + 2,A
   \   000088   F5..         MOV     ?V0 + 3,A
   \   00008A   78..         MOV     R0,#?V0 + 0
   \   00008C   12....       LCALL   ?UL_TO_FLT
   \   00008F   90....       MOV     DPTR,#__Constant_477fff00
   \   000092   78..         MOV     R0,#?V0 + 4
   \   000094   12....       LCALL   ?L_MOV_X
   \   000097   78..         MOV     R0,#?V0 + 0
   \   000099   79..         MOV     R1,#?V0 + 4
   \   00009B   12....       LCALL   ?FLT_DIV
   \   00009E   AA..         MOV     R2,?V0 + 0
   \   0000A0   AB..         MOV     R3,?V0 + 1
   \   0000A2   AC..         MOV     R4,?V0 + 2
   \   0000A4   AD..         MOV     R5,?V0 + 3
   \   0000A6   12....       LCALL   ??hwLight_Convert_xyY_to_RGB?relay
   \   0000A9   740E         MOV     A,#0xe
   \   0000AB   12....       LCALL   ?DEALLOC_XSTACK8
    141          
    142            hwLight_RGB_to_RGBW( &redP, &greenP, &blueP, &whiteP );
   \   0000AE                ; Setup parameters for call to function hwLight_RGB_to_RGBW
   \   0000AE   7406         MOV     A,#0x6
   \   0000B0   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B3   8582..       MOV     ?V0 + 0,DPL
   \   0000B6   8583..       MOV     ?V0 + 1,DPH
   \   0000B9   78..         MOV     R0,#?V0 + 0
   \   0000BB   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000BE   7402         MOV     A,#0x2
   \   0000C0   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C3   8582..       MOV     ?V0 + 0,DPL
   \   0000C6   8583..       MOV     ?V0 + 1,DPH
   \   0000C9   78..         MOV     R0,#?V0 + 0
   \   0000CB   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   0000CE   7406         MOV     A,#0x6
   \   0000D0   12....       LCALL   ?XSTACK_DISP0_8
   \   0000D3   AC82         MOV     R4,DPL
   \   0000D5   AD83         MOV     R5,DPH
   \   0000D7   7408         MOV     A,#0x8
   \   0000D9   12....       LCALL   ?XSTACK_DISP0_8
   \   0000DC   AA82         MOV     R2,DPL
   \   0000DE   AB83         MOV     R3,DPH
   \   0000E0   12....       LCALL   ??hwLight_RGB_to_RGBW?relay
   \   0000E3   7404         MOV     A,#0x4
   \   0000E5   12....       LCALL   ?DEALLOC_XSTACK8
    143          
    144            halTimer1SetChannelDuty (RED_LED,   redP);
   \   0000E8                ; Setup parameters for call to function halTimer1SetChannelDuty
   \   0000E8   7404         MOV     A,#0x4
   \   0000EA   12....       LCALL   ?XSTACK_DISP0_8
   \   0000ED   12....       LCALL   ??Subroutine34_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_56:
   \   0000F0   7901         MOV     R1,#0x1
   \   0000F2   12....       LCALL   ??halTimer1SetChannelDuty?relay
    145            halTimer1SetChannelDuty (GREEN_LED, greenP );
   \   0000F5                ; Setup parameters for call to function halTimer1SetChannelDuty
   \   0000F5   7402         MOV     A,#0x2
   \   0000F7   12....       LCALL   ?XSTACK_DISP0_8
   \   0000FA   12....       LCALL   ??Subroutine34_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_57:
   \   0000FD   7903         MOV     R1,#0x3
   \   0000FF   12....       LCALL   ??halTimer1SetChannelDuty?relay
    146            halTimer1SetChannelDuty (BLUE_LED,  blueP);
   \   000102                ; Setup parameters for call to function halTimer1SetChannelDuty
   \   000102   85..82       MOV     DPL,?XSP + 0
   \   000105   85..83       MOV     DPH,?XSP + 1
   \   000108   12....       LCALL   ??Subroutine34_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_58:
   \   00010B   7902         MOV     R1,#0x2
   \   00010D   12....       LCALL   ??halTimer1SetChannelDuty?relay
    147            halTimer1SetChannelDuty (WHITE_LED, whiteP);
   \   000110                ; Setup parameters for call to function halTimer1SetChannelDuty
   \   000110   7406         MOV     A,#0x6
   \   000112   12....       LCALL   ?XSTACK_DISP0_8
   \   000115   12....       LCALL   ??Subroutine34_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_59:
   \   000118   7904         MOV     R1,#0x4
   \   00011A   12....       LCALL   ??halTimer1SetChannelDuty?relay
    148          
    149          }
   \   00011D   7408         MOV     A,#0x8
   \   00011F   12....       LCALL   ?DEALLOC_XSTACK8
   \   000122   7F08         MOV     R7,#0x8
   \   000124   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine34_0:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   FA           MOV     R2,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   FB           MOV     R3,A
   \   000005   22           RET
    150          
    151          /*********************************************************************
    152          * @fn      hwLight_Convert_xyY_to_RGB
    153          *
    154          * @brief   Process ZCL Foundation incoming message
    155          *
    156          * input parameters
    157          *
    158          * @param  x - x value in xyY from 0 to 1
    159          * @param  y - y value in xyY from 0 to 1
    160          * @param  LinearY - Y value in xyY from 0 to 100
    161          *
    162          * output parameters
    163          *
    164          * @param  R - pointer to red value from 0 to PWM_FULL_DUTY_CYCLE
    165          * @param  G - pointer to green value from 0 to PWM_FULL_DUTY_CYCLE
    166          * @param  B - pointer to blue value from 0 to PWM_FULL_DUTY_CYCLE
    167          *
    168          * @return  none
    169          */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    170          void hwLight_Convert_xyY_to_RGB(float x, float y, float LinearY, uint16 *R, uint16 *G, uint16 *B)
   \                     hwLight_Convert_xyY_to_RGB:
    171          {
   \   000000   74E8         MOV     A,#-0x18
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 24
   \   000005                ; Auto size: 16
   \   000005   74F0         MOV     A,#-0x10
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   740C         MOV     A,#0xc
   \   00000C   12....       LCALL   ?XSTACK_DISP0_8
   \   00000F   EA           MOV     A,R2
   \   000010   F0           MOVX    @DPTR,A
   \   000011   A3           INC     DPTR
   \   000012   EB           MOV     A,R3
   \   000013   F0           MOVX    @DPTR,A
   \   000014   A3           INC     DPTR
   \   000015   EC           MOV     A,R4
   \   000016   F0           MOVX    @DPTR,A
   \   000017   A3           INC     DPTR
   \   000018   ED           MOV     A,R5
   \   000019   F0           MOVX    @DPTR,A
   \   00001A   742C         MOV     A,#0x2c
   \   00001C   12....       LCALL   ?XSTACK_DISP0_8
   \   00001F   78..         MOV     R0,#?V0 + 0
   \   000021   12....       LCALL   ?L_MOV_X
   \   000024   7434         MOV     A,#0x34
   \   000026   12....       LCALL   ?XSTACK_DISP0_8
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   FE           MOV     R6,A
   \   00002B   A3           INC     DPTR
   \   00002C   E0           MOVX    A,@DPTR
   \   00002D   FF           MOV     R7,A
    172            float Y;
    173            float X;
    174            float Z;
    175            float f_R;
    176            float f_G;
    177            float f_B;
    178          
    179            //gamma correct the level
    180            Y = pow( ( LinearY / LEVEL_MAX ), (float)GAMMA_VALUE ) * (float)LEVEL_MAX;
   \   00002E   90....       MOV     DPTR,#__Constant_437e0000
   \   000031   78..         MOV     R0,#?V0 + 4
   \   000033   12....       LCALL   ?L_MOV_X
   \   000036   78..         MOV     R0,#?V0 + 0
   \   000038   79..         MOV     R1,#?V0 + 4
   \   00003A   12....       LCALL   ?FLT_DIV
   \   00003D   85....       MOV     ?V0 + 4,?V0 + 0
   \   000040   85....       MOV     ?V0 + 5,?V0 + 1
   \   000043   85....       MOV     ?V0 + 6,?V0 + 2
   \   000046   85....       MOV     ?V0 + 7,?V0 + 3
   \   000049   78..         MOV     R0,#?V0 + 4
   \   00004B   79..         MOV     R1,#?V0 + 0
   \   00004D   12....       LCALL   ?FLT_MUL
   \   000050   90....       MOV     DPTR,#__Constant_437e0000
   \   000053   78..         MOV     R0,#?V0 + 0
   \   000055   12....       LCALL   ?L_MOV_X
   \   000058   78..         MOV     R0,#?V0 + 4
   \   00005A   79..         MOV     R1,#?V0 + 0
   \   00005C   12....       LCALL   ?FLT_MUL
   \   00005F   85..82       MOV     DPL,?XSP + 0
   \   000062   85..83       MOV     DPH,?XSP + 1
   \   000065   78..         MOV     R0,#?V0 + 4
   \   000067   12....       LCALL   ?L_MOV_TO_X
   \   00006A   7428         MOV     A,#0x28
   \   00006C   12....       LCALL   ?XSTACK_DISP0_8
   \   00006F   78..         MOV     R0,#?V0 + 4
   \   000071   12....       LCALL   ?L_MOV_X
    181          
    182          
    183            // from xyY to XYZ
    184            if (y != 0)
   \   000074   90....       MOV     DPTR,#__Constant_0
   \   000077   78..         MOV     R0,#?V0 + 0
   \   000079   12....       LCALL   ?L_MOV_X
   \   00007C   78..         MOV     R0,#?V0 + 4
   \   00007E   79..         MOV     R1,#?V0 + 0
   \   000080   12....       LCALL   ?FLT_EQ
   \   000083   7003         JNZ     $+5
   \   000085   02....       LJMP    ??hwLight_Convert_xyY_to_RGB_0 & 0xFFFF
    185            {
    186              do
    187              {
    188                X = x * ( Y / y );
   \                     ??hwLight_Convert_xyY_to_RGB_1:
   \   000088   85..82       MOV     DPL,?XSP + 0
   \   00008B   85..83       MOV     DPH,?XSP + 1
   \   00008E   78..         MOV     R0,#?V0 + 0
   \   000090   12....       LCALL   ?L_MOV_X
   \   000093   78..         MOV     R0,#?V0 + 0
   \   000095   79..         MOV     R1,#?V0 + 4
   \   000097   12....       LCALL   ?FLT_DIV
   \   00009A   7408         MOV     A,#0x8
   \   00009C   12....       LCALL   ?XSTACK_DISP0_8
   \   00009F   78..         MOV     R0,#?V0 + 0
   \   0000A1   12....       LCALL   ?L_MOV_TO_X
   \   0000A4   7408         MOV     A,#0x8
   \   0000A6   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A9   78..         MOV     R0,#?V0 + 8
   \   0000AB   12....       LCALL   ?L_MOV_X
   \   0000AE   740C         MOV     A,#0xc
   \   0000B0   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B3   78..         MOV     R0,#?V0 + 0
   \   0000B5   12....       LCALL   ?L_MOV_X
   \   0000B8   78..         MOV     R0,#?V0 + 8
   \   0000BA   79..         MOV     R1,#?V0 + 0
   \   0000BC   12....       LCALL   ?FLT_MUL
    189                Z = ( 1 - x - y ) * ( Y / y );
   \   0000BF   75..00       MOV     ?V0 + 0,#0x0
   \   0000C2   75..00       MOV     ?V0 + 1,#0x0
   \   0000C5   75..80       MOV     ?V0 + 2,#-0x80
   \   0000C8   75..3F       MOV     ?V0 + 3,#0x3f
   \   0000CB   740C         MOV     A,#0xc
   \   0000CD   12....       LCALL   ?XSTACK_DISP0_8
   \   0000D0   78..         MOV     R0,#?V0 + 12
   \   0000D2   12....       LCALL   ?L_MOV_X
   \   0000D5   78..         MOV     R0,#?V0 + 0
   \   0000D7   79..         MOV     R1,#?V0 + 12
   \   0000D9   12....       LCALL   ?FLT_SUB
   \   0000DC   78..         MOV     R0,#?V0 + 0
   \   0000DE   79..         MOV     R1,#?V0 + 4
   \   0000E0   12....       LCALL   ?FLT_SUB
   \   0000E3   7408         MOV     A,#0x8
   \   0000E5   12....       LCALL   ?XSTACK_DISP0_8
   \   0000E8   78..         MOV     R0,#?V0 + 12
   \   0000EA   12....       LCALL   ?L_MOV_X
   \   0000ED   78..         MOV     R0,#?V0 + 0
   \   0000EF   79..         MOV     R1,#?V0 + 12
   \   0000F1   12....       LCALL   ?FLT_MUL
   \   0000F4   7404         MOV     A,#0x4
   \   0000F6   12....       LCALL   ?XSTACK_DISP0_8
   \   0000F9   78..         MOV     R0,#?V0 + 0
   \   0000FB   12....       LCALL   ?L_MOV_TO_X
    190              }
    191              while( ((X > 95.047) || (Z > 108.883)) && ((uint8)(Y--) > 0));
   \   0000FE   90....       MOV     DPTR,#__Constant_42be1811
   \   000101   78..         MOV     R0,#?V0 + 0
   \   000103   12....       LCALL   ?L_MOV_X
   \   000106   78..         MOV     R0,#?V0 + 8
   \   000108   79..         MOV     R1,#?V0 + 0
   \   00010A   12....       LCALL   ?FLT_GE
   \   00010D   401B         JC      ??hwLight_Convert_xyY_to_RGB_2
   \   00010F   7404         MOV     A,#0x4
   \   000111   12....       LCALL   ?XSTACK_DISP0_8
   \   000114   78..         MOV     R0,#?V0 + 12
   \   000116   12....       LCALL   ?L_MOV_X
   \   000119   90....       MOV     DPTR,#__Constant_42d9c41a
   \   00011C   78..         MOV     R0,#?V0 + 0
   \   00011E   12....       LCALL   ?L_MOV_X
   \   000121   78..         MOV     R0,#?V0 + 12
   \   000123   79..         MOV     R1,#?V0 + 0
   \   000125   12....       LCALL   ?FLT_GE
   \   000128   506A         JNC     ??hwLight_Convert_xyY_to_RGB_3
   \                     ??hwLight_Convert_xyY_to_RGB_2:
   \   00012A   85..82       MOV     DPL,?XSP + 0
   \   00012D   85..83       MOV     DPH,?XSP + 1
   \   000130   12....       LCALL   ?XLOAD_R2345
   \   000133   7408         MOV     A,#0x8
   \   000135   12....       LCALL   ?XSTACK_DISP0_8
   \   000138   12....       LCALL   ?XSTORE_R2345
   \   00013B   7408         MOV     A,#0x8
   \   00013D   12....       LCALL   ?XSTACK_DISP0_8
   \   000140   78..         MOV     R0,#?V0 + 12
   \   000142   12....       LCALL   ?L_MOV_X
   \   000145   90....       MOV     DPTR,#__Constant_bf800000
   \   000148   78..         MOV     R0,#?V0 + 0
   \   00014A   12....       LCALL   ?L_MOV_X
   \   00014D   78..         MOV     R0,#?V0 + 12
   \   00014F   79..         MOV     R1,#?V0 + 0
   \   000151   12....       LCALL   ?FLT_ADD
   \   000154   85..82       MOV     DPL,?XSP + 0
   \   000157   85..83       MOV     DPH,?XSP + 1
   \   00015A   78..         MOV     R0,#?V0 + 12
   \   00015C   12....       LCALL   ?L_MOV_TO_X
   \   00015F   7408         MOV     A,#0x8
   \   000161   12....       LCALL   ?XSTACK_DISP0_8
   \   000164   78..         MOV     R0,#?V0 + 0
   \   000166   12....       LCALL   ?L_MOV_X
   \   000169   78..         MOV     R0,#?V0 + 0
   \   00016B   12....       LCALL   ?FLT_TO_L
   \   00016E   E5..         MOV     A,?V0 + 0
   \   000170   6003         JZ      $+5
   \   000172   02....       LJMP    ??hwLight_Convert_xyY_to_RGB_1 & 0xFFFF
    192              // normalize variables:
    193              // X from 0 to 0.95047
    194              X = (X > 95.047 ? 95.047 : (X < 0 ? 0 : X));
   \   000175   90....       MOV     DPTR,#__Constant_42be1811
   \   000178   78..         MOV     R0,#?V0 + 0
   \   00017A   12....       LCALL   ?L_MOV_X
   \   00017D   78..         MOV     R0,#?V0 + 8
   \   00017F   79..         MOV     R1,#?V0 + 0
   \   000181   12....       LCALL   ?FLT_GE
   \   000184   500E         JNC     ??hwLight_Convert_xyY_to_RGB_3
   \   000186   75..10       MOV     ?V0 + 8,#0x10
   \   000189   75..18       MOV     ?V0 + 9,#0x18
   \   00018C   75..BE       MOV     ?V0 + 10,#-0x42
   \   00018F   75..42       MOV     ?V0 + 11,#0x42
   \   000192   801D         SJMP    ??hwLight_Convert_xyY_to_RGB_4
   \                     ??hwLight_Convert_xyY_to_RGB_3:
   \   000194   90....       MOV     DPTR,#__Constant_0
   \   000197   78..         MOV     R0,#?V0 + 0
   \   000199   12....       LCALL   ?L_MOV_X
   \   00019C   78..         MOV     R0,#?V0 + 8
   \   00019E   79..         MOV     R1,#?V0 + 0
   \   0001A0   12....       LCALL   ?FLT_LT
   \   0001A3   500C         JNC     ??hwLight_Convert_xyY_to_RGB_4
   \   0001A5   75..00       MOV     ?V0 + 8,#0x0
   \   0001A8   75..00       MOV     ?V0 + 9,#0x0
   \   0001AB   75..00       MOV     ?V0 + 10,#0x0
   \   0001AE   75..00       MOV     ?V0 + 11,#0x0
    195              X = X / 100;
   \                     ??hwLight_Convert_xyY_to_RGB_4:
   \   0001B1   90....       MOV     DPTR,#__Constant_42c80000
   \   0001B4   78..         MOV     R0,#?V0 + 0
   \   0001B6   12....       LCALL   ?L_MOV_X
   \   0001B9   78..         MOV     R0,#?V0 + 8
   \   0001BB   79..         MOV     R1,#?V0 + 0
   \   0001BD   12....       LCALL   ?FLT_DIV
    196              // Z from 0 to 1.08883
    197              Z = (Z > 108.883 ? 108.883 : (Z < 0 ? 0 : Z));
   \   0001C0   7404         MOV     A,#0x4
   \   0001C2   12....       LCALL   ?XSTACK_DISP0_8
   \   0001C5   78..         MOV     R0,#?V0 + 0
   \   0001C7   12....       LCALL   ?L_MOV_X
   \   0001CA   90....       MOV     DPTR,#__Constant_42d9c41a
   \   0001CD   78..         MOV     R0,#?V0 + 4
   \   0001CF   12....       LCALL   ?L_MOV_X
   \   0001D2   78..         MOV     R0,#?V0 + 0
   \   0001D4   79..         MOV     R1,#?V0 + 4
   \   0001D6   12....       LCALL   ?FLT_GE
   \   0001D9   7404         MOV     A,#0x4
   \   0001DB   5013         JNC     ??hwLight_Convert_xyY_to_RGB_5
   \   0001DD   12....       LCALL   ?XSTACK_DISP0_8
   \   0001E0   7419         MOV     A,#0x19
   \   0001E2   F0           MOVX    @DPTR,A
   \   0001E3   A3           INC     DPTR
   \   0001E4   74C4         MOV     A,#-0x3c
   \   0001E6   F0           MOVX    @DPTR,A
   \   0001E7   A3           INC     DPTR
   \   0001E8   74D9         MOV     A,#-0x27
   \   0001EA   F0           MOVX    @DPTR,A
   \   0001EB   A3           INC     DPTR
   \   0001EC   7442         MOV     A,#0x42
   \   0001EE   8021         SJMP    ??CrossCallReturnLabel_53
   \                     ??hwLight_Convert_xyY_to_RGB_5:
   \   0001F0   12....       LCALL   ?XSTACK_DISP0_8
   \   0001F3   78..         MOV     R0,#?V0 + 0
   \   0001F5   12....       LCALL   ?L_MOV_X
   \   0001F8   90....       MOV     DPTR,#__Constant_0
   \   0001FB   78..         MOV     R0,#?V0 + 4
   \   0001FD   12....       LCALL   ?L_MOV_X
   \   000200   78..         MOV     R0,#?V0 + 0
   \   000202   79..         MOV     R1,#?V0 + 4
   \   000204   12....       LCALL   ?FLT_LT
   \   000207   5009         JNC     ??hwLight_Convert_xyY_to_RGB_6
   \   000209   7404         MOV     A,#0x4
   \   00020B   12....       LCALL   ?XSTACK_DISP0_8
   \   00020E   12....       LCALL   ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_53:
   \   000211   F0           MOVX    @DPTR,A
    198              Z = Z / 100;
   \                     ??hwLight_Convert_xyY_to_RGB_6:
   \   000212   7404         MOV     A,#0x4
   \   000214   12....       LCALL   ?XSTACK_DISP0_8
   \   000217   78..         MOV     R0,#?V0 + 0
   \   000219   12....       LCALL   ?L_MOV_X
   \   00021C   90....       MOV     DPTR,#__Constant_42c80000
   \   00021F   78..         MOV     R0,#?V0 + 4
   \   000221   12....       LCALL   ?L_MOV_X
   \   000224   78..         MOV     R0,#?V0 + 0
   \   000226   79..         MOV     R1,#?V0 + 4
   \   000228   12....       LCALL   ?FLT_DIV
   \   00022B   7404         MOV     A,#0x4
   \   00022D   12....       LCALL   ?XSTACK_DISP0_8
   \   000230   78..         MOV     R0,#?V0 + 0
   \   000232   12....       LCALL   ?L_MOV_TO_X
   \   000235   8015         SJMP    ??hwLight_Convert_xyY_to_RGB_7
    199            }
    200            else
    201            {
    202              X = 0;
   \                     ??hwLight_Convert_xyY_to_RGB_0:
   \   000237   75..00       MOV     ?V0 + 8,#0x0
   \   00023A   75..00       MOV     ?V0 + 9,#0x0
   \   00023D   75..00       MOV     ?V0 + 10,#0x0
   \   000240   75..00       MOV     ?V0 + 11,#0x0
    203              Z = 0;
   \   000243   7404         MOV     A,#0x4
   \   000245   12....       LCALL   ?XSTACK_DISP0_8
   \   000248   12....       LCALL   ?Subroutine19 & 0xFFFF
    204            }
   \                     ??CrossCallReturnLabel_54:
   \   00024B   F0           MOVX    @DPTR,A
    205            // Y from 0 to 1
    206            Y = (Y > 100 ? 100 : (Y < 0 ? 0 : Y));
   \                     ??hwLight_Convert_xyY_to_RGB_7:
   \   00024C   85..82       MOV     DPL,?XSP + 0
   \   00024F   85..83       MOV     DPH,?XSP + 1
   \   000252   78..         MOV     R0,#?V0 + 0
   \   000254   12....       LCALL   ?L_MOV_X
   \   000257   90....       MOV     DPTR,#__Constant_42c80001
   \   00025A   78..         MOV     R0,#?V0 + 4
   \   00025C   12....       LCALL   ?L_MOV_X
   \   00025F   78..         MOV     R0,#?V0 + 0
   \   000261   79..         MOV     R1,#?V0 + 4
   \   000263   12....       LCALL   ?FLT_GE
   \   000266   85..82       MOV     DPL,?XSP + 0
   \   000269   85..83       MOV     DPH,?XSP + 1
   \   00026C   500D         JNC     ??hwLight_Convert_xyY_to_RGB_8
   \   00026E   E4           CLR     A
   \   00026F   F0           MOVX    @DPTR,A
   \   000270   A3           INC     DPTR
   \   000271   F0           MOVX    @DPTR,A
   \   000272   A3           INC     DPTR
   \   000273   74C8         MOV     A,#-0x38
   \   000275   F0           MOVX    @DPTR,A
   \   000276   A3           INC     DPTR
   \   000277   7442         MOV     A,#0x42
   \   000279   801F         SJMP    ??CrossCallReturnLabel_55
   \                     ??hwLight_Convert_xyY_to_RGB_8:
   \   00027B   78..         MOV     R0,#?V0 + 0
   \   00027D   12....       LCALL   ?L_MOV_X
   \   000280   90....       MOV     DPTR,#__Constant_0
   \   000283   78..         MOV     R0,#?V0 + 4
   \   000285   12....       LCALL   ?L_MOV_X
   \   000288   78..         MOV     R0,#?V0 + 0
   \   00028A   79..         MOV     R1,#?V0 + 4
   \   00028C   12....       LCALL   ?FLT_LT
   \   00028F   500A         JNC     ??hwLight_Convert_xyY_to_RGB_9
   \   000291   85..82       MOV     DPL,?XSP + 0
   \   000294   85..83       MOV     DPH,?XSP + 1
   \   000297   12....       LCALL   ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_55:
   \   00029A   F0           MOVX    @DPTR,A
    207            Y = Y / 100;
   \                     ??hwLight_Convert_xyY_to_RGB_9:
   \   00029B   85..82       MOV     DPL,?XSP + 0
   \   00029E   85..83       MOV     DPH,?XSP + 1
   \   0002A1   78..         MOV     R0,#?V0 + 0
   \   0002A3   12....       LCALL   ?L_MOV_X
   \   0002A6   90....       MOV     DPTR,#__Constant_42c80000
   \   0002A9   78..         MOV     R0,#?V0 + 4
   \   0002AB   12....       LCALL   ?L_MOV_X
   \   0002AE   78..         MOV     R0,#?V0 + 0
   \   0002B0   79..         MOV     R1,#?V0 + 4
   \   0002B2   12....       LCALL   ?FLT_DIV
   \   0002B5   85..82       MOV     DPL,?XSP + 0
   \   0002B8   85..83       MOV     DPH,?XSP + 1
   \   0002BB   78..         MOV     R0,#?V0 + 0
   \   0002BD   12....       LCALL   ?L_MOV_TO_X
    208          
    209            // transformation according to standard illuminant D65.
    210            f_R = X *  3.2406 + Y * -1.5372 + Z * -0.4986;
   \   0002C0   85....       MOV     ?V0 + 0,?V0 + 8
   \   0002C3   85....       MOV     ?V0 + 1,?V0 + 9
   \   0002C6   85....       MOV     ?V0 + 2,?V0 + 10
   \   0002C9   85....       MOV     ?V0 + 3,?V0 + 11
   \   0002CC   90....       MOV     DPTR,#__Constant_404f65fe
   \   0002CF   78..         MOV     R0,#?V0 + 4
   \   0002D1   12....       LCALL   ?L_MOV_X
   \   0002D4   78..         MOV     R0,#?V0 + 0
   \   0002D6   79..         MOV     R1,#?V0 + 4
   \   0002D8   12....       LCALL   ?FLT_MUL
   \   0002DB   85..82       MOV     DPL,?XSP + 0
   \   0002DE   85..83       MOV     DPH,?XSP + 1
   \   0002E1   78..         MOV     R0,#?V0 + 12
   \   0002E3   12....       LCALL   ?L_MOV_X
   \   0002E6   90....       MOV     DPTR,#__Constant_bfc4c2f8
   \   0002E9   78..         MOV     R0,#?V0 + 4
   \   0002EB   12....       LCALL   ?L_MOV_X
   \   0002EE   78..         MOV     R0,#?V0 + 12
   \   0002F0   79..         MOV     R1,#?V0 + 4
   \   0002F2   12....       LCALL   ?FLT_MUL
   \   0002F5   78..         MOV     R0,#?V0 + 0
   \   0002F7   79..         MOV     R1,#?V0 + 12
   \   0002F9   12....       LCALL   ?FLT_ADD
   \   0002FC   7404         MOV     A,#0x4
   \   0002FE   12....       LCALL   ?XSTACK_DISP0_8
   \   000301   78..         MOV     R0,#?V0 + 12
   \   000303   12....       LCALL   ?L_MOV_X
   \   000306   90....       MOV     DPTR,#__Constant_beff4880
   \   000309   78..         MOV     R0,#?V0 + 4
   \   00030B   12....       LCALL   ?L_MOV_X
   \   00030E   78..         MOV     R0,#?V0 + 12
   \   000310   79..         MOV     R1,#?V0 + 4
   \   000312   12....       LCALL   ?FLT_MUL
   \   000315   78..         MOV     R0,#?V0 + 0
   \   000317   79..         MOV     R1,#?V0 + 12
   \   000319   12....       LCALL   ?FLT_ADD
    211            f_G = X * -0.9689 + Y *  1.8758 + Z *  0.0415;
   \   00031C   85....       MOV     ?V0 + 4,?V0 + 8
   \   00031F   85....       MOV     ?V0 + 5,?V0 + 9
   \   000322   85....       MOV     ?V0 + 6,?V0 + 10
   \   000325   85....       MOV     ?V0 + 7,?V0 + 11
   \   000328   90....       MOV     DPTR,#__Constant_bf7809d5
   \   00032B   78..         MOV     R0,#?V0 + 12
   \   00032D   12....       LCALL   ?L_MOV_X
   \   000330   78..         MOV     R0,#?V0 + 4
   \   000332   79..         MOV     R1,#?V0 + 12
   \   000334   12....       LCALL   ?FLT_MUL
   \   000337   C0..         PUSH    ?V0 + 4
   \   000339   C0..         PUSH    ?V0 + 5
   \   00033B   C0..         PUSH    ?V0 + 6
   \   00033D   C0..         PUSH    ?V0 + 7
   \   00033F   85..82       MOV     DPL,?XSP + 0
   \   000342   85..83       MOV     DPH,?XSP + 1
   \   000345   78..         MOV     R0,#?V0 + 12
   \   000347   12....       LCALL   ?L_MOV_X
   \   00034A   90....       MOV     DPTR,#__Constant_3ff01a37
   \   00034D   78..         MOV     R0,#?V0 + 4
   \   00034F   12....       LCALL   ?L_MOV_X
   \   000352   78..         MOV     R0,#?V0 + 12
   \   000354   79..         MOV     R1,#?V0 + 4
   \   000356   12....       LCALL   ?FLT_MUL
   \   000359   D0..         POP     ?V0 + 7
   \   00035B   D0..         POP     ?V0 + 6
   \   00035D   D0..         POP     ?V0 + 5
   \   00035F   D0..         POP     ?V0 + 4
   \   000361   78..         MOV     R0,#?V0 + 4
   \   000363   79..         MOV     R1,#?V0 + 12
   \   000365   12....       LCALL   ?FLT_ADD
   \   000368   C0..         PUSH    ?V0 + 4
   \   00036A   C0..         PUSH    ?V0 + 5
   \   00036C   C0..         PUSH    ?V0 + 6
   \   00036E   C0..         PUSH    ?V0 + 7
   \   000370   7404         MOV     A,#0x4
   \   000372   12....       LCALL   ?XSTACK_DISP0_8
   \   000375   78..         MOV     R0,#?V0 + 12
   \   000377   12....       LCALL   ?L_MOV_X
   \   00037A   90....       MOV     DPTR,#__Constant_3d29fbe7
   \   00037D   78..         MOV     R0,#?V0 + 4
   \   00037F   12....       LCALL   ?L_MOV_X
   \   000382   78..         MOV     R0,#?V0 + 12
   \   000384   79..         MOV     R1,#?V0 + 4
   \   000386   12....       LCALL   ?FLT_MUL
   \   000389   D0..         POP     ?V0 + 7
   \   00038B   D0..         POP     ?V0 + 6
   \   00038D   D0..         POP     ?V0 + 5
   \   00038F   D0..         POP     ?V0 + 4
   \   000391   78..         MOV     R0,#?V0 + 4
   \   000393   79..         MOV     R1,#?V0 + 12
   \   000395   12....       LCALL   ?FLT_ADD
    212            f_B = X *  0.0557 + Y * -0.2040 + Z *  1.0570;
   \   000398   90....       MOV     DPTR,#__Constant_3d6425af
   \   00039B   78..         MOV     R0,#?V0 + 12
   \   00039D   12....       LCALL   ?L_MOV_X
   \   0003A0   78..         MOV     R0,#?V0 + 8
   \   0003A2   79..         MOV     R1,#?V0 + 12
   \   0003A4   12....       LCALL   ?FLT_MUL
   \   0003A7   C0..         PUSH    ?V0 + 8
   \   0003A9   C0..         PUSH    ?V0 + 9
   \   0003AB   C0..         PUSH    ?V0 + 10
   \   0003AD   C0..         PUSH    ?V0 + 11
   \   0003AF   85..82       MOV     DPL,?XSP + 0
   \   0003B2   85..83       MOV     DPH,?XSP + 1
   \   0003B5   78..         MOV     R0,#?V0 + 12
   \   0003B7   12....       LCALL   ?L_MOV_X
   \   0003BA   90....       MOV     DPTR,#__Constant_be50e560
   \   0003BD   78..         MOV     R0,#?V0 + 8
   \   0003BF   12....       LCALL   ?L_MOV_X
   \   0003C2   78..         MOV     R0,#?V0 + 12
   \   0003C4   79..         MOV     R1,#?V0 + 8
   \   0003C6   12....       LCALL   ?FLT_MUL
   \   0003C9   D0..         POP     ?V0 + 11
   \   0003CB   D0..         POP     ?V0 + 10
   \   0003CD   D0..         POP     ?V0 + 9
   \   0003CF   D0..         POP     ?V0 + 8
   \   0003D1   78..         MOV     R0,#?V0 + 8
   \   0003D3   79..         MOV     R1,#?V0 + 12
   \   0003D5   12....       LCALL   ?FLT_ADD
   \   0003D8   C0..         PUSH    ?V0 + 8
   \   0003DA   C0..         PUSH    ?V0 + 9
   \   0003DC   C0..         PUSH    ?V0 + 10
   \   0003DE   C0..         PUSH    ?V0 + 11
   \   0003E0   7404         MOV     A,#0x4
   \   0003E2   12....       LCALL   ?XSTACK_DISP0_8
   \   0003E5   78..         MOV     R0,#?V0 + 12
   \   0003E7   12....       LCALL   ?L_MOV_X
   \   0003EA   90....       MOV     DPTR,#__Constant_3f874bc7
   \   0003ED   78..         MOV     R0,#?V0 + 8
   \   0003EF   12....       LCALL   ?L_MOV_X
   \   0003F2   78..         MOV     R0,#?V0 + 12
   \   0003F4   79..         MOV     R1,#?V0 + 8
   \   0003F6   12....       LCALL   ?FLT_MUL
   \   0003F9   D0..         POP     ?V0 + 11
   \   0003FB   D0..         POP     ?V0 + 10
   \   0003FD   D0..         POP     ?V0 + 9
   \   0003FF   D0..         POP     ?V0 + 8
   \   000401   78..         MOV     R0,#?V0 + 8
   \   000403   79..         MOV     R1,#?V0 + 12
   \   000405   12....       LCALL   ?FLT_ADD
    213          
    214            //color correction
    215            hwLight_GammaCorrectRGB(&f_R, &f_G, &f_B);
   \   000408   90....       MOV     DPTR,#__Constant_3b449ba7
   \   00040B   78..         MOV     R0,#?V0 + 12
   \   00040D   12....       LCALL   ?L_MOV_X
   \   000410   78..         MOV     R0,#?V0 + 0
   \   000412   79..         MOV     R1,#?V0 + 12
   \   000414   12....       LCALL   ?FLT_GE
   \   000417   503E         JNC     ??hwLight_Convert_xyY_to_RGB_10
   \   000419                ; Setup parameters for call to function pow
   \   000419   90....       MOV     DPTR,#__Constant_3f2aaaab
   \   00041C   12....       LCALL   ?PUSH_XSTACK8_X_FOUR
   \   00041F   AA..         MOV     R2,?V0 + 0
   \   000421   AB..         MOV     R3,?V0 + 1
   \   000423   AC..         MOV     R4,?V0 + 2
   \   000425   AD..         MOV     R5,?V0 + 3
   \   000427   12....       LCALL   ??pow?relay
   \   00042A   7404         MOV     A,#0x4
   \   00042C   12....       LCALL   ?DEALLOC_XSTACK8
   \   00042F   8A..         MOV     ?V0 + 0,R2
   \   000431   8B..         MOV     ?V0 + 1,R3
   \   000433   8C..         MOV     ?V0 + 2,R4
   \   000435   8D..         MOV     ?V0 + 3,R5
   \   000437   90....       MOV     DPTR,#__Constant_3f9c28f6
   \   00043A   78..         MOV     R0,#?V0 + 12
   \   00043C   12....       LCALL   ?L_MOV_X
   \   00043F   78..         MOV     R0,#?V0 + 0
   \   000441   79..         MOV     R1,#?V0 + 12
   \   000443   12....       LCALL   ?FLT_MUL
   \   000446   90....       MOV     DPTR,#__Constant_bd23d70a
   \   000449   78..         MOV     R0,#?V0 + 12
   \   00044B   12....       LCALL   ?L_MOV_X
   \   00044E   78..         MOV     R0,#?V0 + 0
   \   000450   79..         MOV     R1,#?V0 + 12
   \   000452   12....       LCALL   ?FLT_ADD
   \   000455   800C         SJMP    ??hwLight_Convert_xyY_to_RGB_11
   \                     ??hwLight_Convert_xyY_to_RGB_10:
   \   000457   75..00       MOV     ?V0 + 0,#0x0
   \   00045A   75..00       MOV     ?V0 + 1,#0x0
   \   00045D   75..00       MOV     ?V0 + 2,#0x0
   \   000460   75..00       MOV     ?V0 + 3,#0x0
   \                     ??hwLight_Convert_xyY_to_RGB_11:
   \   000463   90....       MOV     DPTR,#__Constant_3b449ba7
   \   000466   78..         MOV     R0,#?V0 + 12
   \   000468   12....       LCALL   ?L_MOV_X
   \   00046B   78..         MOV     R0,#?V0 + 4
   \   00046D   79..         MOV     R1,#?V0 + 12
   \   00046F   12....       LCALL   ?FLT_GE
   \   000472   503E         JNC     ??hwLight_Convert_xyY_to_RGB_12
   \   000474                ; Setup parameters for call to function pow
   \   000474   90....       MOV     DPTR,#__Constant_3f2aaaab
   \   000477   12....       LCALL   ?PUSH_XSTACK8_X_FOUR
   \   00047A   AA..         MOV     R2,?V0 + 4
   \   00047C   AB..         MOV     R3,?V0 + 5
   \   00047E   AC..         MOV     R4,?V0 + 6
   \   000480   AD..         MOV     R5,?V0 + 7
   \   000482   12....       LCALL   ??pow?relay
   \   000485   7404         MOV     A,#0x4
   \   000487   12....       LCALL   ?DEALLOC_XSTACK8
   \   00048A   8A..         MOV     ?V0 + 4,R2
   \   00048C   8B..         MOV     ?V0 + 5,R3
   \   00048E   8C..         MOV     ?V0 + 6,R4
   \   000490   8D..         MOV     ?V0 + 7,R5
   \   000492   90....       MOV     DPTR,#__Constant_3f9c28f6
   \   000495   78..         MOV     R0,#?V0 + 12
   \   000497   12....       LCALL   ?L_MOV_X
   \   00049A   78..         MOV     R0,#?V0 + 4
   \   00049C   79..         MOV     R1,#?V0 + 12
   \   00049E   12....       LCALL   ?FLT_MUL
   \   0004A1   90....       MOV     DPTR,#__Constant_bd23d70a
   \   0004A4   78..         MOV     R0,#?V0 + 12
   \   0004A6   12....       LCALL   ?L_MOV_X
   \   0004A9   78..         MOV     R0,#?V0 + 4
   \   0004AB   79..         MOV     R1,#?V0 + 12
   \   0004AD   12....       LCALL   ?FLT_ADD
   \   0004B0   800C         SJMP    ??hwLight_Convert_xyY_to_RGB_13
   \                     ??hwLight_Convert_xyY_to_RGB_12:
   \   0004B2   75..00       MOV     ?V0 + 4,#0x0
   \   0004B5   75..00       MOV     ?V0 + 5,#0x0
   \   0004B8   75..00       MOV     ?V0 + 6,#0x0
   \   0004BB   75..00       MOV     ?V0 + 7,#0x0
   \                     ??hwLight_Convert_xyY_to_RGB_13:
   \   0004BE   90....       MOV     DPTR,#__Constant_3b449ba7
   \   0004C1   78..         MOV     R0,#?V0 + 12
   \   0004C3   12....       LCALL   ?L_MOV_X
   \   0004C6   78..         MOV     R0,#?V0 + 8
   \   0004C8   79..         MOV     R1,#?V0 + 12
   \   0004CA   12....       LCALL   ?FLT_GE
   \   0004CD   503E         JNC     ??hwLight_Convert_xyY_to_RGB_14
   \   0004CF                ; Setup parameters for call to function pow
   \   0004CF   90....       MOV     DPTR,#__Constant_3f2aaaab
   \   0004D2   12....       LCALL   ?PUSH_XSTACK8_X_FOUR
   \   0004D5   AA..         MOV     R2,?V0 + 8
   \   0004D7   AB..         MOV     R3,?V0 + 9
   \   0004D9   AC..         MOV     R4,?V0 + 10
   \   0004DB   AD..         MOV     R5,?V0 + 11
   \   0004DD   12....       LCALL   ??pow?relay
   \   0004E0   7404         MOV     A,#0x4
   \   0004E2   12....       LCALL   ?DEALLOC_XSTACK8
   \   0004E5   8A..         MOV     ?V0 + 8,R2
   \   0004E7   8B..         MOV     ?V0 + 9,R3
   \   0004E9   8C..         MOV     ?V0 + 10,R4
   \   0004EB   8D..         MOV     ?V0 + 11,R5
   \   0004ED   90....       MOV     DPTR,#__Constant_3f8b851f
   \   0004F0   78..         MOV     R0,#?V0 + 12
   \   0004F2   12....       LCALL   ?L_MOV_X
   \   0004F5   78..         MOV     R0,#?V0 + 8
   \   0004F7   79..         MOV     R1,#?V0 + 12
   \   0004F9   12....       LCALL   ?FLT_MUL
   \   0004FC   90....       MOV     DPTR,#__Constant_bd4ccccd
   \   0004FF   78..         MOV     R0,#?V0 + 12
   \   000501   12....       LCALL   ?L_MOV_X
   \   000504   78..         MOV     R0,#?V0 + 8
   \   000506   79..         MOV     R1,#?V0 + 12
   \   000508   12....       LCALL   ?FLT_ADD
   \   00050B   800C         SJMP    ??hwLight_Convert_xyY_to_RGB_15
   \                     ??hwLight_Convert_xyY_to_RGB_14:
   \   00050D   75..00       MOV     ?V0 + 8,#0x0
   \   000510   75..00       MOV     ?V0 + 9,#0x0
   \   000513   75..00       MOV     ?V0 + 10,#0x0
   \   000516   75..00       MOV     ?V0 + 11,#0x0
    216            hwLight_TempCompensateRGB(&f_R, &f_G, &f_B);
    217            hwLight_GroupWaveLenCompensateRGB(&f_R, &f_G, &f_B);
    218            hwLight_GroupLuminCompensateRGB(&f_R, &f_G, &f_B);
    219          
    220            // truncate results exceeding 0..1
    221            f_R = (f_R > 1.0 ? 1.0 : (f_R < 0 ? 0 : f_R));
   \                     ??hwLight_Convert_xyY_to_RGB_15:
   \   000519   90....       MOV     DPTR,#__Constant_3f800001
   \   00051C   78..         MOV     R0,#?V0 + 12
   \   00051E   12....       LCALL   ?L_MOV_X
   \   000521   78..         MOV     R0,#?V0 + 0
   \   000523   79..         MOV     R1,#?V0 + 12
   \   000525   12....       LCALL   ?FLT_GE
   \   000528   500E         JNC     ??hwLight_Convert_xyY_to_RGB_16
   \   00052A   75..00       MOV     ?V0 + 0,#0x0
   \   00052D   75..00       MOV     ?V0 + 1,#0x0
   \   000530   75..80       MOV     ?V0 + 2,#-0x80
   \   000533   75..3F       MOV     ?V0 + 3,#0x3f
   \   000536   801D         SJMP    ??hwLight_Convert_xyY_to_RGB_17
   \                     ??hwLight_Convert_xyY_to_RGB_16:
   \   000538   90....       MOV     DPTR,#__Constant_0
   \   00053B   78..         MOV     R0,#?V0 + 12
   \   00053D   12....       LCALL   ?L_MOV_X
   \   000540   78..         MOV     R0,#?V0 + 0
   \   000542   79..         MOV     R1,#?V0 + 12
   \   000544   12....       LCALL   ?FLT_LT
   \   000547   500C         JNC     ??hwLight_Convert_xyY_to_RGB_17
   \   000549   75..00       MOV     ?V0 + 0,#0x0
   \   00054C   75..00       MOV     ?V0 + 1,#0x0
   \   00054F   75..00       MOV     ?V0 + 2,#0x0
   \   000552   75..00       MOV     ?V0 + 3,#0x0
    222            f_G = (f_G > 1.0 ? 1.0 : (f_G < 0 ? 0 : f_G));
   \                     ??hwLight_Convert_xyY_to_RGB_17:
   \   000555   90....       MOV     DPTR,#__Constant_3f800001
   \   000558   78..         MOV     R0,#?V0 + 12
   \   00055A   12....       LCALL   ?L_MOV_X
   \   00055D   78..         MOV     R0,#?V0 + 4
   \   00055F   79..         MOV     R1,#?V0 + 12
   \   000561   12....       LCALL   ?FLT_GE
   \   000564   500E         JNC     ??hwLight_Convert_xyY_to_RGB_18
   \   000566   75..00       MOV     ?V0 + 4,#0x0
   \   000569   75..00       MOV     ?V0 + 5,#0x0
   \   00056C   75..80       MOV     ?V0 + 6,#-0x80
   \   00056F   75..3F       MOV     ?V0 + 7,#0x3f
   \   000572   801D         SJMP    ??hwLight_Convert_xyY_to_RGB_19
   \                     ??hwLight_Convert_xyY_to_RGB_18:
   \   000574   90....       MOV     DPTR,#__Constant_0
   \   000577   78..         MOV     R0,#?V0 + 12
   \   000579   12....       LCALL   ?L_MOV_X
   \   00057C   78..         MOV     R0,#?V0 + 4
   \   00057E   79..         MOV     R1,#?V0 + 12
   \   000580   12....       LCALL   ?FLT_LT
   \   000583   500C         JNC     ??hwLight_Convert_xyY_to_RGB_19
   \   000585   75..00       MOV     ?V0 + 4,#0x0
   \   000588   75..00       MOV     ?V0 + 5,#0x0
   \   00058B   75..00       MOV     ?V0 + 6,#0x0
   \   00058E   75..00       MOV     ?V0 + 7,#0x0
    223            f_B = (f_B > 1.0 ? 1.0 : (f_B < 0 ? 0 : f_B));
   \                     ??hwLight_Convert_xyY_to_RGB_19:
   \   000591   90....       MOV     DPTR,#__Constant_3f800001
   \   000594   78..         MOV     R0,#?V0 + 12
   \   000596   12....       LCALL   ?L_MOV_X
   \   000599   78..         MOV     R0,#?V0 + 8
   \   00059B   79..         MOV     R1,#?V0 + 12
   \   00059D   12....       LCALL   ?FLT_GE
   \   0005A0   500E         JNC     ??hwLight_Convert_xyY_to_RGB_20
   \   0005A2   75..00       MOV     ?V0 + 8,#0x0
   \   0005A5   75..00       MOV     ?V0 + 9,#0x0
   \   0005A8   75..80       MOV     ?V0 + 10,#-0x80
   \   0005AB   75..3F       MOV     ?V0 + 11,#0x3f
   \   0005AE   801D         SJMP    ??hwLight_Convert_xyY_to_RGB_21
   \                     ??hwLight_Convert_xyY_to_RGB_20:
   \   0005B0   90....       MOV     DPTR,#__Constant_0
   \   0005B3   78..         MOV     R0,#?V0 + 12
   \   0005B5   12....       LCALL   ?L_MOV_X
   \   0005B8   78..         MOV     R0,#?V0 + 8
   \   0005BA   79..         MOV     R1,#?V0 + 12
   \   0005BC   12....       LCALL   ?FLT_LT
   \   0005BF   500C         JNC     ??hwLight_Convert_xyY_to_RGB_21
   \   0005C1   75..00       MOV     ?V0 + 8,#0x0
   \   0005C4   75..00       MOV     ?V0 + 9,#0x0
   \   0005C7   75..00       MOV     ?V0 + 10,#0x0
   \   0005CA   75..00       MOV     ?V0 + 11,#0x0
    224          
    225            *R = (uint16)(f_R * PWM_FULL_DUTY_CYCLE);
   \                     ??hwLight_Convert_xyY_to_RGB_21:
   \   0005CD   90....       MOV     DPTR,#__Constant_447a0000
   \   0005D0   78..         MOV     R0,#?V0 + 12
   \   0005D2   12....       LCALL   ?L_MOV_X
   \   0005D5   78..         MOV     R0,#?V0 + 0
   \   0005D7   79..         MOV     R1,#?V0 + 12
   \   0005D9   12....       LCALL   ?FLT_MUL
   \   0005DC   78..         MOV     R0,#?V0 + 0
   \   0005DE   12....       LCALL   ?FLT_TO_L
   \   0005E1   7430         MOV     A,#0x30
   \   0005E3   12....       LCALL   ?XSTACK_DISP0_8
   \   0005E6   12....       LCALL   ?Subroutine8 & 0xFFFF
    226            *G = (uint16)(f_G * PWM_FULL_DUTY_CYCLE);
   \                     ??CrossCallReturnLabel_4:
   \   0005E9   90....       MOV     DPTR,#__Constant_447a0000
   \   0005EC   78..         MOV     R0,#?V0 + 0
   \   0005EE   12....       LCALL   ?L_MOV_X
   \   0005F1   78..         MOV     R0,#?V0 + 4
   \   0005F3   79..         MOV     R1,#?V0 + 0
   \   0005F5   12....       LCALL   ?FLT_MUL
   \   0005F8   78..         MOV     R0,#?V0 + 4
   \   0005FA   12....       LCALL   ?FLT_TO_L
   \   0005FD   7432         MOV     A,#0x32
   \   0005FF   12....       LCALL   ?XSTACK_DISP0_8
   \   000602   12....       LCALL   ??Subroutine38_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_75:
   \   000605   E5..         MOV     A,?V0 + 4
   \   000607   F0           MOVX    @DPTR,A
   \   000608   A3           INC     DPTR
   \   000609   E5..         MOV     A,?V0 + 5
   \   00060B   F0           MOVX    @DPTR,A
    227            *B = (uint16)(f_B * PWM_FULL_DUTY_CYCLE);
   \   00060C   90....       MOV     DPTR,#__Constant_447a0000
   \   00060F   78..         MOV     R0,#?V0 + 0
   \   000611   12....       LCALL   ?L_MOV_X
   \   000614   78..         MOV     R0,#?V0 + 8
   \   000616   79..         MOV     R1,#?V0 + 0
   \   000618   12....       LCALL   ?FLT_MUL
   \   00061B   78..         MOV     R0,#?V0 + 8
   \   00061D   12....       LCALL   ?FLT_TO_L
   \   000620   8E82         MOV     DPL,R6
   \   000622   8F83         MOV     DPH,R7
   \   000624   E5..         MOV     A,?V0 + 8
   \   000626   F0           MOVX    @DPTR,A
   \   000627   A3           INC     DPTR
   \   000628   E5..         MOV     A,?V0 + 9
   \   00062A   F0           MOVX    @DPTR,A
    228          }
   \   00062B   7410         MOV     A,#0x10
   \   00062D   02....       LJMP    ?Subroutine0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine19:
   \   000000   E4           CLR     A
   \   000001                REQUIRE ??Subroutine33_0
   \   000001                ; // Fall through to label ??Subroutine33_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine33_0:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   A3           INC     DPTR
   \   000002   F0           MOVX    @DPTR,A
   \   000003   A3           INC     DPTR
   \   000004   F0           MOVX    @DPTR,A
   \   000005   A3           INC     DPTR
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003   7F10         MOV     R7,#0x10
   \   000005   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   12....       LCALL   ?Subroutine28 & 0xFFFF
   \                     ??CrossCallReturnLabel_89:
   \   000003   E5..         MOV     A,?V0 + 0
   \   000005   F0           MOVX    @DPTR,A
   \   000006   A3           INC     DPTR
   \   000007   E5..         MOV     A,?V0 + 1
   \   000009   F0           MOVX    @DPTR,A
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine38_0:
   \   000000   12....       LCALL   ?Subroutine28 & 0xFFFF
   \                     ??CrossCallReturnLabel_91:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine28:
   \   000000   12....       LCALL   ?Subroutine32 & 0xFFFF
   \                     ??CrossCallReturnLabel_94:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine32:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F583         MOV     DPH,A
   \   000006   8882         MOV     DPL,R0
   \   000008   22           RET
    229          
    230          /*********************************************************************
    231          * @fn      hwLight_RGB_to_RGBW
    232          *
    233          * @brief   Convert RGB LED values to RGBW. The white value is written to W,
    234          *          the original RGB values are overwritten.
    235          *
    236          * @param   R - pointer to red input and output value from 0 to PWM_FULL_DUTY_CYCLE
    237          * @param   G - pointer to green input and output value from 0 to PWM_FULL_DUTY_CYCLE
    238          * @param   B - pointer to blue input and output value from 0 to PWM_FULL_DUTY_CYCLE
    239          * @param   W - pointer to white output value from 0 to PWM_FULL_DUTY_CYCLE
    240          *
    241          * @return  none
    242          */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    243          static void hwLight_RGB_to_RGBW( uint16 *R, uint16 *G, uint16 *B, uint16 *W )
   \                     hwLight_RGB_to_RGBW:
    244          {
   \   000000   74EA         MOV     A,#-0x16
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 22
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 12,R2
   \   000007   8B..         MOV     ?V0 + 13,R3
   \   000009   EC           MOV     A,R4
   \   00000A   FE           MOV     R6,A
   \   00000B   ED           MOV     A,R5
   \   00000C   FF           MOV     R7,A
   \   00000D   7416         MOV     A,#0x16
   \   00000F   12....       LCALL   ?XSTACK_DISP0_8
   \   000012   12....       LCALL   ??Subroutine34_0 & 0xFFFF
    245            uint16 w;
    246            if ( MAX3(*R,*G,*B) == 0 )
   \                     ??CrossCallReturnLabel_60:
   \   000015   8A82         MOV     DPL,R2
   \   000017   8B83         MOV     DPH,R3
   \   000019   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   00001C   E0           MOVX    A,@DPTR
   \   00001D   F5..         MOV     ?V0 + 6,A
   \   00001F   A3           INC     DPTR
   \   000020   E0           MOVX    A,@DPTR
   \   000021   F5..         MOV     ?V0 + 7,A
   \   000023   8E82         MOV     DPL,R6
   \   000025   8F83         MOV     DPH,R7
   \   000027   E0           MOVX    A,@DPTR
   \   000028   F5..         MOV     ?V0 + 8,A
   \   00002A   A3           INC     DPTR
   \   00002B   E0           MOVX    A,@DPTR
   \   00002C   F5..         MOV     ?V0 + 9,A
   \   00002E   12....       LCALL   ?Subroutine25 & 0xFFFF
   \                     ??CrossCallReturnLabel_34:
   \   000031   5011         JNC     ??hwLight_RGB_to_RGBW_0
   \   000033   C3           CLR     C
   \   000034   E8           MOV     A,R0
   \   000035   95..         SUBB    A,?V0 + 6
   \   000037   E9           MOV     A,R1
   \   000038   95..         SUBB    A,?V0 + 7
   \   00003A   5019         JNC     ??hwLight_RGB_to_RGBW_1
   \   00003C   85....       MOV     ?V0 + 0,?V0 + 6
   \   00003F   85....       MOV     ?V0 + 1,?V0 + 7
   \   000042   8015         SJMP    ??hwLight_RGB_to_RGBW_2
   \                     ??hwLight_RGB_to_RGBW_0:
   \   000044   C3           CLR     C
   \   000045   E8           MOV     A,R0
   \   000046   95..         SUBB    A,?V0 + 8
   \   000048   E9           MOV     A,R1
   \   000049   95..         SUBB    A,?V0 + 9
   \   00004B   5008         JNC     ??hwLight_RGB_to_RGBW_1
   \   00004D   85....       MOV     ?V0 + 0,?V0 + 8
   \   000050   85....       MOV     ?V0 + 1,?V0 + 9
   \   000053   8004         SJMP    ??hwLight_RGB_to_RGBW_2
   \                     ??hwLight_RGB_to_RGBW_1:
   \   000055   88..         MOV     ?V0 + 0,R0
   \   000057   89..         MOV     ?V0 + 1,R1
   \                     ??hwLight_RGB_to_RGBW_2:
   \   000059   7418         MOV     A,#0x18
   \   00005B   12....       LCALL   ?XSTACK_DISP0_8
   \   00005E   12....       LCALL   ?Subroutine29 & 0xFFFF
   \                     ??CrossCallReturnLabel_44:
   \   000061   E5..         MOV     A,?V0 + 0
   \   000063   45..         ORL     A,?V0 + 1
   \   000065   700A         JNZ     ??hwLight_RGB_to_RGBW_3
    247            {
    248              *W = 0;
   \   000067   8C82         MOV     DPL,R4
   \   000069   8D83         MOV     DPH,R5
   \   00006B   E4           CLR     A
   \   00006C   F0           MOVX    @DPTR,A
   \   00006D   A3           INC     DPTR
   \   00006E   02....       LJMP    ??hwLight_RGB_to_RGBW_4 & 0xFFFF
    249              return;
    250            }
    251            w = (uint16)( ( (uint32)MIN3(*R,*G,*B) * ( *R + *G + *B ) ) / ( MAX3(*R,*G,*B) * 3 ) );
   \                     ??hwLight_RGB_to_RGBW_3:
   \   000071   12....       LCALL   ?Subroutine25 & 0xFFFF
   \                     ??CrossCallReturnLabel_35:
   \   000074   5020         JNC     ??hwLight_RGB_to_RGBW_5
   \   000076   C3           CLR     C
   \   000077   E8           MOV     A,R0
   \   000078   95..         SUBB    A,?V0 + 8
   \   00007A   E9           MOV     A,R1
   \   00007B   95..         SUBB    A,?V0 + 9
   \   00007D   4020         JC      ??hwLight_RGB_to_RGBW_6
   \   00007F   85....       MOV     ?V0 + 0,?V0 + 8
   \   000082   85....       MOV     ?V0 + 1,?V0 + 9
   \                     ??hwLight_RGB_to_RGBW_7:
   \   000085   C3           CLR     C
   \   000086   E8           MOV     A,R0
   \   000087   95..         SUBB    A,?V0 + 6
   \   000089   E9           MOV     A,R1
   \   00008A   95..         SUBB    A,?V0 + 7
   \   00008C   5033         JNC     ??hwLight_RGB_to_RGBW_8
   \   00008E   85....       MOV     ?V0 + 4,?V0 + 6
   \   000091   85....       MOV     ?V0 + 5,?V0 + 7
   \   000094   802F         SJMP    ??hwLight_RGB_to_RGBW_9
   \                     ??hwLight_RGB_to_RGBW_5:
   \   000096   C3           CLR     C
   \   000097   E8           MOV     A,R0
   \   000098   95..         SUBB    A,?V0 + 6
   \   00009A   E9           MOV     A,R1
   \   00009B   95..         SUBB    A,?V0 + 7
   \   00009D   500B         JNC     ??hwLight_RGB_to_RGBW_10
   \                     ??hwLight_RGB_to_RGBW_6:
   \   00009F   88..         MOV     ?V0 + 0,R0
   \   0000A1   89..         MOV     ?V0 + 1,R1
   \   0000A3   12....       LCALL   ?Subroutine25 & 0xFFFF
   \                     ??CrossCallReturnLabel_36:
   \   0000A6   5008         JNC     ??hwLight_RGB_to_RGBW_11
   \   0000A8   80DB         SJMP    ??hwLight_RGB_to_RGBW_7
   \                     ??hwLight_RGB_to_RGBW_10:
   \   0000AA   85....       MOV     ?V0 + 0,?V0 + 6
   \   0000AD   85....       MOV     ?V0 + 1,?V0 + 7
   \                     ??hwLight_RGB_to_RGBW_11:
   \   0000B0   C3           CLR     C
   \   0000B1   E8           MOV     A,R0
   \   0000B2   95..         SUBB    A,?V0 + 8
   \   0000B4   E9           MOV     A,R1
   \   0000B5   95..         SUBB    A,?V0 + 9
   \   0000B7   5008         JNC     ??hwLight_RGB_to_RGBW_8
   \   0000B9   85....       MOV     ?V0 + 4,?V0 + 8
   \   0000BC   85....       MOV     ?V0 + 5,?V0 + 9
   \   0000BF   8004         SJMP    ??hwLight_RGB_to_RGBW_9
   \                     ??hwLight_RGB_to_RGBW_8:
   \   0000C1   88..         MOV     ?V0 + 4,R0
   \   0000C3   89..         MOV     ?V0 + 5,R1
   \                     ??hwLight_RGB_to_RGBW_9:
   \   0000C5   E4           CLR     A
   \   0000C6   F5..         MOV     ?V0 + 2,A
   \   0000C8   F5..         MOV     ?V0 + 3,A
   \   0000CA   E5..         MOV     A,?V0 + 6
   \   0000CC   25..         ADD     A,?V0 + 8
   \   0000CE   F5..         MOV     ?V0 + 6,A
   \   0000D0   E5..         MOV     A,?V0 + 7
   \   0000D2   35..         ADDC    A,?V0 + 9
   \   0000D4   F5..         MOV     ?V0 + 7,A
   \   0000D6   E5..         MOV     A,?V0 + 6
   \   0000D8   28           ADD     A,R0
   \   0000D9   F5..         MOV     ?V0 + 8,A
   \   0000DB   E5..         MOV     A,?V0 + 7
   \   0000DD   39           ADDC    A,R1
   \   0000DE   F5..         MOV     ?V0 + 9,A
   \   0000E0   E4           CLR     A
   \   0000E1   F5..         MOV     ?V0 + 10,A
   \   0000E3   F5..         MOV     ?V0 + 11,A
   \   0000E5   78..         MOV     R0,#?V0 + 0
   \   0000E7   79..         MOV     R1,#?V0 + 8
   \   0000E9   12....       LCALL   ?L_MUL
   \   0000EC   E5..         MOV     A,?V0 + 4
   \   0000EE   75F003       MOV     B,#0x3
   \   0000F1   A4           MUL     AB
   \   0000F2   F5..         MOV     ?V0 + 4,A
   \   0000F4   A8F0         MOV     R0,B
   \   0000F6   75F003       MOV     B,#0x3
   \   0000F9   E5..         MOV     A,?V0 + 5
   \   0000FB   A4           MUL     AB
   \   0000FC   28           ADD     A,R0
   \   0000FD   F5..         MOV     ?V0 + 5,A
   \   0000FF   E4           CLR     A
   \   000100   F5..         MOV     ?V0 + 6,A
   \   000102   F5..         MOV     ?V0 + 7,A
   \   000104   78..         MOV     R0,#?V0 + 0
   \   000106   79..         MOV     R1,#?V0 + 4
   \   000108   12....       LCALL   ?UL_DIV_MOD
   \   00010B   A8..         MOV     R0,?V0 + 0
   \   00010D   A9..         MOV     R1,?V0 + 1
    252            *R += w;
   \   00010F   85..82       MOV     DPL,?V0 + 12
   \   000112   85..83       MOV     DPH,?V0 + 13
   \   000115   12....       LCALL   ?Subroutine14 & 0xFFFF
    253            *G += w;
   \                     ??CrossCallReturnLabel_15:
   \   000118   8E82         MOV     DPL,R6
   \   00011A   8F83         MOV     DPH,R7
   \   00011C   12....       LCALL   ?Subroutine14 & 0xFFFF
    254            *B += w;
   \                     ??CrossCallReturnLabel_16:
   \   00011F   8A82         MOV     DPL,R2
   \   000121   8B83         MOV     DPH,R3
   \   000123   12....       LCALL   ?Subroutine14 & 0xFFFF
    255            *W = MIN3(*R,*G,*B);
   \                     ??CrossCallReturnLabel_17:
   \   000126   85..82       MOV     DPL,?V0 + 12
   \   000129   85..83       MOV     DPH,?V0 + 13
   \   00012C   E0           MOVX    A,@DPTR
   \   00012D   F5..         MOV     ?V0 + 2,A
   \   00012F   A3           INC     DPTR
   \   000130   E0           MOVX    A,@DPTR
   \   000131   F5..         MOV     ?V0 + 3,A
   \   000133   8E82         MOV     DPL,R6
   \   000135   8F83         MOV     DPH,R7
   \   000137   E0           MOVX    A,@DPTR
   \   000138   F5..         MOV     ?V0 + 0,A
   \   00013A   A3           INC     DPTR
   \   00013B   E0           MOVX    A,@DPTR
   \   00013C   F5..         MOV     ?V0 + 1,A
   \   00013E   8A82         MOV     DPL,R2
   \   000140   8B83         MOV     DPH,R3
   \   000142   12....       LCALL   ?Subroutine26 & 0xFFFF
   \                     ??CrossCallReturnLabel_37:
   \   000145   C3           CLR     C
   \   000146   E5..         MOV     A,?V0 + 0
   \   000148   95..         SUBB    A,?V0 + 2
   \   00014A   E5..         MOV     A,?V0 + 1
   \   00014C   95..         SUBB    A,?V0 + 3
   \   00014E   5011         JNC     ??hwLight_RGB_to_RGBW_12
   \   000150   C3           CLR     C
   \   000151   E8           MOV     A,R0
   \   000152   95..         SUBB    A,?V0 + 0
   \   000154   E9           MOV     A,R1
   \   000155   95..         SUBB    A,?V0 + 1
   \   000157   4011         JC      ??hwLight_RGB_to_RGBW_13
   \   000159   85....       MOV     ?V0 + 4,?V0 + 0
   \   00015C   85....       MOV     ?V0 + 5,?V0 + 1
   \   00015F   8015         SJMP    ??hwLight_RGB_to_RGBW_14
   \                     ??hwLight_RGB_to_RGBW_12:
   \   000161   C3           CLR     C
   \   000162   E8           MOV     A,R0
   \   000163   95..         SUBB    A,?V0 + 2
   \   000165   E9           MOV     A,R1
   \   000166   95..         SUBB    A,?V0 + 3
   \   000168   5006         JNC     ??hwLight_RGB_to_RGBW_15
   \                     ??hwLight_RGB_to_RGBW_13:
   \   00016A   88..         MOV     ?V0 + 4,R0
   \   00016C   89..         MOV     ?V0 + 5,R1
   \   00016E   8006         SJMP    ??hwLight_RGB_to_RGBW_14
   \                     ??hwLight_RGB_to_RGBW_15:
   \   000170   85....       MOV     ?V0 + 4,?V0 + 2
   \   000173   85....       MOV     ?V0 + 5,?V0 + 3
   \                     ??hwLight_RGB_to_RGBW_14:
   \   000176   8C82         MOV     DPL,R4
   \   000178   8D83         MOV     DPH,R5
   \   00017A   12....       LCALL   ?Subroutine20 & 0xFFFF
    256            *W = (*W > PWM_FULL_DUTY_CYCLE) ? PWM_FULL_DUTY_CYCLE : *W;
   \                     ??CrossCallReturnLabel_26:
   \   00017D   F8           MOV     R0,A
   \   00017E   A3           INC     DPTR
   \   00017F   E0           MOVX    A,@DPTR
   \   000180   F9           MOV     R1,A
   \   000181   C3           CLR     C
   \   000182   E8           MOV     A,R0
   \   000183   94E9         SUBB    A,#-0x17
   \   000185   E9           MOV     A,R1
   \   000186   9403         SUBB    A,#0x3
   \   000188   4008         JC      ??hwLight_RGB_to_RGBW_16
   \   00018A   75..E8       MOV     ?V0 + 0,#-0x18
   \   00018D   75..03       MOV     ?V0 + 1,#0x3
   \   000190   8004         SJMP    ??hwLight_RGB_to_RGBW_17
   \                     ??hwLight_RGB_to_RGBW_16:
   \   000192   88..         MOV     ?V0 + 0,R0
   \   000194   89..         MOV     ?V0 + 1,R1
   \                     ??hwLight_RGB_to_RGBW_17:
   \   000196   8C82         MOV     DPL,R4
   \   000198   8D83         MOV     DPH,R5
   \   00019A   E5..         MOV     A,?V0 + 0
   \   00019C   F0           MOVX    @DPTR,A
   \   00019D   A3           INC     DPTR
   \   00019E   E5..         MOV     A,?V0 + 1
   \   0001A0   F0           MOVX    @DPTR,A
    257            *R -= *W;
   \   0001A1   8C82         MOV     DPL,R4
   \   0001A3   8D83         MOV     DPH,R5
   \   0001A5   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   0001A8   12....       LCALL   ?Subroutine7 & 0xFFFF
    258            *G -= *W;
   \                     ??CrossCallReturnLabel_2:
   \   0001AB   8E82         MOV     DPL,R6
   \   0001AD   8F83         MOV     DPH,R7
   \   0001AF   12....       LCALL   ?Subroutine7 & 0xFFFF
    259            *B -= *W;
   \                     ??CrossCallReturnLabel_3:
   \   0001B2   8A82         MOV     DPL,R2
   \   0001B4   8B83         MOV     DPH,R3
   \   0001B6   C3           CLR     C
   \   0001B7   E0           MOVX    A,@DPTR
   \   0001B8   98           SUBB    A,R0
   \   0001B9   F0           MOVX    @DPTR,A
   \   0001BA   A3           INC     DPTR
   \   0001BB   E0           MOVX    A,@DPTR
   \   0001BC   99           SUBB    A,R1
   \                     ??hwLight_RGB_to_RGBW_4:
   \   0001BD   F0           MOVX    @DPTR,A
    260          }
   \   0001BE   7F0E         MOV     R7,#0xe
   \   0001C0   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine25:
   \   000000   C3           CLR     C
   \   000001   E5..         MOV     A,?V0 + 8
   \   000003   95..         SUBB    A,?V0 + 6
   \   000005   E5..         MOV     A,?V0 + 9
   \   000007   95..         SUBB    A,?V0 + 7
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   28           ADD     A,R0
   \   000002   F0           MOVX    @DPTR,A
   \   000003   A3           INC     DPTR
   \   000004   E0           MOVX    A,@DPTR
   \   000005   39           ADDC    A,R1
   \   000006   F0           MOVX    @DPTR,A
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   12....       LCALL   ?Subroutine26 & 0xFFFF
   \                     ??CrossCallReturnLabel_41:
   \   000003   85..82       MOV     DPL,?V0 + 12
   \   000006   85..83       MOV     DPH,?V0 + 13
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   C3           CLR     C
   \   000001   E0           MOVX    A,@DPTR
   \   000002   98           SUBB    A,R0
   \   000003   F0           MOVX    @DPTR,A
   \   000004   A3           INC     DPTR
   \   000005   E0           MOVX    A,@DPTR
   \   000006   99           SUBB    A,R1
   \   000007   F0           MOVX    @DPTR,A
   \   000008   8C82         MOV     DPL,R4
   \   00000A   8D83         MOV     DPH,R5
   \   00000C   12....       LCALL   ?Subroutine26 & 0xFFFF
   \                     ??CrossCallReturnLabel_40:
   \   00000F   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine26:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   F8           MOV     R0,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine20:
   \   000000   E5..         MOV     A,?V0 + 4
   \   000002   F0           MOVX    @DPTR,A
   \   000003   A3           INC     DPTR
   \   000004   E5..         MOV     A,?V0 + 5
   \   000006   F0           MOVX    @DPTR,A
   \   000007   8C82         MOV     DPL,R4
   \   000009   8D83         MOV     DPH,R5
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine29:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   FC           MOV     R4,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   FD           MOV     R5,A
   \   000005   22           RET
    261          
    262          /*********************************************************************
    263          * @fn      hwLight_GammaCorrectRGB()
    264          *
    265          * @brief   Gamma correct the RGB values for specific LEDS
    266          *
    267          *          R - pointer to red value from 0 to 1
    268          *          G - pointer to green value from 0 to 1
    269          *          B - pointer to blue value from 0 to 1
    270          *
    271          * @return  none
    272          */
    273          void hwLight_GammaCorrectRGB(float *R, float *G, float *B)
    274          {
    275            if ( *R > 0.003 ) *R = (1.22 * ( pow(*R, ( 1/1.5 ) )) - 0.040);
    276            else                      *R = 0; //1.8023 * var_R;
    277            if ( *G > 0.003) *G = (1.22 * ( pow(*G, ( 1/1.5 ) )) - 0.040);
    278            else                     *G = 0; //1.8023 * var_G;
    279            if ( *B > 0.003 ) *B = (1.09 * ( pow(*B, ( 1/1.5 ) )) - 0.050);
    280            else                     *B = 0; //1.8023 * var_B;
    281          }
    282          
    283          /*********************************************************************
    284          * @fn      hwLight_TempCompensateRGB()
    285          *
    286          * @brief   correct the RGB values for current temp
    287          *
    288          *          R - pointer to red value from 0 to 1
    289          *          G - pointer to green value from 0 to 1
    290          *          B - pointer to blue value from 0 to 1
    291          *
    292          * @return  none
    293          */
    294          void hwLight_TempCompensateRGB(float *R, float *G, float *B)
    295          {
    296            // Fill in your code here...
    297          }
    298          
    299          /*********************************************************************
    300          * @fn      hwLight_GroupWaveLenCompensateRGB()
    301          *
    302          * @brief   correct the specific Group WaveLength (stored in NV)
    303          *
    304          *          R - pointer to red value from 0 to 1
    305          *          G - pointer to green value from 0 to 1
    306          *          B - pointer to blue value from 0 to 1
    307          *
    308          * @return  none
    309          */
    310          void hwLight_GroupWaveLenCompensateRGB(float *R, float *G, float *B)
    311          {
    312            // Fill in your code here...
    313          }
    314          
    315          /*********************************************************************
    316          * @fn      hwLight_GroupLuminCompensateRGB()
    317          *
    318          * @brief   correct the specific Group Lumin (stored in NV)
    319          *
    320          *          R - pointer to red value from 0 to 1
    321          *          G - pointer to green value from 0 to 1
    322          *          B - pointer to blue value from 0 to 1
    323          *
    324          * @return  none
    325          */
    326          void hwLight_GroupLuminCompensateRGB(float *R, float *G, float *B)
    327          {
    328            // Fill in your code here...
    329          }
    330          
    331          
    332          /*********************************************************************
    333          * @fn      hwLight_UpdateLampColorHueSat()
    334          *
    335          * @brief   Update color and level of lamp
    336          *
    337          * @param   hue, sat, level 0...0xFF
    338          *
    339          * @return  none
    340          */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    341          void hwLight_UpdateLampColorHueSat( uint8 hue, uint8 sat, uint8 level )
   \                     hwLight_UpdateLampColorHueSat:
    342          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 4
   \   000005   74FC         MOV     A,#-0x4
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    343            uint16 colorX, colorY;
    344          
    345            colorX = hueToX[hue];
   \   00000E   E9           MOV     A,R1
   \   00000F   12....       LCALL   ?Subroutine22 & 0xFFFF
   \                     ??CrossCallReturnLabel_28:
   \   000012   7402         MOV     A,#0x2
   \   000014   12....       LCALL   ?XSTACK_DISP0_8
   \   000017   12....       LCALL   ?Subroutine17 & 0xFFFF
    346            colorY = hueToY[hue];
   \                     ??CrossCallReturnLabel_22:
   \   00001A   85..82       MOV     DPL,?XSP + 0
   \   00001D   85..83       MOV     DPH,?XSP + 1
   \   000020   E8           MOV     A,R0
   \   000021   12....       LCALL   ??Subroutine37_0 & 0xFFFF
    347          
    348            hwLight_satToXy(&colorX, &colorY, sat);
   \                     ??CrossCallReturnLabel_69:
   \   000024                ; Setup parameters for call to function hwLight_satToXy
   \   000024   EE           MOV     A,R6
   \   000025   F9           MOV     R1,A
   \   000026   85..82       MOV     DPL,?XSP + 0
   \   000029   85..83       MOV     DPH,?XSP + 1
   \   00002C   AC82         MOV     R4,DPL
   \   00002E   AD83         MOV     R5,DPH
   \   000030   7402         MOV     A,#0x2
   \   000032   12....       LCALL   ?XSTACK_DISP0_8
   \   000035   AA82         MOV     R2,DPL
   \   000037   AB83         MOV     R3,DPH
   \   000039   12....       LCALL   ??hwLight_satToXy?relay
    349          
    350            //color table is 0-PWM_FULL_DUTY_CYCLE
    351            hwLight_UpdateLampColor( colorX*(0xFFFF/COLOR_XY_MAX), colorY*(0xFFFF/COLOR_XY_MAX), level);
   \   00003C                ; Setup parameters for call to function hwLight_UpdateLampColor
   \   00003C   EF           MOV     A,R7
   \   00003D   F9           MOV     R1,A
   \   00003E   85..82       MOV     DPL,?XSP + 0
   \   000041   85..83       MOV     DPH,?XSP + 1
   \   000044   12....       LCALL   ?Subroutine29 & 0xFFFF
   \                     ??CrossCallReturnLabel_45:
   \   000047   7402         MOV     A,#0x2
   \   000049   12....       LCALL   ?XSTACK_DISP0_8
   \   00004C   12....       LCALL   ??Subroutine34_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_61:
   \   00004F   12....       LCALL   ??hwLight_UpdateLampColor?relay
    352          }
   \   000052   7404         MOV     A,#0x4
   \   000054   12....       LCALL   ?DEALLOC_XSTACK8
   \   000057                REQUIRE ?Subroutine1
   \   000057                ; // Fall through to label ?Subroutine1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine30:
   \   000000   74..         MOV     A,#hueToY & 0xff
   \   000002   28           ADD     A,R0
   \   000003   F582         MOV     DPL,A
   \   000005   74..         MOV     A,#(hueToY >> 8) & 0xff
   \   000007   39           ADDC    A,R1
   \   000008   F583         MOV     DPH,A
   \   00000A   E4           CLR     A
   \   00000B   93           MOVC    A,@A+DPTR
   \   00000C   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine31:
   \   000000   C3           CLR     C
   \   000001   33           RLC     A
   \   000002   F8           MOV     R0,A
   \   000003   E4           CLR     A
   \   000004   33           RLC     A
   \   000005   F9           MOV     R1,A
   \   000006   74..         MOV     A,#hueToX & 0xff
   \   000008   28           ADD     A,R0
   \   000009   F582         MOV     DPL,A
   \   00000B   74..         MOV     A,#(hueToX >> 8) & 0xff
   \   00000D   39           ADDC    A,R1
   \   00000E   F583         MOV     DPH,A
   \   000010   E4           CLR     A
   \   000011   93           MOVC    A,@A+DPTR
   \   000012   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine22:
   \   000000   12....       LCALL   ?Subroutine31 & 0xFFFF
   \                     ??CrossCallReturnLabel_50:
   \   000003   FA           MOV     R2,A
   \   000004   7401         MOV     A,#0x1
   \   000006   93           MOVC    A,@A+DPTR
   \   000007   FB           MOV     R3,A
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   EA           MOV     A,R2
   \   000001   F0           MOVX    @DPTR,A
   \   000002   A3           INC     DPTR
   \   000003   EB           MOV     A,R3
   \   000004   F0           MOVX    @DPTR,A
   \   000005   12....       LCALL   ?Subroutine30 & 0xFFFF
   \                     ??CrossCallReturnLabel_48:
   \   000008   F8           MOV     R0,A
   \   000009   7401         MOV     A,#0x1
   \   00000B   93           MOVC    A,@A+DPTR
   \   00000C   F9           MOV     R1,A
   \   00000D   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine37_0:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   A3           INC     DPTR
   \   000002   E9           MOV     A,R1
   \   000003   F0           MOVX    @DPTR,A
   \   000004   22           RET
    353          #endif //ZLL_HW_LED_LAMP
    354          
    355          /*********************************************************************
    356          * @fn      hwLight_satToXy
    357          *
    358          * @brief   Adjust x,y values from xyY gamut perimeter (fully saturated),
    359          *          towards pre-defined white-point, according to saturation.
    360          *
    361          * @param   x - pointer to x value of fully saturated hue, to be overwritten
    362          * @param   x - pointer to y value of fully saturated hue, to be overwritten
    363          * @param   sat - saturation input
    364          *
    365          * @return  none
    366          */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    367          static void hwLight_satToXy(uint16 *x, uint16 *y, uint8 sat)
   \                     hwLight_satToXy:
    368          {
   \   000000   74E8         MOV     A,#-0x18
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 24
   \   000005                ; Auto size: 4
   \   000005   74FC         MOV     A,#-0x4
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
    369            float xDelta, yDelta;
    370            uint16 localSat;
    371          
    372            localSat = 255 - sat;
   \   00000C   8E..         MOV     ?V0 + 0,R6
   \   00000E   74FF         MOV     A,#-0x1
   \   000010   C3           CLR     C
   \   000011   95..         SUBB    A,?V0 + 0
   \   000013   F5..         MOV     ?V0 + 4,A
   \   000015   95E0         SUBB    A,0xE0 /* A   */
   \   000017   F5..         MOV     ?V0 + 5,A
    373          
    374            xDelta = (int32)*x - WHITE_POINT_X;
    375            yDelta = (int32)*y - WHITE_POINT_Y;
   \   000019   8C82         MOV     DPL,R4
   \   00001B   8D83         MOV     DPH,R5
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F5..         MOV     ?V0 + 0,A
   \   000020   A3           INC     DPTR
   \   000021   E0           MOVX    A,@DPTR
   \   000022   F5..         MOV     ?V0 + 1,A
   \   000024   E4           CLR     A
   \   000025   F5..         MOV     ?V0 + 2,A
   \   000027   F5..         MOV     ?V0 + 3,A
   \   000029   90....       MOV     DPTR,#__Constant_ffffaaab
   \   00002C   78..         MOV     R0,#?V0 + 0
   \   00002E   12....       LCALL   ?L_ADD_X
   \   000031   78..         MOV     R0,#?V0 + 0
   \   000033   12....       LCALL   ?L_TO_FLT
   \   000036   85..82       MOV     DPL,?XSP + 0
   \   000039   85..83       MOV     DPH,?XSP + 1
   \   00003C   78..         MOV     R0,#?V0 + 0
   \   00003E   12....       LCALL   ?L_MOV_TO_X
    376          
    377            xDelta = xDelta * (float)localSat/0xFF;
    378            yDelta = yDelta * (float)localSat/0xFF;
    379          
    380            *x = (uint16) (*x - xDelta);
   \   000041   85....       MOV     ?V0 + 0,?V0 + 4
   \   000044   85....       MOV     ?V0 + 1,?V0 + 5
   \   000047   E4           CLR     A
   \   000048   F5..         MOV     ?V0 + 2,A
   \   00004A   F5..         MOV     ?V0 + 3,A
   \   00004C   78..         MOV     R0,#?V0 + 0
   \   00004E   12....       LCALL   ?UL_TO_FLT
   \   000051   8A82         MOV     DPL,R2
   \   000053   8B83         MOV     DPH,R3
   \   000055   E0           MOVX    A,@DPTR
   \   000056   F5..         MOV     ?V0 + 12,A
   \   000058   A3           INC     DPTR
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   F5..         MOV     ?V0 + 13,A
   \   00005C   85....       MOV     ?V0 + 4,?V0 + 12
   \   00005F   F5..         MOV     ?V0 + 5,A
   \   000061   E4           CLR     A
   \   000062   F5..         MOV     ?V0 + 6,A
   \   000064   F5..         MOV     ?V0 + 7,A
   \   000066   78..         MOV     R0,#?V0 + 4
   \   000068   12....       LCALL   ?UL_TO_FLT
   \   00006B   E4           CLR     A
   \   00006C   F5..         MOV     ?V0 + 14,A
   \   00006E   F5..         MOV     ?V0 + 15,A
   \   000070   90....       MOV     DPTR,#__Constant_ffffb000
   \   000073   78..         MOV     R0,#?V0 + 12
   \   000075   12....       LCALL   ?L_ADD_X
   \   000078   78..         MOV     R0,#?V0 + 12
   \   00007A   12....       LCALL   ?L_TO_FLT
   \   00007D   78..         MOV     R0,#?V0 + 12
   \   00007F   79..         MOV     R1,#?V0 + 0
   \   000081   12....       LCALL   ?FLT_MUL
   \   000084   90....       MOV     DPTR,#__Constant_437f0000
   \   000087   78..         MOV     R0,#?V0 + 8
   \   000089   12....       LCALL   ?L_MOV_X
   \   00008C   78..         MOV     R0,#?V0 + 12
   \   00008E   79..         MOV     R1,#?V0 + 8
   \   000090   12....       LCALL   ?FLT_DIV
   \   000093   78..         MOV     R0,#?V0 + 4
   \   000095   79..         MOV     R1,#?V0 + 12
   \   000097   12....       LCALL   ?FLT_SUB
   \   00009A   78..         MOV     R0,#?V0 + 4
   \   00009C   12....       LCALL   ?FLT_TO_L
   \   00009F   8A82         MOV     DPL,R2
   \   0000A1   8B83         MOV     DPH,R3
   \   0000A3   12....       LCALL   ?Subroutine20 & 0xFFFF
    381            *y = (uint16) (*y - yDelta);
   \                     ??CrossCallReturnLabel_27:
   \   0000A6   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_18:
   \   0000A9   12....       LCALL   ?UL_TO_FLT
   \   0000AC   85..82       MOV     DPL,?XSP + 0
   \   0000AF   85..83       MOV     DPH,?XSP + 1
   \   0000B2   78..         MOV     R0,#?V0 + 8
   \   0000B4   12....       LCALL   ?L_MOV_X
   \   0000B7   78..         MOV     R0,#?V0 + 0
   \   0000B9   79..         MOV     R1,#?V0 + 8
   \   0000BB   12....       LCALL   ?FLT_MUL
   \   0000BE   90....       MOV     DPTR,#__Constant_437f0000
   \   0000C1   78..         MOV     R0,#?V0 + 8
   \   0000C3   12....       LCALL   ?L_MOV_X
   \   0000C6   78..         MOV     R0,#?V0 + 0
   \   0000C8   79..         MOV     R1,#?V0 + 8
   \   0000CA   12....       LCALL   ?FLT_DIV
   \   0000CD   78..         MOV     R0,#?V0 + 4
   \   0000CF   79..         MOV     R1,#?V0 + 0
   \   0000D1   12....       LCALL   ?FLT_SUB
   \   0000D4   78..         MOV     R0,#?V0 + 4
   \   0000D6   12....       LCALL   ?FLT_TO_L
   \   0000D9   8C82         MOV     DPL,R4
   \   0000DB   8D83         MOV     DPH,R5
   \   0000DD   E5..         MOV     A,?V0 + 4
   \   0000DF   F0           MOVX    @DPTR,A
   \   0000E0   A3           INC     DPTR
   \   0000E1   E5..         MOV     A,?V0 + 5
   \   0000E3   F0           MOVX    @DPTR,A
    382          
    383            return;
   \   0000E4   7404         MOV     A,#0x4
   \   0000E6   02....       LJMP    ?Subroutine0 & 0xFFFF
    384          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   F5..         MOV     ?V0 + 4,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F5..         MOV     ?V0 + 5,A
   \   000006   E4           CLR     A
   \   000007   F5..         MOV     ?V0 + 6,A
   \   000009   F5..         MOV     ?V0 + 7,A
   \   00000B   78..         MOV     R0,#?V0 + 4
   \   00000D   22           RET
    385          
    386          /*********************************************************************
    387          * @fn      hwLight_XyToSat
    388          *
    389          * @brief   Set saturation parameter according to x,y coordinates
    390          *          relative distance from white point.
    391          *
    392          * @param   x - x of xyY
    393          * @param   y - y of xyY
    394          * @param   hue - current saturated hue matching xy
    395          *
    396          * @return  saturation value to be set
    397          */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    398          static uint8 hwLight_XyToSat(uint16 x, uint16 y, uint8 hue)
   \                     hwLight_XyToSat:
    399          {
   \   000000   74EC         MOV     A,#-0x14
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 20
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    400            uint32 xyDeltas, hueDeltas;
    401          
    402            //we try to avoid polor to cartesan conversion using proportional scaling
    403            xyDeltas = ((uint32)DISTANCE(x, WHITE_POINT_X) + DISTANCE(y, WHITE_POINT_Y));
   \   000007   C3           CLR     C
   \   000008   EA           MOV     A,R2
   \   000009   9401         SUBB    A,#0x1
   \   00000B   EB           MOV     A,R3
   \   00000C   9450         SUBB    A,#0x50
   \   00000E   4008         JC      ??hwLight_XyToSat_0
   \   000010   EA           MOV     A,R2
   \   000011   2400         ADD     A,#0x0
   \   000013   EB           MOV     A,R3
   \   000014   34B0         ADDC    A,#-0x50
   \   000016   8007         SJMP    ??hwLight_XyToSat_1
   \                     ??hwLight_XyToSat_0:
   \   000018   E4           CLR     A
   \   000019   C3           CLR     C
   \   00001A   9A           SUBB    A,R2
   \   00001B   FA           MOV     R2,A
   \   00001C   7450         MOV     A,#0x50
   \   00001E   9B           SUBB    A,R3
   \                     ??hwLight_XyToSat_1:
   \   00001F   FB           MOV     R3,A
   \   000020   C3           CLR     C
   \   000021   EC           MOV     A,R4
   \   000022   9456         SUBB    A,#0x56
   \   000024   ED           MOV     A,R5
   \   000025   9455         SUBB    A,#0x55
   \   000027   4009         JC      ??hwLight_XyToSat_2
   \   000029   EC           MOV     A,R4
   \   00002A   24AB         ADD     A,#-0x55
   \   00002C   F8           MOV     R0,A
   \   00002D   ED           MOV     A,R5
   \   00002E   34AA         ADDC    A,#-0x56
   \   000030   8008         SJMP    ??hwLight_XyToSat_3
   \                     ??hwLight_XyToSat_2:
   \   000032   7455         MOV     A,#0x55
   \   000034   C3           CLR     C
   \   000035   9C           SUBB    A,R4
   \   000036   F8           MOV     R0,A
   \   000037   7455         MOV     A,#0x55
   \   000039   9D           SUBB    A,R5
   \                     ??hwLight_XyToSat_3:
   \   00003A   F9           MOV     R1,A
   \   00003B   8A..         MOV     ?V0 + 0,R2
   \   00003D   8B..         MOV     ?V0 + 1,R3
   \   00003F   E4           CLR     A
   \   000040   F5..         MOV     ?V0 + 2,A
   \   000042   F5..         MOV     ?V0 + 3,A
   \   000044   88..         MOV     ?V0 + 4,R0
   \   000046   89..         MOV     ?V0 + 5,R1
   \   000048   F5..         MOV     ?V0 + 6,A
   \   00004A   F5..         MOV     ?V0 + 7,A
   \   00004C   78..         MOV     R0,#?V0 + 0
   \   00004E   79..         MOV     R1,#?V0 + 4
   \   000050   12....       LCALL   ?L_ADD
    404            hueDeltas = ((uint32)DISTANCE(hueToX[hue], WHITE_POINT_X) + DISTANCE(hueToY[hue], WHITE_POINT_Y));
   \   000053   EE           MOV     A,R6
   \   000054   12....       LCALL   ?Subroutine23 & 0xFFFF
   \                     ??CrossCallReturnLabel_30:
   \   000057   C0E0         PUSH    A
   \   000059   7401         MOV     A,#0x1
   \   00005B   93           MOVC    A,@A+DPTR
   \   00005C   F583         MOV     DPH,A
   \   00005E   D082         POP     DPL
   \   000060   AA82         MOV     R2,DPL
   \   000062   AB83         MOV     R3,DPH
   \   000064   C3           CLR     C
   \   000065   EA           MOV     A,R2
   \   000066   9401         SUBB    A,#0x1
   \   000068   EB           MOV     A,R3
   \   000069   9450         SUBB    A,#0x50
   \   00006B   4008         JC      ??hwLight_XyToSat_4
   \   00006D   EA           MOV     A,R2
   \   00006E   2400         ADD     A,#0x0
   \   000070   EB           MOV     A,R3
   \   000071   34B0         ADDC    A,#-0x50
   \   000073   8007         SJMP    ??hwLight_XyToSat_5
   \                     ??hwLight_XyToSat_4:
   \   000075   E4           CLR     A
   \   000076   C3           CLR     C
   \   000077   9A           SUBB    A,R2
   \   000078   FA           MOV     R2,A
   \   000079   7450         MOV     A,#0x50
   \   00007B   9B           SUBB    A,R3
   \                     ??hwLight_XyToSat_5:
   \   00007C   FB           MOV     R3,A
   \   00007D   12....       LCALL   ?Subroutine24 & 0xFFFF
   \                     ??CrossCallReturnLabel_32:
   \   000080   C0E0         PUSH    A
   \   000082   7401         MOV     A,#0x1
   \   000084   93           MOVC    A,@A+DPTR
   \   000085   F583         MOV     DPH,A
   \   000087   D082         POP     DPL
   \   000089   A882         MOV     R0,DPL
   \   00008B   A983         MOV     R1,DPH
   \   00008D   C3           CLR     C
   \   00008E   E8           MOV     A,R0
   \   00008F   9456         SUBB    A,#0x56
   \   000091   E9           MOV     A,R1
   \   000092   9455         SUBB    A,#0x55
   \   000094   4009         JC      ??hwLight_XyToSat_6
   \   000096   E8           MOV     A,R0
   \   000097   24AB         ADD     A,#-0x55
   \   000099   F8           MOV     R0,A
   \   00009A   E9           MOV     A,R1
   \   00009B   34AA         ADDC    A,#-0x56
   \   00009D   8008         SJMP    ??hwLight_XyToSat_7
   \                     ??hwLight_XyToSat_6:
   \   00009F   7455         MOV     A,#0x55
   \   0000A1   C3           CLR     C
   \   0000A2   98           SUBB    A,R0
   \   0000A3   F8           MOV     R0,A
   \   0000A4   7455         MOV     A,#0x55
   \   0000A6   99           SUBB    A,R1
   \                     ??hwLight_XyToSat_7:
   \   0000A7   F9           MOV     R1,A
   \   0000A8   8A..         MOV     ?V0 + 4,R2
   \   0000AA   8B..         MOV     ?V0 + 5,R3
   \   0000AC   E4           CLR     A
   \   0000AD   88..         MOV     ?V0 + 8,R0
   \   0000AF   89..         MOV     ?V0 + 9,R1
   \   0000B1   F5..         MOV     ?V0 + 10,A
   \   0000B3   F5..         MOV     ?V0 + 11,A
   \   0000B5   78..         MOV     R0,#?V0 + 4
   \   0000B7   79..         MOV     R1,#?V0 + 8
   \   0000B9   12....       LCALL   ?L_ADD
    405          
    406            return ( (hueDeltas) ? ((xyDeltas * COLOR_SAT_MAX) / hueDeltas) : COLOR_SAT_MAX );
   \   0000BC   E5..         MOV     A,?V0 + 4
   \   0000BE   45..         ORL     A,?V0 + 5
   \   0000C0   45..         ORL     A,?V0 + 6
   \   0000C2   45..         ORL     A,?V0 + 7
   \   0000C4   601A         JZ      ??hwLight_XyToSat_8
   \   0000C6   90....       MOV     DPTR,#__Constant_fe
   \   0000C9   78..         MOV     R0,#?V0 + 8
   \   0000CB   12....       LCALL   ?L_MOV_X
   \   0000CE   78..         MOV     R0,#?V0 + 0
   \   0000D0   79..         MOV     R1,#?V0 + 8
   \   0000D2   12....       LCALL   ?L_MUL
   \   0000D5   78..         MOV     R0,#?V0 + 0
   \   0000D7   79..         MOV     R1,#?V0 + 4
   \   0000D9   12....       LCALL   ?UL_DIV_MOD
   \   0000DC   A9..         MOV     R1,?V0 + 0
   \   0000DE   8002         SJMP    ??hwLight_XyToSat_9
   \                     ??hwLight_XyToSat_8:
   \   0000E0   79FE         MOV     R1,#-0x2
   \                     ??hwLight_XyToSat_9:
   \   0000E2                REQUIRE ?Subroutine2
   \   0000E2                ; // Fall through to label ?Subroutine2
    407          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   7F0C         MOV     R7,#0xc
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine24:
   \   000000   12....       LCALL   ?Subroutine30 & 0xFFFF
   \                     ??CrossCallReturnLabel_49:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine23:
   \   000000   12....       LCALL   ?Subroutine31 & 0xFFFF
   \                     ??CrossCallReturnLabel_51:
   \   000003   22           RET
    408          
    409          /*********************************************************************
    410           * @fn      hwLight_UpdateColorMode
    411           *
    412           * @brief   Calculates the new xy of hue/sat value on color mode change
    413           *
    414           * @param   NewColorMode - Color Mode Attribute value
    415           *
    416           * @return  none
    417           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    418          void hwLight_UpdateColorMode(uint8 NewColorMode)
   \                     hwLight_UpdateColorMode:
    419          {
   \   000000   74EC         MOV     A,#-0x14
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 20
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FF           MOV     R7,A
    420            uint8 idx, chosenIdx=0;
   \   000007   7E00         MOV     R6,#0x0
    421            uint32 currDist=0, minDist = 0xFFFFF;
   \   000009   75..FF       MOV     ?V0 + 4,#-0x1
   \   00000C   75..FF       MOV     ?V0 + 5,#-0x1
   \   00000F   75..0F       MOV     ?V0 + 6,#0xf
   \   000012   8E..         MOV     ?V0 + 7,R6
    422          
    423            if( NewColorMode != zclColor_ColorMode )
   \   000014   90....       MOV     DPTR,#zclColor_ColorMode
   \   000017   E0           MOVX    A,@DPTR
   \   000018   6F           XRL     A,R7
   \   000019   7003         JNZ     $+5
   \   00001B   02....       LJMP    ??hwLight_UpdateColorMode_0 & 0xFFFF
    424            {
    425              if( NewColorMode == COLOR_MODE_CURRENT_X_Y )
   \   00001E   7401         MOV     A,#0x1
   \   000020   6F           XRL     A,R7
   \   000021   7027         JNZ     ??hwLight_UpdateColorMode_1
    426              {
    427                //update the current xy values from hue and sat
    428                zclColor_CurrentX = hueToX[zclColor_CurrentHue];
   \   000023   90....       MOV     DPTR,#zclColor_CurrentHue
   \   000026   E0           MOVX    A,@DPTR
   \   000027   12....       LCALL   ?Subroutine22 & 0xFFFF
   \                     ??CrossCallReturnLabel_29:
   \   00002A   90....       MOV     DPTR,#zclColor_CurrentX
   \   00002D   12....       LCALL   ?Subroutine17 & 0xFFFF
    429                zclColor_CurrentY = hueToY[zclColor_CurrentHue];
   \                     ??CrossCallReturnLabel_23:
   \   000030   90....       MOV     DPTR,#zclColor_CurrentY
   \   000033   E8           MOV     A,R0
   \   000034   12....       LCALL   ??Subroutine37_0 & 0xFFFF
    430          
    431                hwLight_satToXy( &zclColor_CurrentX, &zclColor_CurrentY, zclColor_CurrentSaturation );
   \                     ??CrossCallReturnLabel_70:
   \   000037                ; Setup parameters for call to function hwLight_satToXy
   \   000037   90....       MOV     DPTR,#zclColor_CurrentSaturation
   \   00003A   E0           MOVX    A,@DPTR
   \   00003B   F9           MOV     R1,A
   \   00003C   7C..         MOV     R4,#zclColor_CurrentY & 0xff
   \   00003E   7D..         MOV     R5,#(zclColor_CurrentY >> 8) & 0xff
   \   000040   7A..         MOV     R2,#zclColor_CurrentX & 0xff
   \   000042   7B..         MOV     R3,#(zclColor_CurrentX >> 8) & 0xff
   \   000044   12....       LCALL   ??hwLight_satToXy?relay
   \   000047   02....       LJMP    ??hwLight_UpdateColorMode_0 & 0xFFFF
    432              }
    433              else if( NewColorMode == COLOR_MODE_CURRENT_HUE_SATURATION )
   \                     ??hwLight_UpdateColorMode_1:
   \   00004A   EF           MOV     A,R7
   \   00004B   6003         JZ      $+5
   \   00004D   02....       LJMP    ??hwLight_UpdateColorMode_0 & 0xFFFF
    434              {
    435                //update the current hue/sat values from xy
    436                //Loop thrugh hueToX/Y tables and look for the value closest to the
    437                //zclColor_CurrentX and zclColor_CurrentY
    438                for( idx = 0; idx != 0xFF; idx++ )
   \   000050   7A00         MOV     R2,#0x0
    439                {
    440                  currDist = ( (uint32)DISTANCE(hueToX[idx], zclColor_CurrentX)
    441                               + DISTANCE(hueToY[idx], zclColor_CurrentY) );
   \                     ??hwLight_UpdateColorMode_2:
   \   000052   EA           MOV     A,R2
   \   000053   12....       LCALL   ?Subroutine23 & 0xFFFF
   \                     ??CrossCallReturnLabel_31:
   \   000056   C0E0         PUSH    A
   \   000058   7401         MOV     A,#0x1
   \   00005A   93           MOVC    A,@A+DPTR
   \   00005B   F583         MOV     DPH,A
   \   00005D   D082         POP     DPL
   \   00005F   8582..       MOV     ?V0 + 0,DPL
   \   000062   8583..       MOV     ?V0 + 1,DPH
   \   000065   90....       MOV     DPTR,#zclColor_CurrentX
   \   000068   C3           CLR     C
   \   000069   E0           MOVX    A,@DPTR
   \   00006A   95..         SUBB    A,?V0 + 0
   \   00006C   A3           INC     DPTR
   \   00006D   E0           MOVX    A,@DPTR
   \   00006E   95..         SUBB    A,?V0 + 1
   \   000070   90....       MOV     DPTR,#zclColor_CurrentX
   \   000073   E0           MOVX    A,@DPTR
   \   000074   500E         JNC     ??hwLight_UpdateColorMode_3
   \   000076   FC           MOV     R4,A
   \   000077   A3           INC     DPTR
   \   000078   E0           MOVX    A,@DPTR
   \   000079   FD           MOV     R5,A
   \   00007A   E5..         MOV     A,?V0 + 0
   \   00007C   C3           CLR     C
   \   00007D   9C           SUBB    A,R4
   \   00007E   FC           MOV     R4,A
   \   00007F   E5..         MOV     A,?V0 + 1
   \   000081   9D           SUBB    A,R5
   \   000082   8008         SJMP    ??hwLight_UpdateColorMode_4
   \                     ??hwLight_UpdateColorMode_3:
   \   000084   C3           CLR     C
   \   000085   95..         SUBB    A,?V0 + 0
   \   000087   FC           MOV     R4,A
   \   000088   A3           INC     DPTR
   \   000089   E0           MOVX    A,@DPTR
   \   00008A   95..         SUBB    A,?V0 + 1
   \                     ??hwLight_UpdateColorMode_4:
   \   00008C   FD           MOV     R5,A
   \   00008D   12....       LCALL   ?Subroutine24 & 0xFFFF
   \                     ??CrossCallReturnLabel_33:
   \   000090   C0E0         PUSH    A
   \   000092   7401         MOV     A,#0x1
   \   000094   93           MOVC    A,@A+DPTR
   \   000095   F583         MOV     DPH,A
   \   000097   D082         POP     DPL
   \   000099   8582..       MOV     ?V0 + 0,DPL
   \   00009C   8583..       MOV     ?V0 + 1,DPH
   \   00009F   90....       MOV     DPTR,#zclColor_CurrentY
   \   0000A2   C3           CLR     C
   \   0000A3   E0           MOVX    A,@DPTR
   \   0000A4   95..         SUBB    A,?V0 + 0
   \   0000A6   A3           INC     DPTR
   \   0000A7   E0           MOVX    A,@DPTR
   \   0000A8   95..         SUBB    A,?V0 + 1
   \   0000AA   90....       MOV     DPTR,#zclColor_CurrentY
   \   0000AD   E0           MOVX    A,@DPTR
   \   0000AE   500E         JNC     ??hwLight_UpdateColorMode_5
   \   0000B0   F8           MOV     R0,A
   \   0000B1   A3           INC     DPTR
   \   0000B2   E0           MOVX    A,@DPTR
   \   0000B3   F9           MOV     R1,A
   \   0000B4   E5..         MOV     A,?V0 + 0
   \   0000B6   C3           CLR     C
   \   0000B7   98           SUBB    A,R0
   \   0000B8   F8           MOV     R0,A
   \   0000B9   E5..         MOV     A,?V0 + 1
   \   0000BB   99           SUBB    A,R1
   \   0000BC   8008         SJMP    ??hwLight_UpdateColorMode_6
   \                     ??hwLight_UpdateColorMode_5:
   \   0000BE   C3           CLR     C
   \   0000BF   95..         SUBB    A,?V0 + 0
   \   0000C1   F8           MOV     R0,A
   \   0000C2   A3           INC     DPTR
   \   0000C3   E0           MOVX    A,@DPTR
   \   0000C4   95..         SUBB    A,?V0 + 1
   \                     ??hwLight_UpdateColorMode_6:
   \   0000C6   F9           MOV     R1,A
   \   0000C7   8C..         MOV     ?V0 + 0,R4
   \   0000C9   8D..         MOV     ?V0 + 1,R5
   \   0000CB   E4           CLR     A
   \   0000CC   F5..         MOV     ?V0 + 2,A
   \   0000CE   F5..         MOV     ?V0 + 3,A
   \   0000D0   88..         MOV     ?V0 + 8,R0
   \   0000D2   89..         MOV     ?V0 + 9,R1
   \   0000D4   F5..         MOV     ?V0 + 10,A
   \   0000D6   F5..         MOV     ?V0 + 11,A
   \   0000D8   78..         MOV     R0,#?V0 + 0
   \   0000DA   79..         MOV     R1,#?V0 + 8
   \   0000DC   12....       LCALL   ?L_ADD
    442          
    443                  if ( currDist < minDist )
   \   0000DF   78..         MOV     R0,#?V0 + 4
   \   0000E1   79..         MOV     R1,#?V0 + 0
   \   0000E3   12....       LCALL   ?UL_GT
   \   0000E6   500E         JNC     ??hwLight_UpdateColorMode_7
    444                  {
    445                    chosenIdx = idx;
   \   0000E8   EA           MOV     A,R2
   \   0000E9   FE           MOV     R6,A
    446                    minDist = currDist;
   \   0000EA   85....       MOV     ?V0 + 4,?V0 + 0
   \   0000ED   85....       MOV     ?V0 + 5,?V0 + 1
   \   0000F0   85....       MOV     ?V0 + 6,?V0 + 2
   \   0000F3   85....       MOV     ?V0 + 7,?V0 + 3
    447                  }
    448                }
   \                     ??hwLight_UpdateColorMode_7:
   \   0000F6   0A           INC     R2
   \   0000F7   74FF         MOV     A,#-0x1
   \   0000F9   6A           XRL     A,R2
   \   0000FA   6003         JZ      $+5
   \   0000FC   02....       LJMP    ??hwLight_UpdateColorMode_2 & 0xFFFF
    449                zclColor_CurrentHue = chosenIdx;
   \   0000FF   EE           MOV     A,R6
   \   000100   90....       MOV     DPTR,#zclColor_CurrentHue
   \   000103   F0           MOVX    @DPTR,A
    450          
    451                zclColor_EnhancedCurrentHue = (uint16)zclColor_CurrentHue << 8;
   \   000104   12....       LCALL   ?Subroutine21 & 0xFFFF
    452          
    453                zclColor_CurrentSaturation = hwLight_XyToSat( zclColor_CurrentX, zclColor_CurrentY, zclColor_CurrentHue );
   \                     ??CrossCallReturnLabel_73:
   \   000107                ; Setup parameters for call to function hwLight_XyToSat
   \   000107   12....       LCALL   ?Subroutine6 & 0xFFFF
    454              }
    455              else //do nothing COLOR_MODE_COLOR_TEMPERATURE not supported
    456              {
    457              }
    458            }
   \                     ??CrossCallReturnLabel_63:
   \   00010A   12....       LCALL   ??hwLight_XyToSat?relay
   \   00010D   E9           MOV     A,R1
   \   00010E   90....       MOV     DPTR,#zclColor_CurrentSaturation
   \   000111   F0           MOVX    @DPTR,A
    459          
    460            return;
   \                     ??hwLight_UpdateColorMode_0:
   \   000112   02....       LJMP    ?Subroutine2 & 0xFFFF
    461          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   90....       MOV     DPTR,#zclColor_CurrentY
   \   000003   12....       LCALL   ?Subroutine29 & 0xFFFF
   \                     ??CrossCallReturnLabel_47:
   \   000006   90....       MOV     DPTR,#zclColor_CurrentX
   \   000009                REQUIRE ??Subroutine34_0
   \   000009                ; // Fall through to label ??Subroutine34_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine21:
   \   000000   F9           MOV     R1,A
   \   000001   90....       MOV     DPTR,#zclColor_EnhancedCurrentHue
   \   000004                REQUIRE ??Subroutine36_0
   \   000004                ; // Fall through to label ??Subroutine36_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine36_0:
   \   000000   E4           CLR     A
   \   000001                REQUIRE ??Subroutine37_0
   \   000001                ; // Fall through to label ??Subroutine37_0
    462          
    463          
    464          /*********************************************************************
    465           * @fn      hwLight_ApplyUpdate16b
    466           *
    467           * @brief
    468           *
    469           * @param   pCurrentVal - pointer to current 16bit attr (i.e. zclColor_CurrentHue) value
    470           * @param   pCurrentVal_256  - pointer to current attr value at hi resolution (x256)
    471           * @param   pStepVal_256 - pointer to the required step value of CurrentVal_256
    472           * @param   pRemainingTime - pointer to the time remaining,  in 100ms,  to get to the target value
    473           * @param   minLevel - Minimun val of attr
    474           * @param   maxLevel - Maximun val of attr
    475           *
    476           * @return  none
    477           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    478          void hwLight_ApplyUpdate16b( uint16 *pCurrentVal, uint32 *pCurrentVal_256, int32 *pStepVal_256, uint16 *pRemainingTime, uint16 minLevel, uint16 maxLevel, bool wrap )
   \                     hwLight_ApplyUpdate16b:
    479          {
   \   000000   74E8         MOV     A,#-0x18
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 24
   \   000005                ; Auto size: 9
   \   000005   74F7         MOV     A,#-0x9
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   7403         MOV     A,#0x3
   \   00000C   12....       LCALL   ?XSTACK_DISP0_8
   \   00000F   12....       LCALL   ?Subroutine18 & 0xFFFF
   \                     ??CrossCallReturnLabel_24:
   \   000012   12....       LCALL   ?XSTACK_DISP0_8
   \   000015   E9           MOV     A,R1
   \   000016   F0           MOVX    @DPTR,A
   \   000017   7425         MOV     A,#0x25
   \   000019   12....       LCALL   ?XSTACK_DISP0_8
   \   00001C   12....       LCALL   ??Subroutine34_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_62:
   \   00001F   EA           MOV     A,R2
   \   000020   FC           MOV     R4,A
   \   000021   EB           MOV     A,R3
   \   000022   FD           MOV     R5,A
   \   000023   EC           MOV     A,R4
   \   000024   CD           XCH     A,R5
   \   000025   FE           MOV     R6,A
   \   000026   7405         MOV     A,#0x5
   \   000028   12....       LCALL   ?XSTACK_DISP0_8
   \   00002B   E4           CLR     A
   \   00002C   F0           MOVX    @DPTR,A
   \   00002D   A3           INC     DPTR
   \   00002E   ED           MOV     A,R5
   \   00002F   F0           MOVX    @DPTR,A
   \   000030   A3           INC     DPTR
   \   000031   EE           MOV     A,R6
   \   000032   F0           MOVX    @DPTR,A
   \   000033   A3           INC     DPTR
   \   000034   E4           CLR     A
   \   000035   F0           MOVX    @DPTR,A
   \   000036   7427         MOV     A,#0x27
   \   000038   12....       LCALL   ?XSTACK_DISP0_8
   \   00003B   12....       LCALL   ?Subroutine29 & 0xFFFF
   \                     ??CrossCallReturnLabel_46:
   \   00003E   7421         MOV     A,#0x21
   \   000040   12....       LCALL   ?XSTACK_DISP0_8
   \   000043   E0           MOVX    A,@DPTR
   \   000044   FE           MOV     R6,A
   \   000045   A3           INC     DPTR
   \   000046   E0           MOVX    A,@DPTR
   \   000047   FF           MOV     R7,A
   \   000048   8E82         MOV     DPL,R6
   \   00004A   8F83         MOV     DPH,R7
   \   00004C   78..         MOV     R0,#?V0 + 4
   \   00004E   12....       LCALL   ?L_MOV_X
   \   000051   90....       MOV     DPTR,#__Constant_1
   \   000054   78..         MOV     R0,#?V0 + 4
   \   000056   12....       LCALL   ?SL_GE_X
   \   000059   4003         JC      $+5
   \   00005B   02....       LJMP    ??hwLight_ApplyUpdate16b_0 & 0xFFFF
   \   00005E   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_77:
   \   000061   78..         MOV     R0,#?V0 + 8
   \   000063   12....       LCALL   ?L_MOV_X
   \   000066   85....       MOV     ?V0 + 0,?V0 + 8
   \   000069   85....       MOV     ?V0 + 1,?V0 + 9
   \   00006C   85....       MOV     ?V0 + 2,?V0 + 10
   \   00006F   85....       MOV     ?V0 + 3,?V0 + 11
   \   000072   78..         MOV     R0,#?V0 + 0
   \   000074   79..         MOV     R1,#?V0 + 4
   \   000076   12....       LCALL   ?L_ADD
   \   000079   90....       MOV     DPTR,#__Constant_100
   \   00007C   78..         MOV     R0,#?V0 + 12
   \   00007E   12....       LCALL   ?L_MOV_X
   \   000081   78..         MOV     R0,#?V0 + 0
   \   000083   79..         MOV     R1,#?V0 + 12
   \   000085   12....       LCALL   ?L_DIV_MOD
   \   000088   8C..         MOV     ?V0 + 12,R4
   \   00008A   8D..         MOV     ?V0 + 13,R5
   \   00008C   E4           CLR     A
   \   00008D   F5..         MOV     ?V0 + 14,A
   \   00008F   F5..         MOV     ?V0 + 15,A
   \   000091   78..         MOV     R0,#?V0 + 0
   \   000093   79..         MOV     R1,#?V0 + 12
   \   000095   12....       LCALL   ?SL_GT
   \   000098   4003         JC      $+5
   \   00009A   02....       LJMP    ??hwLight_ApplyUpdate16b_1 & 0xFFFF
    480            if( (*pStepVal_256 > 0) && ((((int32)*pCurrentVal_256 + *pStepVal_256) / 256) > maxLevel) )
    481            {
    482              if(wrap)
   \   00009D   8C..         MOV     ?V0 + 0,R4
   \   00009F   8D..         MOV     ?V0 + 1,R5
   \   0000A1   75..00       MOV     ?V0 + 2,#0x0
   \   0000A4   E4           CLR     A
   \   0000A5   C5..         XCH     A,?V0 + 0
   \   0000A7   C5..         XCH     A,?V0 + 1
   \   0000A9   C5..         XCH     A,?V0 + 2
   \   0000AB   F5..         MOV     ?V0 + 3,A
   \   0000AD   7402         MOV     A,#0x2
   \   0000AF   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B2   E0           MOVX    A,@DPTR
   \   0000B3   602B         JZ      ??hwLight_ApplyUpdate16b_2
    483              {
    484                *pCurrentVal_256 = ( (uint32)minLevel * 256 ) + ( ( *pCurrentVal_256 + *pStepVal_256 ) - ( (uint32)maxLevel * 256 ) ) - 256;
   \   0000B5   7405         MOV     A,#0x5
   \   0000B7   12....       LCALL   ?XSTACK_DISP0_8
   \   0000BA   78..         MOV     R0,#?V0 + 8
   \   0000BC   12....       LCALL   ?L_ADD_X
   \   0000BF   78..         MOV     R0,#?V0 + 8
   \   0000C1   79..         MOV     R1,#?V0 + 4
   \   0000C3   12....       LCALL   ?L_ADD
   \   0000C6   78..         MOV     R0,#?V0 + 8
   \   0000C8   79..         MOV     R1,#?V0 + 0
   \   0000CA   12....       LCALL   ?L_SUB
   \   0000CD   90....       MOV     DPTR,#__Constant_ffffff00
   \   0000D0   78..         MOV     R0,#?V0 + 8
   \   0000D2   12....       LCALL   ?L_ADD_X
   \   0000D5   12....       LCALL   ?Subroutine12 & 0xFFFF
    485              }
   \                     ??CrossCallReturnLabel_78:
   \   0000D8   78..         MOV     R0,#?V0 + 8
   \   0000DA   12....       LCALL   ?L_MOV_TO_X
   \   0000DD   02....       LJMP    ??hwLight_ApplyUpdate16b_3 & 0xFFFF
    486              else
    487              {
    488                *pCurrentVal_256 = (uint32)maxLevel * 256;
   \                     ??hwLight_ApplyUpdate16b_2:
   \   0000E0   12....       LCALL   ?Subroutine4 & 0xFFFF
    489              }
    490            }
   \                     ??CrossCallReturnLabel_66:
   \   0000E3   12....       LCALL   ?L_MOV_TO_X
   \   0000E6   02....       LJMP    ??hwLight_ApplyUpdate16b_3 & 0xFFFF
    491            else if( (*pStepVal_256 < 0) && ((((int32)*pCurrentVal_256 + *pStepVal_256) / 256 ) < minLevel) )
   \                     ??hwLight_ApplyUpdate16b_0:
   \   0000E9   90....       MOV     DPTR,#__Constant_0
   \   0000EC   78..         MOV     R0,#?V0 + 4
   \   0000EE   12....       LCALL   ?SL_GE_X
   \   0000F1   407B         JC      ??hwLight_ApplyUpdate16b_1
   \   0000F3   8A..         MOV     ?V0 + 8,R2
   \   0000F5   8B..         MOV     ?V0 + 9,R3
   \   0000F7   E4           CLR     A
   \   0000F8   F5..         MOV     ?V0 + 10,A
   \   0000FA   F5..         MOV     ?V0 + 11,A
   \   0000FC   12....       LCALL   ?Subroutine12 & 0xFFFF
   \                     ??CrossCallReturnLabel_79:
   \   0000FF   85....       MOV     ?V0 + 0,?V0 + 4
   \   000102   85....       MOV     ?V0 + 1,?V0 + 5
   \   000105   85....       MOV     ?V0 + 2,?V0 + 6
   \   000108   85....       MOV     ?V0 + 3,?V0 + 7
   \   00010B   78..         MOV     R0,#?V0 + 0
   \   00010D   12....       LCALL   ?L_ADD_X
   \   000110   90....       MOV     DPTR,#__Constant_100
   \   000113   78..         MOV     R0,#?V0 + 12
   \   000115   12....       LCALL   ?L_MOV_X
   \   000118   78..         MOV     R0,#?V0 + 0
   \   00011A   79..         MOV     R1,#?V0 + 12
   \   00011C   12....       LCALL   ?L_DIV_MOD
   \   00011F   78..         MOV     R0,#?V0 + 8
   \   000121   79..         MOV     R1,#?V0 + 0
   \   000123   12....       LCALL   ?SL_GT
   \   000126   5046         JNC     ??hwLight_ApplyUpdate16b_1
    492            {
    493              if(wrap)
   \   000128   7402         MOV     A,#0x2
   \   00012A   12....       LCALL   ?XSTACK_DISP0_8
   \   00012D   E0           MOVX    A,@DPTR
   \   00012E   602E         JZ      ??hwLight_ApplyUpdate16b_4
    494              {
    495                *pCurrentVal_256 = ( (uint32)maxLevel * 256 ) - ( ( (uint32)minLevel * 256 ) - ((int32)*pCurrentVal_256 + *pStepVal_256) ) + 256;
   \   000130   8C..         MOV     ?V0 + 0,R4
   \   000132   8D..         MOV     ?V0 + 1,R5
   \   000134   E4           CLR     A
   \   000135   F5..         MOV     ?V0 + 2,A
   \   000137   F5..         MOV     ?V0 + 3,A
   \   000139   78..         MOV     R0,#?V0 + 0
   \   00013B   79..         MOV     R1,#?V0 + 8
   \   00013D   12....       LCALL   ?L_SUB
   \   000140   7408         MOV     A,#0x8
   \   000142   78..         MOV     R0,#?V0 + 0
   \   000144   12....       LCALL   ?L_SHL
   \   000147   78..         MOV     R0,#?V0 + 0
   \   000149   79..         MOV     R1,#?V0 + 4
   \   00014B   12....       LCALL   ?L_ADD
   \   00014E   90....       MOV     DPTR,#__Constant_100
   \   000151   78..         MOV     R0,#?V0 + 0
   \   000153   12....       LCALL   ?L_ADD_X
   \   000156   12....       LCALL   ?Subroutine4 & 0xFFFF
    496              }
   \                     ??CrossCallReturnLabel_67:
   \   000159   12....       LCALL   ?L_ADD_TO_X
   \   00015C   8018         SJMP    ??hwLight_ApplyUpdate16b_3
    497              else
    498              {
    499                *pCurrentVal_256 = (uint32)minLevel * 256;
   \                     ??hwLight_ApplyUpdate16b_4:
   \   00015E   7405         MOV     A,#0x5
   \   000160   12....       LCALL   ?XSTACK_DISP0_8
   \   000163   12....       LCALL   ?XLOAD_R2345
   \   000166   12....       LCALL   ?Subroutine12 & 0xFFFF
    500              }
    501            }
   \                     ??CrossCallReturnLabel_80:
   \   000169   12....       LCALL   ?XSTORE_R2345
   \   00016C   8008         SJMP    ??hwLight_ApplyUpdate16b_3
    502            else
    503            {
    504              *pCurrentVal_256 += *pStepVal_256;
   \                     ??hwLight_ApplyUpdate16b_1:
   \   00016E   12....       LCALL   ?Subroutine12 & 0xFFFF
    505            }
   \                     ??CrossCallReturnLabel_81:
   \   000171   78..         MOV     R0,#?V0 + 4
   \   000173   12....       LCALL   ?L_ADD_TO_X
    506          
    507            if (*pStepVal_256 > 0)
   \                     ??hwLight_ApplyUpdate16b_3:
   \   000176   12....       LCALL   ?Subroutine4 & 0xFFFF
   \                     ??CrossCallReturnLabel_68:
   \   000179   12....       LCALL   ?L_MOV_X
   \   00017C   90....       MOV     DPTR,#__Constant_1
   \   00017F   78..         MOV     R0,#?V0 + 4
   \   000181   12....       LCALL   ?L_MOV_X
   \   000184   8E82         MOV     DPL,R6
   \   000186   8F83         MOV     DPH,R7
   \   000188   78..         MOV     R0,#?V0 + 4
   \   00018A   12....       LCALL   ?SL_GT_X
   \   00018D   4011         JC      ??hwLight_ApplyUpdate16b_5
    508            {
    509              //fraction step compensation
    510              *pCurrentVal = ( *pCurrentVal_256 + 127 ) / 256;
   \   00018F   90....       MOV     DPTR,#__Constant_7f
   \   000192   78..         MOV     R0,#?V0 + 0
   \   000194   12....       LCALL   ?L_ADD_X
   \   000197   7408         MOV     A,#0x8
   \   000199   78..         MOV     R0,#?V0 + 0
   \   00019B   12....       LCALL   ?UL_SHR
   \   00019E   8006         SJMP    ??hwLight_ApplyUpdate16b_6
    511            }
    512            else
    513            {
    514              *pCurrentVal = ( *pCurrentVal_256 / 256 );
   \                     ??hwLight_ApplyUpdate16b_5:
   \   0001A0   E5..         MOV     A,?V0 + 2
   \   0001A2   C5..         XCH     A,?V0 + 1
   \   0001A4   F5..         MOV     ?V0 + 0,A
   \                     ??hwLight_ApplyUpdate16b_6:
   \   0001A6   7403         MOV     A,#0x3
   \   0001A8   12....       LCALL   ?XSTACK_DISP0_8
    515            }
   \   0001AB   12....       LCALL   ?Subroutine8 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   0001AE   7423         MOV     A,#0x23
   \   0001B0   12....       LCALL   ?XSTACK_DISP0_8
   \   0001B3   12....       LCALL   ?Subroutine5 & 0xFFFF
    516          
    517            if (*pRemainingTime == 0x0)
   \                     ??CrossCallReturnLabel_0:
   \   0001B6   7022         JNZ     ??hwLight_ApplyUpdate16b_7
    518            {
    519              // align variables
    520              *pCurrentVal_256 = ((uint32)*pCurrentVal) * 256;
   \   0001B8   7403         MOV     A,#0x3
   \   0001BA   12....       LCALL   ?XSTACK_DISP0_8
   \   0001BD   12....       LCALL   ??Subroutine39_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_83:
   \   0001C0   FA           MOV     R2,A
   \   0001C1   A3           INC     DPTR
   \   0001C2   E0           MOVX    A,@DPTR
   \   0001C3   FB           MOV     R3,A
   \   0001C4   EA           MOV     A,R2
   \   0001C5   CB           XCH     A,R3
   \   0001C6   FC           MOV     R4,A
   \   0001C7   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   0001CA   F0           MOVX    @DPTR,A
   \   0001CB   A3           INC     DPTR
   \   0001CC   EC           MOV     A,R4
   \   0001CD   F0           MOVX    @DPTR,A
   \   0001CE   A3           INC     DPTR
   \   0001CF   E4           CLR     A
   \   0001D0   F0           MOVX    @DPTR,A
    521              *pStepVal_256 = 0;
   \   0001D1   8E82         MOV     DPL,R6
   \   0001D3   8F83         MOV     DPH,R7
   \   0001D5   12....       LCALL   ??Subroutine33_0 & 0xFFFF
    522            }
   \                     ??CrossCallReturnLabel_52:
   \   0001D8   800D         SJMP    ??CrossCallReturnLabel_20
    523            else if (*pRemainingTime != 0xFFFF)
   \                     ??hwLight_ApplyUpdate16b_7:
   \   0001DA   74FF         MOV     A,#-0x1
   \   0001DC   6A           XRL     A,R2
   \   0001DD   7003         JNZ     ??hwLight_ApplyUpdate16b_8
   \   0001DF   74FF         MOV     A,#-0x1
   \   0001E1   6B           XRL     A,R3
   \                     ??hwLight_ApplyUpdate16b_8:
   \   0001E2   6004         JZ      ??hwLight_ApplyUpdate16b_9
    524            {
    525              *pRemainingTime = *pRemainingTime-1;
   \   0001E4   12....       LCALL   ?Subroutine16 & 0xFFFF
    526            }
   \                     ??CrossCallReturnLabel_20:
   \   0001E7   F0           MOVX    @DPTR,A
    527          
    528            hwLight_Refresh( REFRESH_AUTO );
   \                     ??hwLight_ApplyUpdate16b_9:
   \   0001E8                ; Setup parameters for call to function hwLight_Refresh
   \   0001E8   7900         MOV     R1,#0x0
   \   0001EA   12....       LCALL   ??hwLight_Refresh?relay
    529            SCENE_INVALID();
   \   0001ED   90....       MOV     DPTR,#zllSampleLight_SceneValid
   \   0001F0   E4           CLR     A
   \   0001F1   F0           MOVX    @DPTR,A
    530          }
   \   0001F2   7409         MOV     A,#0x9
   \   0001F4                REQUIRE ?Subroutine0
   \   0001F4                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006                REQUIRE ??Subroutine35_0
   \   000006                ; // Fall through to label ??Subroutine35_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine35_0:
   \   000000   12....       LCALL   ?Subroutine28 & 0xFFFF
   \                     ??CrossCallReturnLabel_90:
   \   000003   78..         MOV     R0,#?V0 + 0
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine18:
   \   000000   EA           MOV     A,R2
   \   000001   F0           MOVX    @DPTR,A
   \   000002   A3           INC     DPTR
   \   000003   EB           MOV     A,R3
   \   000004   F0           MOVX    @DPTR,A
   \   000005   85..82       MOV     DPL,?XSP + 0
   \   000008   85..83       MOV     DPH,?XSP + 1
   \   00000B   EC           MOV     A,R4
   \   00000C   F0           MOVX    @DPTR,A
   \   00000D   A3           INC     DPTR
   \   00000E   ED           MOV     A,R5
   \   00000F   F0           MOVX    @DPTR,A
   \   000010   7402         MOV     A,#0x2
   \   000012   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   8882         MOV     DPL,R0
   \   000002   8983         MOV     DPH,R1
   \   000004   E0           MOVX    A,@DPTR
   \   000005   24FF         ADD     A,#-0x1
   \   000007   F0           MOVX    @DPTR,A
   \   000008   A3           INC     DPTR
   \   000009   E0           MOVX    A,@DPTR
   \   00000A   34FF         ADDC    A,#-0x1
   \   00000C   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006                REQUIRE ??Subroutine38_0
   \   000006                ; // Fall through to label ??Subroutine38_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine27:
   \   000000   12....       LCALL   ?Subroutine32 & 0xFFFF
   \                     ??CrossCallReturnLabel_93:
   \   000003   E4           CLR     A
   \   000004   F0           MOVX    @DPTR,A
   \   000005   A3           INC     DPTR
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006   12....       LCALL   ?Subroutine27 & 0xFFFF
   \                     ??CrossCallReturnLabel_42:
   \   000009   EB           MOV     A,R3
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   12....       LCALL   ?Subroutine26 & 0xFFFF
   \                     ??CrossCallReturnLabel_39:
   \   000003   8882         MOV     DPL,R0
   \   000005   8983         MOV     DPH,R1
   \   000007   E0           MOVX    A,@DPTR
   \   000008   FA           MOV     R2,A
   \   000009   A3           INC     DPTR
   \   00000A   E0           MOVX    A,@DPTR
   \   00000B   FB           MOV     R3,A
   \   00000C   EA           MOV     A,R2
   \   00000D   4B           ORL     A,R3
   \   00000E   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine39_0:
   \   000000   12....       LCALL   ?Subroutine28 & 0xFFFF
   \                     ??CrossCallReturnLabel_92:
   \   000003   E0           MOVX    A,@DPTR
   \   000004   22           RET
    531          
    532          /*********************************************************************
    533           * @fn      hwLight_UpdateColor
    534           *
    535           * @brief   Update light output according to color attributes
    536           *
    537           * @param   none
    538           *
    539           * @return  none
    540           */
    541          static void hwLight_UpdateColor(void)
    542          {
    543          
    544            if(zclColor_ColorMode == COLOR_MODE_CURRENT_X_Y)
    545            {
    546          #ifdef ZLL_HW_LED_LAMP
    547              hwLight_UpdateLampColor(zclColor_CurrentX, zclColor_CurrentY, zclLevel_CurrentLevel);
    548          #else //ZLL_HW_LED_LAMP #else
    549            #if defined ZCL_LEVEL_CTRL
    550              HalLcdWriteStringValue( "Level:", zclLevel_CurrentLevel, 10, HAL_LCD_LINE_1 );
    551            #endif //ZCL_LEVEL_CTRL
    552              HalLcdWriteStringValue( "x: 0x", zclColor_CurrentX, 16, HAL_LCD_LINE_2 );
    553              HalLcdWriteStringValue( "y: 0x", zclColor_CurrentY, 16, HAL_LCD_LINE_3 );
    554          #endif //ZLL_HW_LED_LAMP
    555            }
    556            else
    557            {
    558              if(zclColor_EnhancedColorMode == ENHANCED_COLOR_MODE_ENHANCED_CURRENT_HUE_SATURATION)
    559              {
    560                //add enhancement here for color Zoom.
    561                zclColor_CurrentHue = (zclColor_EnhancedCurrentHue&0xFF00)>>8;
    562                if ( zclColor_CurrentHue > COLOR_HUE_MAX )
    563                {
    564                  zclColor_CurrentHue = COLOR_HUE_MAX;
    565                }
    566          #ifdef ZLL_HW_LED_LAMP
    567                hwLight_UpdateLampColorHueSat( zclColor_CurrentHue, zclColor_CurrentSaturation, zclLevel_CurrentLevel);
    568          #else //ZLL_HW_LED_LAMP #else
    569            #if defined ZCL_LEVEL_CTRL
    570                HalLcdWriteStringValue( "Level:", zclLevel_CurrentLevel, 10, HAL_LCD_LINE_1 );
    571            #endif //ZCL_LEVEL_CTRL
    572                HalLcdWriteStringValue( "EnhHue: 0x", zclColor_EnhancedCurrentHue, 16, HAL_LCD_LINE_2 );
    573                HalLcdWriteStringValue( "Sat:", zclColor_CurrentSaturation, 10, HAL_LCD_LINE_3 );
    574          #endif //ZLL_HW_LED_LAMP
    575              }
    576              else
    577              {
    578                zclColor_EnhancedCurrentHue = zclColor_CurrentHue<<8;
    579          #ifdef ZLL_HW_LED_LAMP
    580                hwLight_UpdateLampColorHueSat( zclColor_CurrentHue, zclColor_CurrentSaturation, zclLevel_CurrentLevel);
    581          #else //ZLL_HW_LED_LAMP #else
    582            #if defined ZCL_LEVEL_CTRL
    583                HalLcdWriteStringValue( "Level:", zclLevel_CurrentLevel, 10, HAL_LCD_LINE_1 );
    584            #endif //ZCL_LEVEL_CTRL
    585                HalLcdWriteStringValue( "Hue:", zclColor_CurrentHue, 10, HAL_LCD_LINE_2 );
    586                HalLcdWriteStringValue( "Sat:", zclColor_CurrentSaturation, 10, HAL_LCD_LINE_3 );
    587          #endif //ZLL_HW_LED_LAMP
    588              }
    589            }
    590          }
    591          
    592          #else //ZCL_COLOR_CTRL
    593          //for this file to be included ZCL_LEVEL_CTRL most be defined and if
    594          //ZCL_COLOR_CTRL is not defined then we are only controller a dimmable light
    595          #ifdef ZCL_LEVEL_CTRL
    596          /*********************************************************************
    597           * @fn      hwLight_UpdateLevel
    598           *
    599           * @brief   Update light output according to level argument
    600           *
    601           * @param   level
    602           *
    603           * @return  none
    604           */
    605          static void hwLight_UpdateLevel( uint8 level )
    606          {
    607          #ifdef ZLL_HW_LED_LAMP
    608          
    609            hwLight_UpdateLampLevel( level );
    610          
    611          #else //ZLL_HW_LED_LAMP #else
    612          
    613            HalLcdWriteStringValue( "Level:", zclLevel_CurrentLevel, 10, HAL_LCD_LINE_1 );
    614          
    615          #endif //ZLL_HW_LED_LAMP
    616          }
    617          
    618          #ifdef ZLL_HW_LED_LAMP
    619          /*********************************************************************
    620           * @fn      hwLight_UpdateLampLevel
    621           *
    622           * @brief   Update lamp level output with gamma compensation
    623           *
    624           * @param   level
    625           *
    626           * @return  none
    627           */
    628          void hwLight_UpdateLampLevel( uint8 level )
    629          {
    630            uint16 gammaCorrectedLevel;
    631          
    632            //gamma correct the level
    633            gammaCorrectedLevel = pow( ( (float)level / LEVEL_MAX ), (float)GAMMA_VALUE ) * (float)LEVEL_MAX;
    634          
    635            halTimer1SetChannelDuty (WHITE_LED, (uint16)(((uint32)gammaCorrectedLevel*PWM_FULL_DUTY_CYCLE)/LEVEL_MAX) );
    636          }
    637          #endif //ZLL_HW_LED_LAMP
    638          #endif //ZCL_LEVEL_CTRL
    639          #endif //ZCL_COLOR_CTRL
    640          
    641          /*********************************************************************
    642           * @fn      hwLight_UpdateOnOff
    643           *
    644           * @brief   Update light output according to On/Off argument
    645           *
    646           * @param   state - LIGHT_ON or LIGHT_OFF
    647           *
    648           * @return  none
    649           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    650          void hwLight_UpdateOnOff( uint8 state )
   \                     hwLight_UpdateOnOff:
    651          {
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
    652            if ( state == LIGHT_ON )
   \   000000   7401         MOV     A,#0x1
   \   000002   69           XRL     A,R1
   \   000003   7005         JNZ     ??hwLight_UpdateOnOff_0
    653            {
    654          #ifdef ZLL_HW_LED_LAMP
    655              ENABLE_LAMP;
   \   000005   43F378       ORL     0xf3,#0x78
   \   000008   8006         SJMP    ??hwLight_UpdateOnOff_1
    656          #else
    657              // On default platform, we use LED4 to simulate the Light
    658              HalLedSet( HAL_LED_4, HAL_LED_MODE_ON );
    659          #endif
    660            }
    661            else
    662            {
    663          #ifdef ZLL_HW_LED_LAMP
    664              DISABLE_LAMP;
   \                     ??hwLight_UpdateOnOff_0:
   \   00000A   53F387       ANL     0xf3,#0x87
   \   00000D   538087       ANL     0x80,#0x87
    665          #else
    666              HalLedSet( HAL_LED_4, HAL_LED_MODE_OFF );
    667              HalLedSet( HAL_LED_2, HAL_LED_MODE_OFF );
    668          #endif
    669            }
    670          }
   \                     ??hwLight_UpdateOnOff_1:
   \   000010   02....       LJMP    ?BRET
   \   000013                REQUIRE P0SEL
   \   000013                REQUIRE _A_P0
    671          
    672          /*********************************************************************
    673           * @fn      hwLight_ApplyUpdate
    674           *
    675           * @brief
    676           *
    677           * @param   pCurrentVal - pointer to current 8bit attr (i.e. zclColor_CurrentHue) value
    678           * @param   pCurrentVal_256  - pointer to current attr value at hi resolution (x256)
    679           * @param   pStepVal_256 - pointer to the required step value of CurrentVal_256
    680           * @param   pRemainingTime - pointer to the time remaining,  in 100ms,  to get to the target value
    681           * @param   minLevel - Minimun val of attr
    682           * @param   maxLevel - Maximun val of attr
    683           *
    684           * @return  none
    685           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    686          void hwLight_ApplyUpdate( uint8 *pCurrentVal, uint16 *pCurrentVal_256, int32 *pStepVal_256, uint16 *pRemainingTime, uint8 minLevel, uint8 maxLevel, bool wrap )
   \                     hwLight_ApplyUpdate:
    687          {
   \   000000   74E8         MOV     A,#-0x18
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 24
   \   000005                ; Auto size: 5
   \   000005   74FB         MOV     A,#-0x5
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   7403         MOV     A,#0x3
   \   00000C   12....       LCALL   ?XSTACK_DISP0_8
   \   00000F   12....       LCALL   ?Subroutine18 & 0xFFFF
   \                     ??CrossCallReturnLabel_25:
   \   000012   12....       LCALL   ?XSTACK_DISP0_8
   \   000015   E9           MOV     A,R1
   \   000016   F0           MOVX    @DPTR,A
    688            if( (*pStepVal_256 > 0) && ((((int32)*pCurrentVal_256 + *pStepVal_256)/256) > maxLevel) )
   \   000017   FE           MOV     R6,A
   \   000018   FC           MOV     R4,A
   \   000019   E4           CLR     A
   \   00001A   CC           XCH     A,R4
   \   00001B   FD           MOV     R5,A
   \   00001C   7421         MOV     A,#0x21
   \   00001E   12....       LCALL   ?XSTACK_DISP0_8
   \   000021   E0           MOVX    A,@DPTR
   \   000022   F582         MOV     DPL,A
   \   000024   AA82         MOV     R2,DPL
   \   000026   741D         MOV     A,#0x1d
   \   000028   12....       LCALL   ?XSTACK_DISP0_8
   \   00002B   12....       LCALL   ?Subroutine26 & 0xFFFF
   \                     ??CrossCallReturnLabel_38:
   \   00002E   741D         MOV     A,#0x1d
   \   000030   12....       LCALL   ?XSTACK_DISP0_8
   \   000033   E8           MOV     A,R0
   \   000034   12....       LCALL   ??Subroutine37_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_71:
   \   000037   741D         MOV     A,#0x1d
   \   000039   12....       LCALL   ?XSTACK_DISP0_8
   \   00003C   12....       LCALL   ??Subroutine35_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_65:
   \   00003F   12....       LCALL   ?L_MOV_X
   \   000042   90....       MOV     DPTR,#__Constant_1
   \   000045   78..         MOV     R0,#?V0 + 0
   \   000047   12....       LCALL   ?SL_GE_X
   \   00004A   5066         JNC     ??hwLight_ApplyUpdate_0
   \   00004C   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_85:
   \   00004F   FE           MOV     R6,A
   \   000050   A3           INC     DPTR
   \   000051   E0           MOVX    A,@DPTR
   \   000052   FF           MOV     R7,A
   \   000053   8E..         MOV     ?V0 + 8,R6
   \   000055   8F..         MOV     ?V0 + 9,R7
   \   000057   E4           CLR     A
   \   000058   F5..         MOV     ?V0 + 10,A
   \   00005A   F5..         MOV     ?V0 + 11,A
   \   00005C   78..         MOV     R0,#?V0 + 8
   \   00005E   79..         MOV     R1,#?V0 + 0
   \   000060   12....       LCALL   ?L_ADD
   \   000063   90....       MOV     DPTR,#__Constant_100
   \   000066   78..         MOV     R0,#?V0 + 4
   \   000068   12....       LCALL   ?L_MOV_X
   \   00006B   78..         MOV     R0,#?V0 + 8
   \   00006D   79..         MOV     R1,#?V0 + 4
   \   00006F   12....       LCALL   ?L_DIV_MOD
   \   000072   8A..         MOV     ?V0 + 4,R2
   \   000074   E4           CLR     A
   \   000075   F5..         MOV     ?V0 + 5,A
   \   000077   F5..         MOV     ?V0 + 6,A
   \   000079   F5..         MOV     ?V0 + 7,A
   \   00007B   78..         MOV     R0,#?V0 + 8
   \   00007D   79..         MOV     R1,#?V0 + 4
   \   00007F   12....       LCALL   ?SL_GT
   \   000082   4003         JC      $+5
   \   000084   02....       LJMP    ??hwLight_ApplyUpdate_1 & 0xFFFF
    689            {
    690              if(wrap)
   \   000087   EA           MOV     A,R2
   \   000088   FB           MOV     R3,A
   \   000089   7422         MOV     A,#0x22
   \   00008B   12....       LCALL   ?XSTACK_DISP0_8
   \   00008E   E0           MOVX    A,@DPTR
   \   00008F   601A         JZ      ??hwLight_ApplyUpdate_2
    691              {
    692                *pCurrentVal_256 = (uint16)minLevel*256 + ( ( *pCurrentVal_256 + *pStepVal_256 ) - (uint16)maxLevel*256 ) - 256;
   \   000091   E4           CLR     A
   \   000092   2E           ADD     A,R6
   \   000093   F8           MOV     R0,A
   \   000094   ED           MOV     A,R5
   \   000095   3F           ADDC    A,R7
   \   000096   F9           MOV     R1,A
   \   000097   E8           MOV     A,R0
   \   000098   25..         ADD     A,?V0 + 0
   \   00009A   F8           MOV     R0,A
   \   00009B   E9           MOV     A,R1
   \   00009C   35..         ADDC    A,?V0 + 1
   \   00009E   C3           CLR     C
   \   00009F   9B           SUBB    A,R3
   \   0000A0   F9           MOV     R1,A
   \   0000A1   19           DEC     R1
   \   0000A2   12....       LCALL   ?Subroutine9 & 0xFFFF
    693              }
   \                     ??CrossCallReturnLabel_6:
   \   0000A5   E8           MOV     A,R0
   \   0000A6   F0           MOVX    @DPTR,A
   \   0000A7   A3           INC     DPTR
   \   0000A8   E9           MOV     A,R1
   \   0000A9   8003         SJMP    ??CrossCallReturnLabel_10
    694              else
    695              {
    696                *pCurrentVal_256 = (uint16)maxLevel*256;
   \                     ??hwLight_ApplyUpdate_2:
   \   0000AB   12....       LCALL   ?Subroutine10 & 0xFFFF
    697              }
    698            }
   \                     ??CrossCallReturnLabel_10:
   \   0000AE   F0           MOVX    @DPTR,A
   \   0000AF   02....       LJMP    ??hwLight_ApplyUpdate_3 & 0xFFFF
    699            else if( (*pStepVal_256 < 0) && ((((int32)*pCurrentVal_256 + *pStepVal_256)/256) < minLevel) )
   \                     ??hwLight_ApplyUpdate_0:
   \   0000B2   90....       MOV     DPTR,#__Constant_0
   \   0000B5   78..         MOV     R0,#?V0 + 0
   \   0000B7   12....       LCALL   ?SL_GE_X
   \   0000BA   5003         JNC     $+5
   \   0000BC   02....       LJMP    ??hwLight_ApplyUpdate_1 & 0xFFFF
   \   0000BF   7402         MOV     A,#0x2
   \   0000C1   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C4   E0           MOVX    A,@DPTR
   \   0000C5   F5..         MOV     ?V0 + 12,A
   \   0000C7   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_86:
   \   0000CA   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_19:
   \   0000CD   79..         MOV     R1,#?V0 + 0
   \   0000CF   12....       LCALL   ?L_ADD
   \   0000D2   90....       MOV     DPTR,#__Constant_100
   \   0000D5   78..         MOV     R0,#?V0 + 8
   \   0000D7   12....       LCALL   ?L_MOV_X
   \   0000DA   78..         MOV     R0,#?V0 + 4
   \   0000DC   79..         MOV     R1,#?V0 + 8
   \   0000DE   12....       LCALL   ?L_DIV_MOD
   \   0000E1   85....       MOV     ?V0 + 8,?V0 + 12
   \   0000E4   8C..         MOV     ?V0 + 9,R4
   \   0000E6   8C..         MOV     ?V0 + 10,R4
   \   0000E8   8C..         MOV     ?V0 + 11,R4
   \   0000EA   78..         MOV     R0,#?V0 + 8
   \   0000EC   79..         MOV     R1,#?V0 + 4
   \   0000EE   12....       LCALL   ?SL_GT
   \   0000F1   5064         JNC     ??hwLight_ApplyUpdate_1
    700            {
    701              if(wrap)
   \   0000F3   7422         MOV     A,#0x22
   \   0000F5   12....       LCALL   ?XSTACK_DISP0_8
   \   0000F8   E0           MOVX    A,@DPTR
   \   0000F9   6050         JZ      ??hwLight_ApplyUpdate_4
    702              {
    703                *pCurrentVal_256 = (uint16)maxLevel*256 - ( (uint16)minLevel*256 - ((int32)*pCurrentVal_256 + *pStepVal_256) ) + 256 ;
   \   0000FB   EA           MOV     A,R2
   \   0000FC   C3           CLR     C
   \   0000FD   9E           SUBB    A,R6
   \   0000FE   F9           MOV     R1,A
   \   0000FF   E4           CLR     A
   \   000100   25..         ADD     A,?V0 + 0
   \   000102   F8           MOV     R0,A
   \   000103   E9           MOV     A,R1
   \   000104   35..         ADDC    A,?V0 + 1
   \   000106   F9           MOV     R1,A
   \   000107   09           INC     R1
   \   000108   12....       LCALL   ?Subroutine9 & 0xFFFF
    704              }
   \                     ??CrossCallReturnLabel_7:
   \   00010B   E0           MOVX    A,@DPTR
   \   00010C   28           ADD     A,R0
   \   00010D   F0           MOVX    @DPTR,A
   \   00010E   A3           INC     DPTR
   \   00010F   E0           MOVX    A,@DPTR
   \   000110   39           ADDC    A,R1
   \                     ??hwLight_ApplyUpdate_5:
   \   000111   F0           MOVX    @DPTR,A
    705              else
    706              {
    707                *pCurrentVal_256 = (uint16)minLevel*256;
    708              }
    709            }
    710            else
    711            {
    712              *pCurrentVal_256 += *pStepVal_256;
    713            }
    714          
    715            if (*pStepVal_256 > 0)
    716            {
    717               //fraction step compensation
    718              *pCurrentVal = ( *pCurrentVal_256 + 127 ) / 256;
    719            }
    720            else
    721            {
    722              *pCurrentVal = ( *pCurrentVal_256 / 256 );
   \                     ??hwLight_ApplyUpdate_6:
   \   000112   12....       LCALL   ?Subroutine12 & 0xFFFF
    723            }
   \                     ??CrossCallReturnLabel_82:
   \   000115   A3           INC     DPTR
   \   000116   E0           MOVX    A,@DPTR
   \                     ??hwLight_ApplyUpdate_7:
   \   000117   C0E0         PUSH    A
   \   000119   7403         MOV     A,#0x3
   \   00011B   12....       LCALL   ?XSTACK_DISP0_8
   \   00011E   12....       LCALL   ??Subroutine38_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_76:
   \   000121   D0E0         POP     A
   \   000123   F0           MOVX    @DPTR,A
   \   000124   741F         MOV     A,#0x1f
   \   000126   12....       LCALL   ?XSTACK_DISP0_8
   \   000129   12....       LCALL   ?Subroutine5 & 0xFFFF
    724          
    725            if (*pRemainingTime == 0x0)
   \                     ??CrossCallReturnLabel_1:
   \   00012C   704F         JNZ     ??hwLight_ApplyUpdate_8
    726            {
    727              // align variables
    728              *pCurrentVal_256 = ((uint16)*pCurrentVal)*256 ;
   \   00012E   7403         MOV     A,#0x3
   \   000130   12....       LCALL   ?XSTACK_DISP0_8
   \   000133   12....       LCALL   ??Subroutine39_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_84:
   \   000136   F9           MOV     R1,A
   \   000137   12....       LCALL   ?Subroutine9 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   00013A   12....       LCALL   ??Subroutine36_0 & 0xFFFF
    729              *pStepVal_256 = 0;
   \                     ??CrossCallReturnLabel_72:
   \   00013D   741D         MOV     A,#0x1d
   \   00013F   12....       LCALL   ?XSTACK_DISP0_8
   \   000142   12....       LCALL   ?Subroutine11 & 0xFFFF
    730            }
   \                     ??CrossCallReturnLabel_11:
   \   000145   F0           MOVX    @DPTR,A
   \   000146   A3           INC     DPTR
   \   000147   F0           MOVX    @DPTR,A
   \   000148   A3           INC     DPTR
   \   000149   803F         SJMP    ??CrossCallReturnLabel_21
   \                     ??hwLight_ApplyUpdate_4:
   \   00014B   85..82       MOV     DPL,?XSP + 0
   \   00014E   85..83       MOV     DPH,?XSP + 1
   \   000151   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_12:
   \   000154   ED           MOV     A,R5
   \   000155   80BA         SJMP    ??hwLight_ApplyUpdate_5
   \                     ??hwLight_ApplyUpdate_1:
   \   000157   85....       MOV     ?V0 + 4,?V0 + 0
   \   00015A   85....       MOV     ?V0 + 5,?V0 + 1
   \   00015D   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_87:
   \   000160   25..         ADD     A,?V0 + 4
   \   000162   F0           MOVX    @DPTR,A
   \   000163   A3           INC     DPTR
   \   000164   E0           MOVX    A,@DPTR
   \   000165   35..         ADDC    A,?V0 + 5
   \   000167   F0           MOVX    @DPTR,A
   \   000168   90....       MOV     DPTR,#__Constant_1
   \   00016B   78..         MOV     R0,#?V0 + 0
   \   00016D   12....       LCALL   ?SL_GE_X
   \   000170   50A0         JNC     ??hwLight_ApplyUpdate_6
   \                     ??hwLight_ApplyUpdate_3:
   \   000172   12....       LCALL   ?Subroutine3 & 0xFFFF
   \                     ??CrossCallReturnLabel_88:
   \   000175   247F         ADD     A,#0x7f
   \   000177   A3           INC     DPTR
   \   000178   E0           MOVX    A,@DPTR
   \   000179   3400         ADDC    A,#0x0
   \   00017B   809A         SJMP    ??hwLight_ApplyUpdate_7
    731            else if (*pRemainingTime != 0xFFFF)
   \                     ??hwLight_ApplyUpdate_8:
   \   00017D   74FF         MOV     A,#-0x1
   \   00017F   6A           XRL     A,R2
   \   000180   7003         JNZ     ??hwLight_ApplyUpdate_9
   \   000182   74FF         MOV     A,#-0x1
   \   000184   6B           XRL     A,R3
   \                     ??hwLight_ApplyUpdate_9:
   \   000185   6004         JZ      ??hwLight_ApplyUpdate_10
    732            {
    733              *pRemainingTime = *pRemainingTime-1;
   \   000187   12....       LCALL   ?Subroutine16 & 0xFFFF
    734            }
   \                     ??CrossCallReturnLabel_21:
   \   00018A   F0           MOVX    @DPTR,A
    735          
    736            hwLight_Refresh( REFRESH_AUTO );
   \                     ??hwLight_ApplyUpdate_10:
   \   00018B                ; Setup parameters for call to function hwLight_Refresh
   \   00018B   7900         MOV     R1,#0x0
   \   00018D   12....       LCALL   ??hwLight_Refresh?relay
    737          }
   \   000190   7405         MOV     A,#0x5
   \   000192   02....       LJMP    ?Subroutine0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   12....       LCALL   ?Subroutine27 & 0xFFFF
   \                     ??CrossCallReturnLabel_43:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006   E0           MOVX    A,@DPTR
   \   000007   FA           MOV     R2,A
   \   000008   A3           INC     DPTR
   \   000009   E0           MOVX    A,@DPTR
   \   00000A   F583         MOV     DPH,A
   \   00000C   8A82         MOV     DPL,R2
   \   00000E   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   85..82       MOV     DPL,?XSP + 0
   \   000003   85..83       MOV     DPH,?XSP + 1
   \   000006                REQUIRE ??Subroutine39_0
   \   000006                ; // Fall through to label ??Subroutine39_0
    738          
    739          /*********************************************************************
    740           * @fn      hwLight_Refresh
    741           *
    742           * @brief   Refresh the light output with the updated attributes values.
    743           *          Could be set to be bypassed, to allow temporary output manipulation
    744           *          by effects.
    745           *
    746           * @param   refreshState - REFRESH_AUTO, REFRESH_BYPASS or REFRESH_RESUME
    747           *
    748           * @return  none
    749           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    750          void hwLight_Refresh( uint8 refreshState )
   \                     hwLight_Refresh:
    751          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    752            static bool dont_refresh = FALSE;
    753            if ( refreshState == REFRESH_BYPASS )
   \   000007   7401         MOV     A,#0x1
   \   000009   6E           XRL     A,R6
   \   00000A   7008         JNZ     ??hwLight_Refresh_0
    754            {
    755              dont_refresh = TRUE;
   \   00000C   90....       MOV     DPTR,#??dont_refresh
   \   00000F   7401         MOV     A,#0x1
   \   000011   F0           MOVX    @DPTR,A
   \   000012   8078         SJMP    ??hwLight_Refresh_1
    756            }
    757            else if ( refreshState == REFRESH_RESUME )
   \                     ??hwLight_Refresh_0:
   \   000014   7402         MOV     A,#0x2
   \   000016   6E           XRL     A,R6
   \   000017   90....       MOV     DPTR,#??dont_refresh
   \   00001A   7004         JNZ     ??hwLight_Refresh_2
    758            {
    759              dont_refresh = FALSE;
   \   00001C   E4           CLR     A
   \   00001D   F0           MOVX    @DPTR,A
   \   00001E   8003         SJMP    ??hwLight_Refresh_3
    760            }
    761            if ( dont_refresh )
   \                     ??hwLight_Refresh_2:
   \   000020   E0           MOVX    A,@DPTR
   \   000021   7069         JNZ     ??hwLight_Refresh_1
    762            {
    763              return;
    764            }
    765          #ifdef ZCL_COLOR_CTRL
    766            //Update the xy/color attribute. Even though we are not using the color mode
    767            //the attr needs to be correct
    768            if(zclColor_ColorMode == COLOR_MODE_CURRENT_X_Y)
   \                     ??hwLight_Refresh_3:
   \   000023   90....       MOV     DPTR,#zclColor_ColorMode
   \   000026   E0           MOVX    A,@DPTR
   \   000027   6401         XRL     A,#0x1
   \   000029   7004         JNZ     ??hwLight_Refresh_4
    769            {
    770              hwLight_UpdateColorMode(COLOR_MODE_CURRENT_HUE_SATURATION);
   \   00002B                ; Setup parameters for call to function hwLight_UpdateColorMode
   \   00002B   7900         MOV     R1,#0x0
   \   00002D   8002         SJMP    ??hwLight_Refresh_5
    771            }
    772            else
    773            {
    774              hwLight_UpdateColorMode(COLOR_MODE_CURRENT_X_Y);
   \                     ??hwLight_Refresh_4:
   \   00002F                ; Setup parameters for call to function hwLight_UpdateColorMode
   \   00002F   7901         MOV     R1,#0x1
   \                     ??hwLight_Refresh_5:
   \   000031   12....       LCALL   ??hwLight_UpdateColorMode?relay
    775            }
    776            hwLight_UpdateColor();
   \   000034   90....       MOV     DPTR,#zclColor_ColorMode
   \   000037   E0           MOVX    A,@DPTR
   \   000038   6401         XRL     A,#0x1
   \   00003A   700D         JNZ     ??hwLight_Refresh_6
   \   00003C                ; Setup parameters for call to function hwLight_UpdateLampColor
   \   00003C   90....       MOV     DPTR,#zclLevel_CurrentLevel
   \   00003F   E0           MOVX    A,@DPTR
   \   000040   F9           MOV     R1,A
   \   000041   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_64:
   \   000044   12....       LCALL   ??hwLight_UpdateLampColor?relay
   \   000047   803B         SJMP    ??hwLight_Refresh_7
   \                     ??hwLight_Refresh_6:
   \   000049   90....       MOV     DPTR,#zclColor_EnhancedColorMode
   \   00004C   E0           MOVX    A,@DPTR
   \   00004D   6403         XRL     A,#0x3
   \   00004F   701F         JNZ     ??hwLight_Refresh_8
   \   000051   90....       MOV     DPTR,#zclColor_EnhancedCurrentHue + 1
   \   000054   E0           MOVX    A,@DPTR
   \   000055   90....       MOV     DPTR,#zclColor_CurrentHue
   \   000058   F0           MOVX    @DPTR,A
   \   000059   F4           CPL     A
   \   00005A   7003         JNZ     ??hwLight_Refresh_9
   \   00005C   74FE         MOV     A,#-0x2
   \   00005E   F0           MOVX    @DPTR,A
   \                     ??hwLight_Refresh_9:
   \   00005F                ; Setup parameters for call to function hwLight_UpdateLampColorHueSat
   \   00005F   90....       MOV     DPTR,#zclLevel_CurrentLevel
   \   000062   E0           MOVX    A,@DPTR
   \   000063   FB           MOV     R3,A
   \   000064   90....       MOV     DPTR,#zclColor_CurrentSaturation
   \   000067   E0           MOVX    A,@DPTR
   \   000068   FA           MOV     R2,A
   \   000069   90....       MOV     DPTR,#zclColor_CurrentHue
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   F9           MOV     R1,A
   \   00006E   8011         SJMP    ??hwLight_Refresh_10
   \                     ??hwLight_Refresh_8:
   \   000070   90....       MOV     DPTR,#zclColor_CurrentHue
   \   000073   E0           MOVX    A,@DPTR
   \   000074   12....       LCALL   ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_74:
   \   000077                ; Setup parameters for call to function hwLight_UpdateLampColorHueSat
   \   000077   90....       MOV     DPTR,#zclLevel_CurrentLevel
   \   00007A   E0           MOVX    A,@DPTR
   \   00007B   FB           MOV     R3,A
   \   00007C   90....       MOV     DPTR,#zclColor_CurrentSaturation
   \   00007F   E0           MOVX    A,@DPTR
   \   000080   FA           MOV     R2,A
   \                     ??hwLight_Refresh_10:
   \   000081   12....       LCALL   ??hwLight_UpdateLampColorHueSat?relay
    777          #else //ZCL_COLOR_CTRL
    778          #ifdef ZCL_LEVEL_CTRL
    779            hwLight_UpdateLevel( zclLevel_CurrentLevel );
    780          #endif //ZCL_LEVEL_CTRL
    781          #endif //ZCL_COLOR_CTRL
    782            hwLight_UpdateOnOff( zllSampleLight_OnOff );
   \                     ??hwLight_Refresh_7:
   \   000084                ; Setup parameters for call to function hwLight_UpdateOnOff
   \   000084   90....       MOV     DPTR,#zllSampleLight_OnOff
   \   000087   E0           MOVX    A,@DPTR
   \   000088   F9           MOV     R1,A
   \   000089   12....       LCALL   ??hwLight_UpdateOnOff?relay
    783          }
   \                     ??hwLight_Refresh_1:
   \   00008C   02....       LJMP    ?Subroutine1 & 0xFFFF

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??dont_refresh:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3ec8c8c9:
   \   000000   C9C8C83E     DD 3EC8C8C9H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_477fff00:
   \   000000   00FF7F47     DD 477FFF00H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_437e0000:
   \   000000   00007E43     DD 437E0000H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_0:
   \   000000   00000000     DD 0H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_42be1811:
   \   000000   1118BE42     DD 42BE1811H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_42d9c41a:
   \   000000   1AC4D942     DD 42D9C41AH

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_bf800000:
   \   000000   000080BF     DD 0BF800000H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_42c80000:
   \   000000   0000C842     DD 42C80000H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_42c80001:
   \   000000   0100C842     DD 42C80001H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_404f65fe:
   \   000000   FE654F40     DD 404F65FEH

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_bfc4c2f8:
   \   000000   F8C2C4BF     DD 0BFC4C2F8H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_beff4880:
   \   000000   8048FFBE     DD 0BEFF4880H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_bf7809d5:
   \   000000   D50978BF     DD 0BF7809D5H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3ff01a37:
   \   000000   371AF03F     DD 3FF01A37H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3d29fbe7:
   \   000000   E7FB293D     DD 3D29FBE7H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3d6425af:
   \   000000   AF25643D     DD 3D6425AFH

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_be50e560:
   \   000000   60E550BE     DD 0BE50E560H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3f874bc7:
   \   000000   C74B873F     DD 3F874BC7H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3b449ba7:
   \   000000   A79B443B     DD 3B449BA7H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3f2aaaab:
   \   000000   ABAA2A3F     DD 3F2AAAABH

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3f9c28f6:
   \   000000   F6289C3F     DD 3F9C28F6H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_bd23d70a:
   \   000000   0AD723BD     DD 0BD23D70AH

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3f8b851f:
   \   000000   1F858B3F     DD 3F8B851FH

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_bd4ccccd:
   \   000000   CDCC4CBD     DD 0BD4CCCCDH

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_3f800001:
   \   000000   0100803F     DD 3F800001H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_447a0000:
   \   000000   00007A44     DD 447A0000H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_ffffaaab:
   \   000000   ABAAFFFF     DD -21845

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_ffffb000:
   \   000000   00B0FFFF     DD -20480

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_437f0000:
   \   000000   00007F43     DD 437F0000H

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_fe:
   \   000000   FE000000     DD 254

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_1:
   \   000000   01000000     DD 1

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_100:
   \   000000   00010000     DD 256

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_ffffff00:
   \   000000   00FFFFFF     DD 4294967040

   \                                 In  segment XDATA_ROM_C, align 1
   \                     __Constant_7f:
   \   000000   7F000000     DD 127

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hwLight_UpdateLampColor?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hwLight_UpdateLampColor

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hwLight_Convert_xyY_to_RGB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hwLight_Convert_xyY_to_RGB

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hwLight_RGB_to_RGBW?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hwLight_RGB_to_RGBW

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hwLight_UpdateLampColorHueSat?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hwLight_UpdateLampColorHueSat

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hwLight_satToXy?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hwLight_satToXy

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hwLight_XyToSat?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hwLight_XyToSat

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hwLight_UpdateColorMode?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hwLight_UpdateColorMode

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hwLight_ApplyUpdate16b?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hwLight_ApplyUpdate16b

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hwLight_UpdateOnOff?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hwLight_UpdateOnOff

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hwLight_ApplyUpdate?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hwLight_ApplyUpdate

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??hwLight_Refresh?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    hwLight_Refresh
    784          
    785          /****************************************************************************
    786          ****************************************************************************/
    787          
    788          

   Maximum stack usage in bytes:

   ISTACK PSTACK XSTACK Function
   ------ ------ ------ --------
       1      0     35  hwLight_ApplyUpdate
                          0 0 29 -> hwLight_Refresh
       1      0     41  hwLight_ApplyUpdate16b
                          0 0 33 -> hwLight_Refresh
       4      0     82  hwLight_Convert_xyY_to_RGB
                          0 0 44 -> pow
       0      0     50  hwLight_RGB_to_RGBW
       0      0     42  hwLight_Refresh
                          0 0  9 -> hwLight_UpdateColorMode
                          0 0  9 -> hwLight_UpdateLampColor
                          0 0  9 -> hwLight_UpdateLampColorHueSat
                          0 0  9 -> hwLight_UpdateOnOff
       0      0     29  hwLight_UpdateColorMode
                          0 0 20 -> hwLight_XyToSat
                          0 0 20 -> hwLight_satToXy
       0      0     51  hwLight_UpdateLampColor
                          0 0 24 -> halTimer1SetChannelDuty
                          0 0 38 -> hwLight_Convert_xyY_to_RGB
                          0 0 28 -> hwLight_RGB_to_RGBW
       0      0     22  hwLight_UpdateLampColorHueSat
                          0 0 13 -> hwLight_UpdateLampColor
                          0 0 13 -> hwLight_satToXy
       0      0      9  hwLight_UpdateOnOff
       0      0     40  hwLight_XyToSat
       0      0     48  hwLight_satToXy


   Segment part sizes:

   Bytes  Function/Label
   -----  --------------
       7  ??Subroutine33_0
       6  ??Subroutine34_0
       6  ??Subroutine35_0
       1  ??Subroutine36_0
       5  ??Subroutine37_0
       4  ??Subroutine38_0
       5  ??Subroutine39_0
       6  ??hwLight_ApplyUpdate16b?relay
       6  ??hwLight_ApplyUpdate?relay
       6  ??hwLight_Convert_xyY_to_RGB?relay
       6  ??hwLight_RGB_to_RGBW?relay
       6  ??hwLight_Refresh?relay
       6  ??hwLight_UpdateColorMode?relay
       6  ??hwLight_UpdateLampColor?relay
       6  ??hwLight_UpdateLampColorHueSat?relay
       6  ??hwLight_UpdateOnOff?relay
       6  ??hwLight_XyToSat?relay
       6  ??hwLight_satToXy?relay
       8  ?Subroutine0
       5  ?Subroutine1
      11  ?Subroutine10
       4  ?Subroutine11
       6  ?Subroutine12
      10  ?Subroutine13
       8  ?Subroutine14
      14  ?Subroutine15
      13  ?Subroutine16
      14  ?Subroutine17
      19  ?Subroutine18
       1  ?Subroutine19
       5  ?Subroutine2
      13  ?Subroutine20
       4  ?Subroutine21
       9  ?Subroutine22
       4  ?Subroutine23
       4  ?Subroutine24
      10  ?Subroutine25
       6  ?Subroutine26
       7  ?Subroutine27
       4  ?Subroutine28
       6  ?Subroutine29
       6  ?Subroutine3
      13  ?Subroutine30
      19  ?Subroutine31
       9  ?Subroutine32
       6  ?Subroutine4
      15  ?Subroutine5
       9  ?Subroutine6
      16  ?Subroutine7
      11  ?Subroutine8
      15  ?Subroutine9
       1  P0SEL
       1  _A_P0
       4  __Constant_0
       4  __Constant_1
       4  __Constant_100
       4  __Constant_3b449ba7
       4  __Constant_3d29fbe7
       4  __Constant_3d6425af
       4  __Constant_3ec8c8c9
       4  __Constant_3f2aaaab
       4  __Constant_3f800001
       4  __Constant_3f874bc7
       4  __Constant_3f8b851f
       4  __Constant_3f9c28f6
       4  __Constant_3ff01a37
       4  __Constant_404f65fe
       4  __Constant_42be1811
       4  __Constant_42c80000
       4  __Constant_42c80001
       4  __Constant_42d9c41a
       4  __Constant_437e0000
       4  __Constant_437f0000
       4  __Constant_447a0000
       4  __Constant_477fff00
       4  __Constant_7f
       4  __Constant_bd23d70a
       4  __Constant_bd4ccccd
       4  __Constant_be50e560
       4  __Constant_beff4880
       4  __Constant_bf7809d5
       4  __Constant_bf800000
       4  __Constant_bfc4c2f8
       4  __Constant_fe
       4  __Constant_ffffaaab
       4  __Constant_ffffb000
       4  __Constant_ffffff00
       1  dont_refresh
     512  hueToX
     512  hueToY
     405  hwLight_ApplyUpdate
     500  hwLight_ApplyUpdate16b
    1584  hwLight_Convert_xyY_to_RGB
     451  hwLight_RGB_to_RGBW
     143  hwLight_Refresh
     277  hwLight_UpdateColorMode
     295  hwLight_UpdateLampColor
      87  hwLight_UpdateLampColorHueSat
      19  hwLight_UpdateOnOff
     226  hwLight_XyToSat
     233  hwLight_satToXy

 
 4 558 bytes in segment BANKED_CODE
    66 bytes in segment BANK_RELAYS
 1 024 bytes in segment CODE_C
     2 bytes in segment SFR_AN
   136 bytes in segment XDATA_ROM_C
     1 byte  in segment XDATA_Z
 
 5 648 bytes of CODE  memory
     0 bytes of CONST memory (+ 136 bytes shared)
     0 bytes of DATA  memory (+   2 bytes shared)
     1 byte  of XDATA memory

Errors: none
Warnings: none
